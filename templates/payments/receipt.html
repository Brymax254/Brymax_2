{% extends "base.html" %}
{% load static %}
{% block content %}

<main class="max-w-3xl mx-auto p-8 bg-gray-50">

  <!-- Header -->
  <header class="flex items-center mb-8">
    <h1 class="text-3xl font-bold">Trip Receipt</h1>
  </header>

  <!-- Hero Image -->
  <div class="mb-6 rounded-lg overflow-hidden shadow-lg">
    {% if payment.tour.hero_image %}
      <img src="{{ payment.tour.hero_image.url }}"
           alt="{{ payment.tour.title }}"
           class="w-full h-64 object-cover">
    {% endif %}
  </div>

  <!-- Traveler & Booking Info -->
  <section class="bg-white rounded-lg glassmorphism p-6 mb-6">
    <h2 class="text-xl font-semibold mb-4">Traveler & Booking Details</h2>
    <div class="grid grid-cols-2 gap-4 text-sm">
      <div><strong>Name:</strong> {{ payment.guest_full_name|default:payment.user.get_full_name }}</div>
      <div><strong>Email:</strong> {{ payment.guest_email|default:"N/A"}}</div>
      <div><strong>Phone:</strong> {{ payment.guest_phone|default:"N/A"}}</div>
      <div><strong>Travel Date:</strong> {{ payment.travel_date }}</div>
      <div><strong>Tour:</strong> {{ payment.tour.title }}</div>
      <div><strong>Duration:</strong> {{ payment.days }} days</div>
      <div><strong>Adults:</strong> {{ payment.adults }}</div>
      <div><strong>Children:</strong> {{ payment.children }}</div>
    </div>
  </section>

  <!-- Payment Breakdown -->
  <section class="bg-white rounded-lg glassmorphism p-6 mb-6">
    <h2 class="text-xl font-semibold mb-4">Payment Breakdown</h2>
    <table class="w-full text-sm">
      <tr>
        <td>Base Price per Person</td>
        <td class="text-right">KES {{ payment.tour.price_per_person|floatformat:0 }}</td>
      </tr>
      <tr>
        <td>Adults Cost ({{ payment.adults }})</td>
        <td class="text-right">KES {{ payment.adults_cost|floatformat:0 }}</td>
      </tr>
      <tr>
        <td>Children Cost ({{ payment.children }})</td>
        <td class="text-right">KES {{ payment.children_cost|floatformat:0 }}</td>
      </tr>
      <tr class="font-bold border-t">
        <td>Total Paid</td>
        <td class="text-right text-emerald-700">KES {{ payment.amount_paid|floatformat:0 }}</td>
      </tr>
    </table>
    <p class="mt-2 text-xs text-gray-500">
      Reference: {{ payment.pesapal_reference|default:payment.reference }}
    </p>
  </section>

  <!-- Extras & Upsells -->
  <section class="bg-white rounded-lg glassmorphism p-6 mb-6">
    <h2 class="text-xl font-semibold mb-4">Your Trip Extras</h2>
    <ul class="list-disc list-inside text-sm space-y-1">
      {% for feature in payment.tour.features.all %}
        <li>{{ feature.name }} — {{ feature.description }}</li>
      {% empty %}
        <li>No extras added.</li>
      {% endfor %}
    </ul>
  </section>

  <!-- Download Button -->
  <div class="text-center mb-8">
    <button onclick="window.print()"
            class="bg-emerald-600 text-white px-6 py-2 rounded-lg hover:bg-emerald-500 transition">
      Download Receipt
    </button>
  </div>

  <!-- Related Tours -->
  <section class="text-center text-sm text-gray-600">
    <h3 class="font-semibold mb-2">Explore More Safaris</h3>
    <a href="{% url 'tours' %}" class="text-emerald-600 hover:underline">

      View all packages →
    </a>
  </section>

</main>
{% endblock %}
