{% load static %}
{% load custom_filters %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Office Manager | Safari Adventures Kenya</title>

    <!-- Meta tags for SEO -->
    <meta name="description" content="Driver dashboard for Safari Adventures Kenya - manage tours, earnings, and schedule">
    <meta name="author" content="Safari Adventures Kenya">

    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://unpkg.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">

    <!-- Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- Chart.js with tree-shaking -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Custom CSS -->
    <style>
        :root {
            --navy: #0f172a;
            --teal: #0d9488;
            --gold: #d4a574;
            --cream: #f8f5f0;
            --light-gray: #f1f5f9;
            --medium-gray: #94a3b8;
            --glass-bg: rgba(15, 23, 42, 0.75);
            --glass-border: rgba(255, 255, 255, 0.18);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            --safari-green: #1a6d4c;
            --safari-sand: #fdf3e7;
            --safari-accent: #d4a574;
            --safari-sky: #0ea5e9;
            --safari-earth: #8b4513;
            --card-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Source Sans Pro', sans-serif;
            background: linear-gradient(135deg, #1e293b, #0f172a);
            min-height: 100vh;
            color: var(--cream);
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Playfair Display', serif;
        }

        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            border-radius: 1rem;
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .glass:hover {
            transform: translateY(-0.35rem);
            box-shadow: 0 12px 40px rgba(0,0,0,0.25);
        }

        .stat-card {
            position: relative;
            overflow: hidden;
            padding: 1.75rem;
            text-align: center;
            color: #fff;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .stat-card::before {
            content: "";
            position: absolute;
            inset: 0;
            background-size: cover;
            background-position: center;
            z-index: 0;
            filter: brightness(0.65);
        }

        .stat-card .overlay {
            position: relative;
            z-index: 1;
        }

        .sidebar {
            background: linear-gradient(180deg, rgba(15, 23, 42, 0.9) 0%, rgba(13, 148, 136, 0.8) 100%);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: .75rem 1rem;
            border-radius: 0.75rem;
            color: rgba(255,255,255,0.9);
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .nav-link::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--gold);
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }

        .nav-link:hover {
            background: rgba(255,255,255,0.1);
            transform: translateX(6px);
        }

        .nav-link:hover::before {
            transform: translateX(0);
        }

        .nav-link.active {
            background: linear-gradient(135deg, var(--navy), var(--teal));
            color: #fff;
            box-shadow: 0 4px 12px rgba(13, 148, 136, 0.3);
        }

        [x-cloak] { display: none !important; }

        .btn-primary {
            background: linear-gradient(135deg, var(--navy), var(--teal));
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(13, 148, 136, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(13, 148, 136, 0.4);
        }

        .classic-border {
            border: 2px solid var(--gold);
            border-radius: 0.5rem;
        }

        .text-accent {
            color: var(--teal);
        }

        .bg-accent {
            background-color: var(--teal);
        }

        .bg-cream {
            background-color: rgba(248, 245, 240, 0.1);
        }

        /* Table Styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            background: rgba(13, 148, 136, 0.2);
            color: #fff;
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .data-table td {
            padding: 0.75rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .data-table tr:hover {
            background: rgba(13, 148, 136, 0.1);
        }

        .action-btn {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            margin-right: 0.25rem;
            cursor: pointer;
        }

        .view-btn {
            background: var(--teal);
            color: white;
        }

        .edit-btn {
            background: var(--gold);
            color: var(--navy);
        }

        .delete-btn {
            background: #ef4444;
            color: white;
        }

        .status-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-active {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .status-pending {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }

        .status-inactive {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        /* Form Styles */
        .form-container {
            max-width: 100%;
            padding: 0;
        }

        .form-header {
            background: linear-gradient(135deg, var(--safari-green), var(--safari-earth));
            color: white;
            padding: 2rem;
            border-radius: 1.5rem 1.5rem 0 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .form-header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            animation: pulse 4s infinite ease-in-out;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.3; }
        }

        .form-header h1 {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
        }

        .section-card {
            border: none;
            border-radius: 0.75rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 1rem;
            overflow: hidden;
            transition: var(--transition);
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(8px);
        }

        .section-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .section-header {
            padding: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            background: rgba(13, 148, 136, 0.2);
        }

        .section-header i {
            font-size: 1.25rem;
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem;
            color: white;
            background: rgba(13, 148, 136, 0.5);
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #fff;
        }

        .section-body {
            padding: 1rem;
        }

        .form-label {
            font-weight: 600;
            color: #f8f5f0;
            margin-bottom: 0.4rem;
            display: block;
            font-size: 0.9rem;
        }

        .form-control, .form-select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.375rem;
            padding: 0.5rem 0.75rem;
            transition: var(--transition);
            width: 100%;
            font-size: 0.9rem;
            color: #fff;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--safari-green);
            box-shadow: 0 0 0 0.2rem rgba(26, 109, 76, 0.5);
            outline: none;
            background: rgba(255, 255, 255, 0.15);
        }

        .form-control::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        textarea.form-control {
            min-height: 80px;
            resize: vertical;
        }

        .form-check {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .form-check-input {
            width: 1rem;
            height: 1rem;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .form-check-input:checked {
            background-color: var(--safari-green);
            border-color: var(--safari-green);
        }

        .form-check-label {
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
            color: #f8f5f0;
        }

        .submit-btn {
            background: linear-gradient(135deg, var(--safari-green), var(--safari-earth));
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 2rem;
            box-shadow: 0 4px 12px rgba(26, 109, 76, 0.4);
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 1.5rem auto 0;
            cursor: pointer;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(26, 109, 76, 0.5);
        }

        .json-field {
            position: relative;
        }

        .json-field .form-control {
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
        }

        .json-hint {
            font-size: 0.75rem;
            color: rgba(248, 245, 240, 0.7);
            margin-top: 0.2rem;
            font-style: italic;
        }

        .image-upload {
            position: relative;
        }

        .image-upload .form-control {
            padding-left: 2.5rem;
        }

        .image-upload::before {
            content: "\f03e";
            font-family: "Font Awesome 5 Free";
            font-weight: 900;
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.7);
        }

        .form-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-row .form-group {
            flex: 1;
        }

        .modal-body {
            max-height: 75vh;
            overflow-y: auto;
            padding: 0;
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
        }

        .modal-body::-webkit-scrollbar {
            width: 6px;
        }

        .modal-body::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .modal-body::-webkit-scrollbar-thumb {
            background: var(--teal);
            border-radius: 3px;
        }

        .modal-body::-webkit-scrollbar-thumb:hover {
            background: var(--gold);
        }

        .loading-spinner {
            display: inline-block;
            width: 1.5rem;
            height: 1.5rem;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            top: 6rem;
            right: 1.5rem;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            color: white;
            font-weight: 500;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        .notification.success {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .notification.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .notification.warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .notification.info {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.2);
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--teal);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        .optional-section {
            opacity: 0.6;
            transition: opacity 0.3s ease;
        }

        .optional-section.active {
            opacity: 1;
        }

        .refresh-indicator {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 1rem;
            height: 1rem;
            border-radius: 50%;
            background-color: #10b981;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
            }
        }

        .payment-status-card {
            position: relative;
            overflow: hidden;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: transform 0.3s ease;
        }

        .payment-status-card:hover {
            transform: translateY(-5px);
        }

        .payment-status-card.success {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .payment-status-card.pending {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .payment-status-card.failed {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .customer-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--teal);
        }

        .tab-active {
            border-bottom: 3px solid var(--teal);
            color: var(--teal);
        }

        .auto-refresh {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--teal);
            color: white;
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(13, 148, 136, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 40;
        }

        .auto-refresh:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(13, 148, 136, 0.5);
        }

        .auto-refresh.rotating i {
            animation: spin 1s linear infinite;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            padding-left: 2.5rem;
        }

        .search-box::before {
            content: "\f002";
            font-family: "Font Awesome 5 Free";
            font-weight: 900;
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.7);
        }

        .filter-section {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .filter-section select, .filter-section input {
            padding: 0.5rem;
            border-radius: 0.375rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .pagination button {
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
        }

        .pagination button:hover {
            background: rgba(13, 148, 136, 0.3);
        }

        .pagination button.active {
            background: var(--teal);
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: rgba(255, 255, 255, 0.4);
        }

        /* Responsive adjustments */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                z-index: 40;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            main {
                margin-left: 0;
            }

            .mobile-menu-btn {
                display: block;
            }
        }

        @media (min-width: 1025px) {
            .mobile-menu-btn {
                display: none;
            }
        }

        /* Loading skeleton */
        .skeleton {
            background: linear-gradient(90deg, rgba(255,255,255,0.05) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .skeleton-text {
            height: 0.8rem;
            margin-bottom: 0.5rem;
            border-radius: 0.25rem;
        }

        .skeleton-title {
            height: 1.2rem;
            margin-bottom: 1rem;
            border-radius: 0.25rem;
            width: 40%;
        }

        /* Chart container */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        /* Mobile menu button */
        .mobile-menu-btn {
            position: fixed;
            bottom: 2rem;
            left: 2rem;
            background: var(--teal);
            color: white;
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(13, 148, 136, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 40;
        }

        .mobile-menu-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(13, 148, 136, 0.5);
        }

        /* Tour wizard styles */
        .wizard-step {
            display: none;
        }

        .wizard-step.active {
            display: block;
        }

        .wizard-progress {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
        }

        .wizard-step-indicator {
            flex: 1;
            text-align: center;
            position: relative;
        }

        .wizard-step-indicator::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 0;
            right: 0;
            height: 2px;
            background: rgba(255, 255, 255, 0.2);
            z-index: 0;
        }

        .wizard-step-indicator:last-child::before {
            display: none;
        }

        .wizard-step-indicator.active::before {
            background: var(--teal);
        }

        .wizard-step-indicator span {
            display: inline-block;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            line-height: 30px;
            position: relative;
            z-index: 1;
        }

        .wizard-step-indicator.active span {
            background: var(--teal);
        }

        .wizard-step-indicator.completed span {
            background: var(--teal);
        }

        .wizard-step-indicator.completed span::after {
            content: '\f00c';
            font-family: "Font Awesome 5 Free";
            font-weight: 900;
        }

        /* Bulk actions */
        .bulk-actions {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .bulk-actions button {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .bulk-actions button:hover {
            background: rgba(13, 148, 136, 0.3);
        }

        /* Export button */
        .export-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            background: rgba(13, 148, 136, 0.3);
        }

        /* Date range picker */
        .date-range-picker {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .date-range-picker input {
            padding: 0.5rem;
            border-radius: 0.375rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
        }

        /* Tour card */
        .tour-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.75rem;
            overflow: hidden;
            transition: transform 0.3s ease;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .tour-card:hover {
            transform: translateY(-5px);
        }

        .tour-card-image {
            height: 200px;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .tour-card-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .tour-card-content {
            padding: 1.5rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .tour-card-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: white;
        }

        .tour-card-description {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 1rem;
            flex: 1;
        }

        .tour-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .tour-card-price {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--teal);
        }

        .tour-card-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Responsive grid */
        .responsive-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        /* Dark mode specific styles */
        body.dark {
            background: linear-gradient(135deg, #0f172a, #020617);
        }

        body.dark .glass {
            background: rgba(2, 6, 23, 0.8);
        }
    </style>
</head>
<body x-data="officeManagerApp()" :class="{ 'dark': darkMode }" class="min-h-screen transition-colors">

<!-- Header -->
<header class="fixed inset-x-0 top-0 z-50 flex items-center justify-between px-6 py-4 shadow-lg glass">
    <div class="flex items-center gap-3">
        <button @click="mobileMenuOpen = !mobileMenuOpen" class="mobile-menu-btn lg:hidden">
            <i class="fas fa-bars text-white text-xl"></i>
        </button>
        <!-- Logo -->
        <img src="https://i.ibb.co/BVPgM8Kg/logo.png" alt="Safari Adventures Kenya" class="h-10 w-auto">
        <h2 class="text-2xl font-bold text-white">The Office Manager</h2>
    </div>

    <div class="flex items-center gap-6">
        <button @click="darkMode = !darkMode" class="flex items-center gap-2 px-3 py-2 rounded-lg glass hover:scale-105 transition">
            <i class="fas" :class="darkMode ? 'fa-sun text-yellow-400' : 'fa-moon text-amber-500'"></i>
            <span x-text="darkMode ? 'Light' : 'Dark'"></span>
        </button>

        <div class="flex items-center gap-3">
            <div class="text-right">
                <p class="font-semibold text-white">{{ driver.user.get_full_name|default:driver.user.username }}</p>
                <span class="text-sm px-2 py-1 rounded-full text-white"
                      :class="dashboardData && dashboardData.driver.available ? 'bg-teal-500' : 'bg-amber-500'">
                    <span x-text="dashboardData && dashboardData.driver.available ? 'Available' : 'Unavailable'"></span>
                </span>
            </div>
            <img src="{% if driver.profile_picture %}{{ driver.profile_picture.url }}{% else %}{% static 'images/default_profile.png' %}{% endif %}"
                 class="w-11 h-11 rounded-full border-2 border-teal-500 shadow-lg object-cover"
                 alt="Driver avatar">
        </div>
    </div>
</header>

<!-- Alpine + Transition plugin -->
<script src="https://unpkg.com/alpinejs" defer></script>
<script src="https://unpkg.com/@alpinejs/transition" defer></script>

<!-- Notification with Icons -->
<div x-data="{ notification: null, autoRefresh: false, loading: false }">
    <!-- Notification Box -->
    <div x-show="notification"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 transform translate-x-full"
         x-transition:enter-end="opacity-100 transform translate-x-0"
         x-transition:leave="transition ease-in duration-300"
         x-transition:leave-start="opacity-100 transform translate-x-0"
         x-transition:leave-end="opacity-0 transform translate-x-full"
         class="fixed top-6 right-6 z-50 px-6 py-4 rounded-lg shadow-lg max-w-sm flex items-center gap-3"
         :class="{
             'bg-gradient-to-r from-green-500 to-green-600 text-white': notification && notification.type === 'success',
             'bg-gradient-to-r from-red-500 to-red-600 text-white': notification && notification.type === 'error',
             'bg-gradient-to-r from-yellow-500 to-yellow-600 text-white': notification && notification.type === 'warning',
             'bg-gradient-to-r from-blue-500 to-blue-600 text-white': notification && notification.type === 'info'
         }">
        <i :class="{
            'fas fa-check-circle': notification && notification.type === 'success',
            'fas fa-exclamation-circle': notification && notification.type === 'error',
            'fas fa-exclamation-triangle': notification && notification.type === 'warning',
            'fas fa-info-circle': notification && notification.type === 'info'
        }" class="text-xl"></i>
        <span x-text="notification && notification.message"></span>
    </div>

    <!-- Auto Refresh Button -->
    <div class="auto-refresh cursor-pointer mt-4"
         :class="{ 'rotating': loading }"
         @click="toggleAutoRefresh()"
         :title="autoRefresh ? 'Disable auto refresh' : 'Enable auto refresh'">
        <i :class="autoRefresh ? 'fas fa-sync' : 'fas fa-sync-alt'"></i>
    </div>
</div>

<style>
/* Simple rotate animation for the refresh button */
.rotating i {
    animation: spin 1s linear infinite;
}
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>


<!-- Sidebar -->
<aside class="sidebar w-64 h-screen fixed left-0 top-0 pt-20 glass text-white"
       :class="{ 'open': mobileMenuOpen }"
       @click.away="mobileMenuOpen = false">
    <nav class="p-6 space-y-2">
        <h3 class="uppercase text-xs tracking-widest text-gray-300 mb-3">Main</h3>
        <a href="#dashboard" @click="currentSection = 'dashboard'; mobileMenuOpen = false" class="nav-link" :class="currentSection === 'dashboard' ? 'active' : ''">
            <i class="fas fa-tachometer-alt"></i><span>Dashboard</span>
        </a>
        <a href="#earnings" @click="currentSection = 'earnings'; mobileMenuOpen = false" class="nav-link" :class="currentSection === 'earnings' ? 'active' : ''">
            <i class="fas fa-chart-line"></i><span>Earnings</span>
        </a>
        <a href="#schedule" @click="currentSection = 'schedule'; mobileMenuOpen = false" class="nav-link" :class="currentSection === 'schedule' ? 'active' : ''">
            <i class="fas fa-calendar-alt"></i><span>Schedule</span>
        </a>

        <h3 class="uppercase text-xs tracking-widest text-gray-300 mt-8 mb-3">Tours</h3>
        <a href="#tours" @click="currentSection = 'tours'; mobileMenuOpen = false" class="nav-link" :class="currentSection === 'tours' ? 'active' : ''">
            <i class="fas fa-mountain"></i><span>My Tours</span>
        </a>
        <a href="#customers" @click="currentSection = 'customers'; mobileMenuOpen = false" class="nav-link" :class="currentSection === 'customers' ? 'active' : ''">
            <i class="fas fa-users"></i><span>Customers</span>
        </a>
        <a href="#profile" @click="currentSection = 'profile'; mobileMenuOpen = false" class="nav-link" :class="currentSection === 'profile' ? 'active' : ''">
            <i class="fas fa-user-cog"></i><span>Profile</span>
        </a>
        <a href="#ratings" @click="currentSection = 'ratings'; mobileMenuOpen = false" class="nav-link" :class="currentSection === 'ratings' ? 'active' : ''">
            <i class="fas fa-star"></i><span>Ratings</span>
        </a>

        <h3 class="uppercase text-xs tracking-widest text-gray-300 mt-8 mb-3">Admin</h3>
        <a href="#booking-customers" @click="currentSection = 'booking-customers'; mobileMenuOpen = false" class="nav-link" :class="currentSection === 'booking-customers' ? 'active' : ''">
            <i class="fas fa-user-friends"></i><span>Booking Customers</span>
        </a>
        <a href="#bookings" @click="currentSection = 'bookings'; mobileMenuOpen = false" class="nav-link" :class="currentSection === 'bookings' ? 'active' : ''">
            <i class="fas fa-clipboard-list"></i><span>Bookings</span>
        </a>
        <a href="#contact-messages" @click="currentSection = 'contact-messages'; mobileMenuOpen = false" class="nav-link" :class="currentSection === 'contact-messages' ? 'active' : ''">
            <i class="fas fa-envelope"></i><span>Contact Messages</span>
        </a>
        <a href="#destinations" @click="currentSection = 'destinations'; mobileMenuOpen = false" class="nav-link" :class="currentSection === 'destinations' ? 'active' : ''">
            <i class="fas fa-map-marker-alt"></i><span>Destinations</span>
        </a>
        <a href="#drivers" @click="currentSection = 'drivers'; mobileMenuOpen = false" class="nav-link" :class="currentSection === 'drivers' ? 'active' : ''">
            <i class="fas fa-id-card"></i><span>Drivers</span>
        </a>
        <a href="#payments" @click="currentSection = 'payments'; mobileMenuOpen = false" class="nav-link" :class="currentSection === 'payments' ? 'active' : ''">
            <i class="fas fa-money-bill-wave"></i><span>Payments</span>
        </a>
        <a href="#reviews" @click="currentSection = 'reviews'; mobileMenuOpen = false" class="nav-link" :class="currentSection === 'reviews' ? 'active' : ''">
            <i class="fas fa-comments"></i><span>Reviews</span>
        </a>
        <a href="#tour-categories" @click="currentSection = 'tour-categories'; mobileMenuOpen = false" class="nav-link" :class="currentSection === 'tour-categories' ? 'active' : ''">
            <i class="fas fa-tags"></i><span>Tour Categories</span>
        </a>
        <a href="#trips" @click="currentSection = 'trips'; mobileMenuOpen = false" class="nav-link" :class="currentSection === 'trips' ? 'active' : ''">
            <i class="fas fa-route"></i><span>Trips</span>
        </a>
        <a href="#vehicles" @click="currentSection = 'vehicles'; mobileMenuOpen = false" class="nav-link" :class="currentSection === 'vehicles' ? 'active' : ''">
            <i class="fas fa-car"></i><span>Vehicles</span>
        </a>

        <div class="mt-12 glass p-6 rounded-2xl shadow-xl">
            <h3 class="font-semibold mb-3 flex items-center gap-3 text-lg text-white">
                <i class="fas fa-trophy text-gold"></i><span>Driver Rating</span>
            </h3>
            <div class="flex items-center gap-3">
                <div class="text-gold text-xl">
                    <template x-for="i in 5" :key="i">
                        <i :class="i <= (dashboardData ? Math.round(dashboardData.avg_rating) : 0) ? 'fas fa-star' : 'far fa-star'"></i>
                    </template>
                </div>
                <span class="ml-2 font-bold text-xl text-white" x-text="dashboardData ? dashboardData.avg_rating.toFixed(1) : '4.7'"></span>
            </div>
            <p class="text-sm text-gray-300 mt-2" x-text="`${dashboardData ? dashboardData.total_reviews : 0} reviews`"></p>
        </div>
    </nav>
</aside>

<!-- Main Content -->
<main class="ml-0 lg:ml-64 p-6 min-h-screen pt-28">

<!-- Loading Indicator -->
<div x-show="loading" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
    <div class="text-white text-xl flex items-center gap-3 glass p-6 rounded-2xl">
        <div class="loading-spinner"></div>
        Loading dashboard data...
    </div>
</div>

<!-- Dashboard Section -->
<div x-show="currentSection === 'dashboard'" class="space-y-6">
    <!-- Quick Stats -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <!-- Total Earnings -->
        <div class="stat-card" style="background: linear-gradient(135deg, var(--navy), #1e293b);">
            <div class="overlay">
                <div class="refresh-indicator" x-show="autoRefresh"></div>
                <div class="flex justify-between items-start">
                    <div>
                        <p class="opacity-90">Total Earnings</p>
                        <p class="text-2xl font-bold mt-2" x-text="formatCurrency(dashboardData ? dashboardData.total_earnings : 0)"></p>
                    </div>
                    <div class="p-3 bg-white/20 rounded-full">
                        <i class="fas fa-wallet text-white text-xl"></i>
                    </div>
                </div>
                <div class="mt-4 text-sm text-teal-300">
                    <i class="fas fa-arrow-up mr-1"></i><span x-text="formatCurrency(dashboardData ? dashboardData.monthly_earnings : 0)"></span> this month
                </div>
            </div>
        </div>

        <!-- Completed Trips -->
        <div class="stat-card" style="background: linear-gradient(135deg, var(--teal), #0f766e);">
            <div class="overlay">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="opacity-90">Completed Trips</p>
                        <p class="text-2xl font-bold mt-2" x-text="dashboardData ? dashboardData.completed_trips : 0"></p>
                    </div>
                    <div class="p-3 bg-white/20 rounded-full">
                        <i class="fas fa-check-circle text-white text-xl"></i>
                    </div>
                </div>
                <div class="mt-4 text-sm text-blue-300">
                    <span x-text="`${dashboardData ? dashboardData.completed_trips : 0} total trips`"></span>
                </div>
            </div>
        </div>

        <!-- Monthly Earnings -->
        <div class="stat-card" style="background: linear-gradient(135deg, #4f46e5, #6366f1);">
            <div class="overlay">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="opacity-90">This Month</p>
                        <p class="text-2xl font-bold mt-2" x-text="formatCurrency(dashboardData ? dashboardData.monthly_earnings : 0)"></p>
                    </div>
                    <div class="p-3 bg-white/20 rounded-full">
                        <i class="fas fa-calendar text-white text-xl"></i>
                    </div>
                </div>
                <div class="mt-4 text-sm text-gold">
                    <i class="fas fa-chart-line mr-1"></i><span x-text="new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' })"></span>
                </div>
            </div>
        </div>

        <!-- Active Tours -->
        <div class="stat-card" style="background: linear-gradient(135deg, #b45309, var(--gold));">
            <div class="overlay">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="opacity-90">Active Tours</p>
                        <p class="text-2xl font-bold mt-2" x-text="dashboardData ? dashboardData.active_tours : 0"></p>
                    </div>
                    <div class="p-3 bg-white/20 rounded-full">
                        <i class="fas fa-map-marked-alt text-white text-xl"></i>
                    </div>
                </div>
                <div class="mt-4 text-sm text-purple-300">
                    <span x-text="`${dashboardData ? dashboardData.tour_stats.approved : 0} approved â€¢ ${dashboardData ? dashboardData.tour_stats.total : 0} total`"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Stats -->
    <div class="glass p-6 rounded-2xl bg-cream mb-6">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-semibold text-white">Payment Overview</h3>
            <button @click="initiateWithdrawal()" class="btn-primary">
                <i class="fas fa-money-bill-wave mr-2"></i>Withdraw Funds
            </button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div class="payment-status-card success">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="opacity-90">Total Received</p>
                        <p class="text-2xl font-bold mt-2" x-text="formatCurrency(paymentStats ? paymentStats.total_received : 0)"></p>
                    </div>
                    <div class="p-3 bg-white/20 rounded-full">
                        <i class="fas fa-check-circle text-white text-xl"></i>
                    </div>
                </div>
                <div class="mt-4 text-sm text-green-200">
                    <span x-text="`${paymentStats ? paymentStats.successful_payments : 0} successful payments`"></span>
                </div>
            </div>

            <div class="payment-status-card pending">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="opacity-90">Total Withdrawn</p>
                        <p class="text-2xl font-bold mt-2" x-text="formatCurrency(paymentStats ? paymentStats.total_withdrawn : 0)"></p>
                    </div>
                    <div class="p-3 bg-white/20 rounded-full">
                        <i class="fas fa-money-check text-white text-xl"></i>
                    </div>
                </div>
                <div class="mt-4 text-sm text-yellow-200">
                    <span x-text="`${paymentStats ? paymentStats.pending_withdrawal : 0} pending withdrawal`"></span>
                </div>
            </div>

            <div class="payment-status-card failed">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="opacity-90">Pending Payments</p>
                        <p class="text-2xl font-bold mt-2" x-text="formatCurrency(paymentStats ? paymentStats.pending_payments : 0)"></p>
                    </div>
                    <div class="p-3 bg-white/20 rounded-full">
                        <i class="fas fa-exclamation-circle text-white text-xl"></i>
                    </div>
                </div>
                <div class="mt-4 text-sm text-red-200">
                    <span x-text="`${paymentStats ? paymentStats.failed_payments : 0} failed payments`"></span>
                </div>
            </div>
        </div>

        <!-- Recent Transactions -->
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead>
                    <tr class="border-b border-gray-700">
                        <th class="p-3 text-left text-gray-300">Reference</th>
                        <th class="p-3 text-left text-gray-300">Amount</th>
                        <th class="p-3 text-left text-gray-300">Status</th>
                        <th class="p-3 text-left text-gray-300">Date</th>
                    </tr>
                </thead>
                <tbody>
                    <template x-if="paymentStats && paymentStats.recent_transactions.length > 0">
                        <template x-for="transaction in paymentStats.recent_transactions" :key="transaction.id">
                            <tr class="border-b border-gray-700 hover:bg-teal-900">
                                <td class="p-3 text-white" x-text="transaction.reference"></td>
                                <td class="p-3 text-white" x-text="formatCurrency(transaction.amount)"></td>
                                <td class="p-3">
                                    <span class="px-2 py-1 rounded text-xs font-medium"
                                          :class="{
                                              'bg-green-100 text-green-800': transaction.status === 'SUCCESS',
                                              'bg-yellow-100 text-yellow-800': transaction.status === 'PENDING',
                                              'bg-red-100 text-red-800': transaction.status === 'FAILED'
                                          }"
                                          x-text="transaction.status">
                                    </span>
                                </td>
                                <td class="p-3 text-white" x-text="formatDate(transaction.created_at)"></td>
                            </tr>
                        </template>
                    </template>
                    <template x-if="!paymentStats || paymentStats.recent_transactions.length === 0">
                        <tr>
                            <td colspan="4" class="p-3 text-center text-gray-300">No recent transactions</td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Today's Trips + Upcoming Trips -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Today's Trips -->
        <div class="glass p-6 rounded-2xl bg-cream">
            <h3 class="text-xl font-semibold mb-4 flex items-center gap-2 text-teal-300">
                <i class="fas fa-clock"></i> Today's Trips
            </h3>
            <div class="space-y-3">
                <template x-if="dashboardData && dashboardData.today_trips.length > 0">
                    <template x-for="trip in dashboardData.today_trips" :key="trip.id">
                        <div class="flex items-center justify-between p-3 glass rounded-lg classic-border">
                            <div>
                                <p class="font-semibold text-white" x-text="trip.destination"></p>
                                <p class="text-sm text-gray-300" x-text="`${trip.start_time} - ${trip.end_time}`"></p>
                            </div>
                            <div class="flex gap-2">
                                <form method="POST" :action="`/update-trip-status/${trip.id}/`">
                                    {% csrf_token %}
                                    <template x-if="trip.status === 'SCHEDULED'">
                                        <button type="submit" name="status" value="IN_PROGRESS"
                                                class="px-3 py-1 bg-teal-500 text-white rounded text-sm hover:bg-teal-600">
                                            Start
                                        </button>
                                    </template>
                                    <template x-if="trip.status === 'IN_PROGRESS'">
                                        <button type="submit" name="status" value="COMPLETED"
                                                class="px-3 py-1 bg-teal-700 text-white rounded text-sm hover:bg-teal-800">
                                            Complete
                                        </button>
                                    </template>
                                </form>
                                <span class="px-2 py-1 rounded text-xs font-medium"
                                      :class="{
                                          'bg-teal-100 text-teal-800': trip.status === 'COMPLETED',
                                          'bg-blue-100 text-blue-800': trip.status === 'IN_PROGRESS',
                                          'bg-amber-100 text-amber-800': trip.status === 'SCHEDULED'
                                      }"
                                      x-text="trip.status">
                                </span>
                            </div>
                        </div>
                    </template>
                </template>
                <template x-if="!dashboardData || dashboardData.today_trips.length === 0">
                    <p class="text-gray-300 text-center py-4">No trips scheduled for today</p>
                </template>
            </div>
        </div>

        <!-- Upcoming Trips -->
        <div class="glass p-6 rounded-2xl bg-cream">
            <h3 class="text-xl font-semibold mb-4 flex items-center gap-2 text-white">
                <i class="fas fa-calendar-plus"></i> Upcoming Trips
            </h3>
            <div class="space-y-3">
                <template x-if="dashboardData && dashboardData.upcoming_trips.length > 0">
                    <template x-for="trip in dashboardData.upcoming_trips" :key="trip.id">
                        <div class="flex items-center justify-between p-3 glass rounded-lg classic-border">
                            <div>
                                <p class="font-semibold text-white" x-text="trip.destination"></p>
                                <p class="text-sm text-gray-300" x-text="`${trip.date} â€¢ ${trip.start_time}`"></p>
                            </div>
                            <span class="px-2 py-1 bg-amber-100 text-amber-800 rounded text-xs font-medium">
                                <span x-text="`${Math.ceil((new Date(trip.date) - new Date()) / (1000 * 60 * 60 * 24))} days`"></span>
                            </span>
                        </div>
                    </template>
                </template>
                <template x-if="!dashboardData || dashboardData.upcoming_trips.length === 0">
                    <p class="text-gray-300 text-center py-4">No upcoming trips</p>
                </template>
            </div>
        </div>
    </div>

    <!-- Recent Bookings + Vehicle Status -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
        <!-- Recent Bookings -->
        <div class="glass p-6 rounded-2xl bg-cream">
            <h3 class="text-xl font-semibold mb-4 flex items-center gap-2 text-indigo-300">
                <i class="fas fa-receipt"></i> Recent Bookings
            </h3>
            <div class="space-y-3">
                <template x-if="dashboardData && dashboardData.recent_bookings.length > 0">
                    <template x-for="booking in dashboardData.recent_bookings" :key="booking.id">
                        <div class="p-3 glass rounded-lg classic-border">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="font-semibold text-white" x-text="booking.tour ? booking.tour.name : 'Destination Booking'"></p>
                                    <p class="text-sm text-gray-300" x-text="booking.booking_customer ? booking.booking_customer.full_name : 'Customer'"></p>
                                </div>
                                <span class="px-2 py-1 bg-teal-100 text-teal-800 rounded text-xs font-medium"
                                      x-text="formatCurrency(booking.total_price)">
                                </span>
                            </div>
                            <p class="text-xs text-gray-300 mt-1" x-text="booking.travel_date"></p>
                        </div>
                    </template>
                </template>
                <template x-if="!dashboardData || dashboardData.recent_bookings.length === 0">
                    <p class="text-gray-300 text-center py-4">No recent bookings</p>
                </template>
            </div>
        </div>

        <!-- Vehicle Status -->
        <div x-show="dashboardData && dashboardData.vehicle_status" class="glass p-6 rounded-2xl bg-cream">
            <h3 class="text-xl font-semibold mb-4 flex items-center gap-2 text-amber-300">
                <i class="fas fa-car"></i> Vehicle Status
            </h3>
            <div class="space-y-4">
                <div class="flex justify-between items-center p-3 glass rounded-lg classic-border">
                    <div>
                        <p class="font-semibold text-white" x-text="dashboardData.vehicle_status.name"></p>
                        <p class="text-sm text-gray-300" x-text="dashboardData.vehicle_status.plate"></p>
                    </div>
                    <span class="px-2 py-1 rounded text-xs font-medium"
                          :class="dashboardData.vehicle_status.status === 'ACTIVE' ? 'bg-teal-100 text-teal-800' : 'bg-amber-100 text-amber-800'"
                          x-text="dashboardData.vehicle_status.status">
                    </span>
                </div>
                <div x-show="dashboardData.vehicle_status.next_maintenance" class="p-3 glass rounded-lg border border-amber-200">
                    <p class="text-sm font-medium text-amber-300">
                        <i class="fas fa-tools mr-2"></i>
                        Next Maintenance: <span x-text="dashboardData.vehicle_status.next_maintenance"></span>
                        <span x-show="dashboardData.vehicle_status.maintenance_due" class="ml-2 px-2 py-1 bg-red-100 text-red-800 rounded text-xs">DUE SOON</span>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Booking Customers Section -->
<div x-show="currentSection === 'booking-customers'" class="space-y-6">
    <div class="glass p-6 rounded-2xl bg-cream">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
            <h3 class="text-2xl font-semibold text-white">Booking Customers</h3>
            <div class="flex flex-col sm:flex-row gap-2 w-full md:w-auto">
                <div class="search-box w-full sm:w-auto">
                    <input type="text" placeholder="Search customers..."
                           class="px-3 py-2 rounded-lg glass text-white w-full"
                           x-model="searchQuery"
                           @input.debounce.500ms="updateFilteredData()">
                </div>
                <button @click="openForm('booking-customers')" class="btn-primary">
                    <i class="fas fa-plus mr-2"></i>Add Customer
                </button>
            </div>
        </div>

        <!-- Customer Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-white" x-text="bookingCustomers.length"></p>
                <p class="text-sm text-gray-300">Total Customers</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-teal-300" x-text="bookingCustomers.filter(c => c.total_bookings > 1).length"></p>
                <p class="text-sm text-gray-300">Repeat Customers</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-amber-300" x-text="bookingCustomers.reduce((sum, c) => sum + c.total_bookings, 0)"></p>
                <p class="text-sm text-gray-300">Total Bookings</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-indigo-300" x-text="formatCurrency(bookingCustomers.reduce((sum, c) => sum + parseFloat(c.total_spent || 0), 0))"></p>
                <p class="text-sm text-gray-300">Total Revenue</p>
            </div>
        </div>

        <!-- Filters and Export -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
            <div class="filter-section">
                <select x-model="statusFilter" @change="updateFilteredData()" class="px-3 py-2 rounded-lg glass text-white">
                    <option value="">All Statuses</option>
                    <option value="active">Active</option>
                    <option value="inactive">Inactive</option>
                </select>
                <select x-model="dateFilter" @change="updateFilteredData()" class="px-3 py-2 rounded-lg glass text-white">
                    <option value="">All Time</option>
                    <option value="today">Today</option>
                    <option value="week">This Week</option>
                    <option value="month">This Month</option>
                    <option value="year">This Year</option>
                </select>
            </div>
            <div class="export-btn" @click="exportData('booking-customers')">
                <i class="fas fa-download"></i>
                <span>Export</span>
            </div>
        </div>

        <!-- Customer List -->
        <div class="overflow-x-auto">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox" x-model="selectAll" @change="toggleSelectAll()">
                        </th>
                        <th>ID</th>
                        <th>Full Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Total Bookings</th>
                        <th>Total Spent</th>
                        <th>Last Booking</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <template x-for="customer in getPaginatedData('bookingCustomers')" :key="customer.id">
                        <tr>
                            <td>
                                <input type="checkbox" :value="customer.id" x-model="selectedItems">
                            </td>
                            <td x-text="customer.id"></td>
                            <td x-text="customer.full_name"></td>
                            <td x-text="customer.email"></td>
                            <td x-text="customer.phone_number"></td>
                            <td x-text="customer.total_bookings || 0"></td>
                            <td x-text="formatCurrency(customer.total_spent || 0)"></td>
                            <td x-text="customer.last_booking ? formatDate(customer.last_booking) : 'Never'"></td>
                            <td>
                                <button @click="openForm('booking-customers', customer)" class="action-btn edit-btn">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button @click="deleteItem('booking-customers', customer.id)" class="action-btn delete-btn">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </template>
                    <template x-if="getPaginatedData('bookingCustomers').length === 0">
                        <tr>
                            <td colspan="9" class="text-center py-4 text-gray-300">No customers found</td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>

        <!-- Bulk Actions (only visible when items are selected) -->
        <div x-show="selectedItems.length > 0" class="bulk-actions mt-4">
            <button @click="bulkDelete('booking-customers')" class="bg-red-500 hover:bg-red-600">
                <i class="fas fa-trash"></i> Delete Selected
            </button>
            <button @click="bulkExport('booking-customers')" class="bg-teal-500 hover:bg-teal-600">
                <i class="fas fa-download"></i> Export Selected
            </button>
        </div>

        <!-- Pagination -->
        <div class="flex flex-col md:flex-row justify-between items-center mt-6 gap-4">
            <div class="text-sm text-gray-300">
                Showing <span x-text="(currentPage - 1) * itemsPerPage + 1"></span> to
                <span x-text="Math.min(currentPage * itemsPerPage, totalItems)"></span> of
                <span x-text="totalItems"></span> entries
            </div>
            <div class="pagination">
                <button
                    @click="changePage(currentPage - 1)"
                    :disabled="currentPage === 1"
                    class="px-3 py-1 rounded-lg">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <template x-for="page in getVisiblePages()" :key="page">
                    <button
                        @click="changePage(page)"
                        :class="page === currentPage ? 'active' : ''"
                        x-text="page">
                    </button>
                </template>
                <button
                    @click="changePage(currentPage + 1)"
                    :disabled="currentPage === Math.ceil(totalItems / itemsPerPage)"
                    class="px-3 py-1 rounded-lg">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <div class="flex items-center gap-2">
                <span class="text-sm text-gray-300">Items per page:</span>
                <select x-model="itemsPerPage" @change="changePage(1)" class="px-2 py-1 rounded-lg glass text-white">
                    <option value="5">5</option>
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                </select>
            </div>
        </div>
    </div>
</div>

<!-- Bookings Section -->
<div x-show="currentSection === 'bookings'" class="space-y-6">
    <div class="glass p-6 rounded-2xl bg-cream">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
            <h3 class="text-2xl font-semibold text-white">Bookings</h3>
            <div class="flex flex-col sm:flex-row gap-2 w-full md:w-auto">
                <div class="search-box w-full sm:w-auto">
                    <input type="text" placeholder="Search bookings..."
                           class="px-3 py-2 rounded-lg glass text-white w-full"
                           x-model="searchQuery"
                           @input.debounce.500ms="updateFilteredData()">
                </div>
                <select x-model="statusFilter" @change="updateFilteredData()" class="px-3 py-2 rounded-lg glass text-white">
                    <option value="">All Statuses</option>
                    <option value="CONFIRMED">Confirmed</option>
                    <option value="PENDING">Pending</option>
                    <option value="CANCELLED">Cancelled</option>
                </select>
                <button @click="openForm('bookings')" class="btn-primary">
                    <i class="fas fa-plus mr-2"></i>Add Booking
                </button>
            </div>
        </div>

        <!-- Booking Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-white" x-text="bookings.length"></p>
                <p class="text-sm text-gray-300">Total Bookings</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-teal-300" x-text="bookings.filter(b => b.status === 'CONFIRMED').length"></p>
                <p class="text-sm text-gray-300">Confirmed</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-amber-300" x-text="bookings.filter(b => b.status === 'PENDING').length"></p>
                <p class="text-sm text-gray-300">Pending</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-indigo-300" x-text="formatCurrency(bookings.reduce((sum, b) => sum + parseFloat(b.total_price || 0), 0))"></p>
                <p class="text-sm text-gray-300">Total Revenue</p>
            </div>
        </div>

        <!-- Date Range Filter -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
            <div class="date-range-picker">
                <span class="text-sm text-gray-300 mr-2">From:</span>
                <input type="date" x-model="dateRange.start" @change="updateFilteredData()" class="px-3 py-2 rounded-lg glass text-white">
                <span class="text-sm text-gray-300 mx-2">To:</span>
                <input type="date" x-model="dateRange.end" @change="updateFilteredData()" class="px-3 py-2 rounded-lg glass text-white">
            </div>
            <div class="export-btn" @click="exportData('bookings')">
                <i class="fas fa-download"></i>
                <span>Export</span>
            </div>
        </div>

        <!-- Bookings List -->
        <div class="overflow-x-auto">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox" x-model="selectAll" @change="toggleSelectAll()">
                        </th>
                        <th>ID</th>
                        <th>Customer</th>
                        <th>Tour</th>
                        <th>Travel Date</th>
                        <th>Adults</th>
                        <th>Children</th>
                        <th>Total Price</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <template x-for="booking in getPaginatedData('bookings')" :key="booking.id">
                        <tr>
                            <td>
                                <input type="checkbox" :value="booking.id" x-model="selectedItems">
                            </td>
                            <td x-text="booking.id"></td>
                            <td x-text="booking.booking_customer ? booking.booking_customer.full_name : 'N/A'"></td>
                            <td x-text="booking.tour ? booking.tour.title : 'N/A'"></td>
                            <td x-text="formatDate(booking.travel_date)"></td>
                            <td x-text="booking.num_adults"></td>
                            <td x-text="booking.num_children"></td>
                            <td x-text="formatCurrency(booking.total_price)"></td>
                            <td>
                                <span class="status-badge"
                                      :class="{
                                          'status-active': booking.status === 'CONFIRMED',
                                          'status-pending': booking.status === 'PENDING',
                                          'status-inactive': booking.status === 'CANCELLED'
                                      }"
                                      x-text="booking.status">
                                </span>
                            </td>
                            <td>
                                <button @click="openForm('bookings', booking)" class="action-btn edit-btn">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button @click="deleteItem('bookings', booking.id)" class="action-btn delete-btn">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </template>
                    <template x-if="getPaginatedData('bookings').length === 0">
                        <tr>
                            <td colspan="10" class="text-center py-4 text-gray-300">No bookings found</td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>

        <!-- Bulk Actions (only visible when items are selected) -->
        <div x-show="selectedItems.length > 0" class="bulk-actions mt-4">
            <button @click="bulkUpdateStatus('bookings', 'CONFIRMED')" class="bg-teal-500 hover:bg-teal-600">
                <i class="fas fa-check"></i> Mark Confirmed
            </button>
            <button @click="bulkUpdateStatus('bookings', 'CANCELLED')" class="bg-red-500 hover:bg-red-600">
                <i class="fas fa-times"></i> Mark Cancelled
            </button>
            <button @click="bulkDelete('bookings')" class="bg-red-500 hover:bg-red-600">
                <i class="fas fa-trash"></i> Delete Selected
            </button>
            <button @click="bulkExport('bookings')" class="bg-teal-500 hover:bg-teal-600">
                <i class="fas fa-download"></i> Export Selected
            </button>
        </div>

        <!-- Pagination -->
        <div class="flex flex-col md:flex-row justify-between items-center mt-6 gap-4">
            <div class="text-sm text-gray-300">
                Showing <span x-text="(currentPage - 1) * itemsPerPage + 1"></span> to
                <span x-text="Math.min(currentPage * itemsPerPage, totalItems)"></span> of
                <span x-text="totalItems"></span> entries
            </div>
            <div class="pagination">
                <button
                    @click="changePage(currentPage - 1)"
                    :disabled="currentPage === 1"
                    class="px-3 py-1 rounded-lg">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <template x-for="page in getVisiblePages()" :key="page">
                    <button
                        @click="changePage(page)"
                        :class="page === currentPage ? 'active' : ''"
                        x-text="page">
                    </button>
                </template>
                <button
                    @click="changePage(currentPage + 1)"
                    :disabled="currentPage === Math.ceil(totalItems / itemsPerPage)"
                    class="px-3 py-1 rounded-lg">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <div class="flex items-center gap-2">
                <span class="text-sm text-gray-300">Items per page:</span>
                <select x-model="itemsPerPage" @change="changePage(1)" class="px-2 py-1 rounded-lg glass text-white">
                    <option value="5">5</option>
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                </select>
            </div>
        </div>
    </div>
</div>

<!-- Contact Messages Section -->
<div x-show="currentSection === 'contact-messages'" class="space-y-6">
    <div class="glass p-6 rounded-2xl bg-cream">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
            <h3 class="text-2xl font-semibold text-white">Contact Messages</h3>
            <div class="flex flex-col sm:flex-row gap-2 w-full md:w-auto">
                <div class="search-box w-full sm:w-auto">
                    <input type="text" placeholder="Search messages..."
                           class="px-3 py-2 rounded-lg glass text-white w-full"
                           x-model="searchQuery"
                           @input.debounce.500ms="updateFilteredData()">
                </div>
                <button @click="resetFilters()" class="btn-primary">
                    <i class="fas fa-sync mr-2"></i>Reset
                </button>
            </div>
        </div>

        <!-- Message Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-white" x-text="contactMessages.length"></p>
                <p class="text-sm text-gray-300">Total Messages</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-teal-300" x-text="contactMessages.filter(m => m.is_read).length"></p>
                <p class="text-sm text-gray-300">Read</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-amber-300" x-text="contactMessages.filter(m => !m.is_read).length"></p>
                <p class="text-sm text-gray-300">Unread</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-indigo-300" x-text="contactMessages.filter(m => m.is_replied).length"></p>
                <p class="text-sm text-gray-300">Replied</p>
            </div>
        </div>

        <!-- Messages List -->
        <div class="overflow-x-auto">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox" x-model="selectAll" @change="toggleSelectAll()">
                        </th>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Subject</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <template x-for="message in getPaginatedData('contactMessages')" :key="message.id">
                        <tr>
                            <td>
                                <input type="checkbox" :value="message.id" x-model="selectedItems">
                            </td>
                            <td x-text="message.id"></td>
                            <td x-text="message.name"></td>
                            <td x-text="message.email"></td>
                            <td x-text="message.phone"></td>
                            <td x-text="message.subject"></td>
                            <td x-text="formatDateTime(message.created_at)"></td>
                            <td>
                                <span class="status-badge"
                                      :class="{
                                          'status-active': message.is_read,
                                          'status-pending': !message.is_read
                                      }"
                                      x-text="message.is_read ? 'Read' : 'Unread'">
                                </span>
                            </td>
                            <td>
                                <button @click="openForm('contact-messages', message)" class="action-btn view-btn">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button @click="deleteItem('contact-messages', message.id)" class="action-btn delete-btn">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </template>
                    <template x-if="getPaginatedData('contactMessages').length === 0">
                        <tr>
                            <td colspan="9" class="text-center py-4 text-gray-300">No messages found</td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>

        <!-- Bulk Actions (only visible when items are selected) -->
        <div x-show="selectedItems.length > 0" class="bulk-actions mt-4">
            <button @click="bulkMarkAsRead('contact-messages')" class="bg-teal-500 hover:bg-teal-600">
                <i class="fas fa-envelope-open"></i> Mark as Read
            </button>
            <button @click="bulkMarkAsUnread('contact-messages')" class="bg-amber-500 hover:bg-amber-600">
                <i class="fas fa-envelope"></i> Mark as Unread
            </button>
            <button @click="bulkDelete('contact-messages')" class="bg-red-500 hover:bg-red-600">
                <i class="fas fa-trash"></i> Delete Selected
            </button>
        </div>

        <!-- Pagination -->
        <div class="flex flex-col md:flex-row justify-between items-center mt-6 gap-4">
            <div class="text-sm text-gray-300">
                Showing <span x-text="(currentPage - 1) * itemsPerPage + 1"></span> to
                <span x-text="Math.min(currentPage * itemsPerPage, totalItems)"></span> of
                <span x-text="totalItems"></span> entries
            </div>
            <div class="pagination">
                <button
                    @click="changePage(currentPage - 1)"
                    :disabled="currentPage === 1"
                    class="px-3 py-1 rounded-lg">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <template x-for="page in getVisiblePages()" :key="page">
                    <button
                        @click="changePage(page)"
                        :class="page === currentPage ? 'active' : ''"
                        x-text="page">
                    </button>
                </template>
                <button
                    @click="changePage(currentPage + 1)"
                    :disabled="currentPage === Math.ceil(totalItems / itemsPerPage)"
                    class="px-3 py-1 rounded-lg">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <div class="flex items-center gap-2">
                <span class="text-sm text-gray-300">Items per page:</span>
                <select x-model="itemsPerPage" @change="changePage(1)" class="px-2 py-1 rounded-lg glass text-white">
                    <option value="5">5</option>
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                </select>
            </div>
        </div>
    </div>
</div>

<!-- Destinations Section -->
<div x-show="currentSection === 'destinations'" class="space-y-6">
    <div class="glass p-6 rounded-2xl bg-cream">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
            <h3 class="text-2xl font-semibold text-white">Destinations</h3>
            <div class="flex flex-col sm:flex-row gap-2 w-full md:w-auto">
                <div class="search-box w-full sm:w-auto">
                    <input type="text" placeholder="Search destinations..."
                           class="px-3 py-2 rounded-lg glass text-white w-full"
                           x-model="searchQuery"
                           @input.debounce.500ms="updateFilteredData()">
                </div>
                <button @click="openForm('destinations')" class="btn-primary">
                    <i class="fas fa-plus mr-2"></i>Add Destination
                </button>
            </div>
        </div>

        <!-- Destination Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-white" x-text="destinations.length"></p>
                <p class="text-sm text-gray-300">Total Destinations</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-teal-300" x-text="destinations.filter(d => d.is_active).length"></p>
                <p class="text-sm text-gray-300">Active</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-amber-300" x-text="destinations.filter(d => !d.is_active).length"></p>
                <p class="text-sm text-gray-300">Inactive</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-indigo-300" x-text="destinations.reduce((max, d) => max > d.tour_count ? max : d.tour_count, 0)"></p>
                <p class="text-sm text-gray-300">Max Tours</p>
            </div>
        </div>

        <!-- Destinations List -->
        <div class="overflow-x-auto">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox" x-model="selectAll" @change="toggleSelectAll()">
                        </th>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Description</th>
                        <th>Image</th>
                        <th>Tours Count</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <template x-for="destination in getPaginatedData('destinations')" :key="destination.id">
                        <tr>
                            <td>
                                <input type="checkbox" :value="destination.id" x-model="selectedItems">
                            </td>
                            <td x-text="destination.id"></td>
                            <td x-text="destination.name"></td>
                            <td x-text="destination.description ? destination.description.substring(0, 50) + '...' : 'N/A'"></td>
                            <td>
                                <img x-show="destination.image" :src="destination.image" class="w-10 h-10 object-cover rounded" alt="Destination image">
                                <span x-show="!destination.image" class="text-gray-400">No image</span>
                            </td>
                            <td x-text="destination.tour_count || 0"></td>
                            <td>
                                <span class="status-badge"
                                      :class="{
                                          'status-active': destination.is_active,
                                          'status-inactive': !destination.is_active
                                      }"
                                      x-text="destination.is_active ? 'Active' : 'Inactive'">
                                </span>
                            </td>
                            <td>
                                <button @click="openForm('destinations', destination)" class="action-btn edit-btn">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button @click="deleteItem('destinations', destination.id)" class="action-btn delete-btn">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </template>
                    <template x-if="getPaginatedData('destinations').length === 0">
                        <tr>
                            <td colspan="8" class="text-center py-4 text-gray-300">No destinations found</td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>

        <!-- Bulk Actions (only visible when items are selected) -->
        <div x-show="selectedItems.length > 0" class="bulk-actions mt-4">
            <button @click="bulkActivate('destinations')" class="bg-teal-500 hover:bg-teal-600">
                <i class="fas fa-check"></i> Activate Selected
            </button>
            <button @click="bulkDeactivate('destinations')" class="bg-amber-500 hover:bg-amber-600">
                <i class="fas fa-pause"></i> Deactivate Selected
            </button>
            <button @click="bulkDelete('destinations')" class="bg-red-500 hover:bg-red-600">
                <i class="fas fa-trash"></i> Delete Selected
            </button>
        </div>

        <!-- Pagination -->
        <div class="flex flex-col md:flex-row justify-between items-center mt-6 gap-4">
            <div class="text-sm text-gray-300">
                Showing <span x-text="(currentPage - 1) * itemsPerPage + 1"></span> to
                <span x-text="Math.min(currentPage * itemsPerPage, totalItems)"></span> of
                <span x-text="totalItems"></span> entries
            </div>
            <div class="pagination">
                <button
                    @click="changePage(currentPage - 1)"
                    :disabled="currentPage === 1"
                    class="px-3 py-1 rounded-lg">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <template x-for="page in getVisiblePages()" :key="page">
                    <button
                        @click="changePage(page)"
                        :class="page === currentPage ? 'active' : ''"
                        x-text="page">
                    </button>
                </template>
                <button
                    @click="changePage(currentPage + 1)"
                    :disabled="currentPage === Math.ceil(totalItems / itemsPerPage)"
                    class="px-3 py-1 rounded-lg">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <div class="flex items-center gap-2">
                <span class="text-sm text-gray-300">Items per page:</span>
                <select x-model="itemsPerPage" @change="changePage(1)" class="px-2 py-1 rounded-lg glass text-white">
                    <option value="5">5</option>
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                </select>
            </div>
        </div>
    </div>
</div>

<!-- Drivers Section -->
<div x-show="currentSection === 'drivers'" class="space-y-6">
    <div class="glass p-6 rounded-2xl bg-cream">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
            <h3 class="text-2xl font-semibold text-white">Drivers</h3>
            <div class="flex flex-col sm:flex-row gap-2 w-full md:w-auto">
                <div class="search-box w-full sm:w-auto">
                    <input type="text" placeholder="Search drivers..."
                           class="px-3 py-2 rounded-lg glass text-white w-full"
                           x-model="searchQuery"
                           @input.debounce.500ms="updateFilteredData()">
                </div>
                <select x-model="statusFilter" @change="updateFilteredData()" class="px-3 py-2 rounded-lg glass text-white">
                    <option value="">All Statuses</option>
                    <option value="AVAILABLE">Available</option>
                    <option value="UNAVAILABLE">Unavailable</option>
                </select>
                <button @click="openForm('drivers')" class="btn-primary">
                    <i class="fas fa-plus mr-2"></i>Add Driver
                </button>
            </div>
        </div>

        <!-- Driver Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-white" x-text="drivers.length"></p>
                <p class="text-sm text-gray-300">Total Drivers</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-teal-300" x-text="drivers.filter(d => d.available).length"></p>
                <p class="text-sm text-gray-300">Available</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-amber-300" x-text="drivers.filter(d => d.is_verified).length"></p>
                <p class="text-sm text-gray-300">Verified</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-indigo-300" x-text="formatCurrency(drivers.reduce((sum, d) => sum + parseFloat(d.earnings || 0), 0))"></p>
                <p class="text-sm text-gray-300">Total Earnings</p>
            </div>
        </div>

        <!-- Drivers List -->
        <div class="overflow-x-auto">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox" x-model="selectAll" @change="toggleSelectAll()">
                        </th>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>License</th>
                        <th>Rating</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <template x-for="driver in getPaginatedData('drivers')" :key="driver.id">
                        <tr>
                            <td>
                                <input type="checkbox" :value="driver.id" x-model="selectedItems">
                            </td>
                            <td x-text="driver.id"></td>
                            <td x-text="driver.user ? driver.user.get_full_name : 'N/A'"></td>
                            <td x-text="driver.user ? driver.user.email : 'N/A'"></td>
                            <td x-text="driver.phone_number"></td>
                            <td x-text="driver.license_number"></td>
                            <td>
                                <div class="flex items-center">
                                    <span class="text-gold mr-1" x-text="driver.rating ? driver.rating.toFixed(1) : 'N/A'"></span>
                                    <i class="fas fa-star text-gold text-xs"></i>
                                </div>
                            </td>
                            <td>
                                <span class="status-badge"
                                      :class="{
                                          'status-active': driver.available,
                                          'status-inactive': !driver.available
                                      }"
                                      x-text="driver.available ? 'Available' : 'Unavailable'">
                                </span>
                            </td>
                            <td>
                                <button @click="openForm('drivers', driver)" class="action-btn edit-btn">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button @click="deleteItem('drivers', driver.id)" class="action-btn delete-btn">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </template>
                    <template x-if="getPaginatedData('drivers').length === 0">
                        <tr>
                            <td colspan="9" class="text-center py-4 text-gray-300">No drivers found</td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>

        <!-- Bulk Actions (only visible when items are selected) -->
        <div x-show="selectedItems.length > 0" class="bulk-actions mt-4">
            <button @click="bulkSetAvailability('drivers', true)" class="bg-teal-500 hover:bg-teal-600">
                <i class="fas fa-check"></i> Set Available
            </button>
            <button @click="bulkSetAvailability('drivers', false)" class="bg-amber-500 hover:bg-amber-600">
                <i class="fas fa-pause"></i> Set Unavailable
            </button>
            <button @click="bulkVerify('drivers')" class="bg-indigo-500 hover:bg-indigo-600">
                <i class="fas fa-check-circle"></i> Verify Selected
            </button>
            <button @click="bulkDelete('drivers')" class="bg-red-500 hover:bg-red-600">
                <i class="fas fa-trash"></i> Delete Selected
            </button>
        </div>

        <!-- Pagination -->
        <div class="flex flex-col md:flex-row justify-between items-center mt-6 gap-4">
            <div class="text-sm text-gray-300">
                Showing <span x-text="(currentPage - 1) * itemsPerPage + 1"></span> to
                <span x-text="Math.min(currentPage * itemsPerPage, totalItems)"></span> of
                <span x-text="totalItems"></span> entries
            </div>
            <div class="pagination">
                <button
                    @click="changePage(currentPage - 1)"
                    :disabled="currentPage === 1"
                    class="px-3 py-1 rounded-lg">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <template x-for="page in getVisiblePages()" :key="page">
                    <button
                        @click="changePage(page)"
                        :class="page === currentPage ? 'active' : ''"
                        x-text="page">
                    </button>
                </template>
                <button
                    @click="changePage(currentPage + 1)"
                    :disabled="currentPage === Math.ceil(totalItems / itemsPerPage)"
                    class="px-3 py-1 rounded-lg">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <div class="flex items-center gap-2">
                <span class="text-sm text-gray-300">Items per page:</span>
                <select x-model="itemsPerPage" @change="changePage(1)" class="px-2 py-1 rounded-lg glass text-white">
                    <option value="5">5</option>
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                </select>
            </div>
        </div>
    </div>
</div>

<!-- Payments Section -->
<div x-show="currentSection === 'payments'" class="space-y-6">
    <div class="glass p-6 rounded-2xl bg-cream">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
            <h3 class="text-2xl font-semibold text-white">Payments</h3>
            <div class="flex flex-col sm:flex-row gap-2 w-full md:w-auto">
                <div class="search-box w-full sm:w-auto">
                    <input type="text" placeholder="Search payments..."
                           class="px-3 py-2 rounded-lg glass text-white w-full"
                           x-model="searchQuery"
                           @input.debounce.500ms="updateFilteredData()">
                </div>
                <select x-model="statusFilter" @change="updateFilteredData()" class="px-3 py-2 rounded-lg glass text-white">
                    <option value="">All Statuses</option>
                    <option value="SUCCESS">Success</option>
                    <option value="PENDING">Pending</option>
                    <option value="FAILED">Failed</option>
                </select>
                <button @click="openForm('payments')" class="btn-primary">
                    <i class="fas fa-plus mr-2"></i>Add Payment
                </button>
            </div>
        </div>

        <!-- Payment Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-white" x-text="payments.length"></p>
                <p class="text-sm text-gray-300">Total Payments</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-teal-300" x-text="payments.filter(p => p.status === 'SUCCESS').length"></p>
                <p class="text-sm text-gray-300">Successful</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-amber-300" x-text="payments.filter(p => p.status === 'PENDING').length"></p>
                <p class="text-sm text-gray-300">Pending</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-indigo-300" x-text="formatCurrency(payments.reduce((sum, p) => sum + parseFloat(p.amount || 0), 0))"></p>
                <p class="text-sm text-gray-300">Total Amount</p>
            </div>
        </div>

        <!-- Date Range Filter -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
            <div class="date-range-picker">
                <span class="text-sm text-gray-300 mr-2">From:</span>
                <input type="date" x-model="dateRange.start" @change="updateFilteredData()" class="px-3 py-2 rounded-lg glass text-white">
                <span class="text-sm text-gray-300 mx-2">To:</span>
                <input type="date" x-model="dateRange.end" @change="updateFilteredData()" class="px-3 py-2 rounded-lg glass text-white">
            </div>
            <div class="export-btn" @click="exportData('payments')">
                <i class="fas fa-download"></i>
                <span>Export</span>
            </div>
        </div>

        <!-- Payments List -->
        <div class="overflow-x-auto">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox" x-model="selectAll" @change="toggleSelectAll()">
                        </th>
                        <th>ID</th>
                        <th>Reference</th>
                        <th>Customer</th>
                        <th>Tour</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <template x-for="payment in getPaginatedData('payments')" :key="payment.id">
                        <tr>
                            <td>
                                <input type="checkbox" :value="payment.id" x-model="selectedItems">
                            </td>
                            <td x-text="payment.id"></td>
                            <td x-text="payment.reference"></td>
                            <td x-text="payment.guest_full_name || 'N/A'"></td>
                            <td x-text="payment.tour ? payment.tour.title : 'N/A'"></td>
                            <td x-text="formatCurrency(payment.amount)"></td>
                            <td>
                                <span class="status-badge"
                                      :class="{
                                          'status-active': payment.status === 'SUCCESS',
                                          'status-pending': payment.status === 'PENDING',
                                          'status-inactive': payment.status === 'FAILED'
                                      }"
                                      x-text="payment.status">
                                </span>
                            </td>
                            <td x-text="formatDateTime(payment.created_at)"></td>
                            <td>
                                <button @click="openForm('payments', payment)" class="action-btn view-btn">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button @click="deleteItem('payments', payment.id)" class="action-btn delete-btn">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </template>
                    <template x-if="getPaginatedData('payments').length === 0">
                        <tr>
                            <td colspan="9" class="text-center py-4 text-gray-300">No payments found</td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>

        <!-- Bulk Actions (only visible when items are selected) -->
        <div x-show="selectedItems.length > 0" class="bulk-actions mt-4">
            <button @click="bulkUpdateStatus('payments', 'SUCCESS')" class="bg-teal-500 hover:bg-teal-600">
                <i class="fas fa-check"></i> Mark Success
            </button>
            <button @click="bulkUpdateStatus('payments', 'FAILED')" class="bg-red-500 hover:bg-red-600">
                <i class="fas fa-times"></i> Mark Failed
            </button>
            <button @click="bulkDelete('payments')" class="bg-red-500 hover:bg-red-600">
                <i class="fas fa-trash"></i> Delete Selected
            </button>
            <button @click="bulkExport('payments')" class="bg-teal-500 hover:bg-teal-600">
                <i class="fas fa-download"></i> Export Selected
            </button>
        </div>

        <!-- Pagination -->
        <div class="flex flex-col md:flex-row justify-between items-center mt-6 gap-4">
            <div class="text-sm text-gray-300">
                Showing <span x-text="(currentPage - 1) * itemsPerPage + 1"></span> to
                <span x-text="Math.min(currentPage * itemsPerPage, totalItems)"></span> of
                <span x-text="totalItems"></span> entries
            </div>
            <div class="pagination">
                <button
                    @click="changePage(currentPage - 1)"
                    :disabled="currentPage === 1"
                    class="px-3 py-1 rounded-lg">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <template x-for="page in getVisiblePages()" :key="page">
                    <button
                        @click="changePage(page)"
                        :class="page === currentPage ? 'active' : ''"
                        x-text="page">
                    </button>
                </template>
                <button
                    @click="changePage(currentPage + 1)"
                    :disabled="currentPage === Math.ceil(totalItems / itemsPerPage)"
                    class="px-3 py-1 rounded-lg">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <div class="flex items-center gap-2">
                <span class="text-sm text-gray-300">Items per page:</span>
                <select x-model="itemsPerPage" @change="changePage(1)" class="px-2 py-1 rounded-lg glass text-white">
                    <option value="5">5</option>
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                </select>
            </div>
        </div>
    </div>
</div>

<!-- Reviews Section -->
<div x-show="currentSection === 'reviews'" class="space-y-6">
    <div class="glass p-6 rounded-2xl bg-cream">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
            <h3 class="text-2xl font-semibold text-white">Reviews</h3>
            <div class="flex flex-col sm:flex-row gap-2 w-full md:w-auto">
                <div class="search-box w-full sm:w-auto">
                    <input type="text" placeholder="Search reviews..."
                           class="px-3 py-2 rounded-lg glass text-white w-full"
                           x-model="searchQuery"
                           @input.debounce.500ms="updateFilteredData()">
                </div>
                <select x-model="statusFilter" @change="updateFilteredData()" class="px-3 py-2 rounded-lg glass text-white">
                    <option value="">All Ratings</option>
                    <option value="5">5 Stars</option>
                    <option value="4">4 Stars</option>
                    <option value="3">3 Stars</option>
                    <option value="2">2 Stars</option>
                    <option value="1">1 Star</option>
                </select>
                <button @click="resetFilters()" class="btn-primary">
                    <i class="fas fa-sync mr-2"></i>Reset
                </button>
            </div>
        </div>

        <!-- Review Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-white" x-text="reviews.length"></p>
                <p class="text-sm text-gray-300">Total Reviews</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-teal-300" x-text="(reviews.reduce((sum, r) => sum + r.rating, 0) / reviews.length || 0).toFixed(1)"></p>
                <p class="text-sm text-gray-300">Avg Rating</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-amber-300" x-text="reviews.filter(r => r.rating >= 4).length"></p>
                <p class="text-sm text-gray-300">Positive</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-indigo-300" x-text="reviews.filter(r => r.rating <= 2).length"></p>
                <p class="text-sm text-gray-300">Negative</p>
            </div>
        </div>

        <!-- Reviews List -->
        <div class="overflow-x-auto">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox" x-model="selectAll" @change="toggleSelectAll()">
                        </th>
                        <th>ID</th>
                        <th>Customer</th>
                        <th>Tour</th>
                        <th>Rating</th>
                        <th>Comment</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <template x-for="review in getPaginatedData('reviews')" :key="review.id">
                        <tr>
                            <td>
                                <input type="checkbox" :value="review.id" x-model="selectedItems">
                            </td>
                            <td x-text="review.id"></td>
                            <td x-text="review.customer ? review.customer.full_name : 'N/A'"></td>
                            <td x-text="review.booking && review.booking.tour ? review.booking.tour.title : 'N/A'"></td>
                            <td>
                                <div class="flex items-center">
                                    <span class="text-gold mr-1" x-text="review.rating"></span>
                                    <i class="fas fa-star text-gold text-xs"></i>
                                </div>
                            </td>
                            <td x-text="review.comment ? review.comment.substring(0, 50) + '...' : 'N/A'"></td>
                            <td x-text="formatDateTime(review.created_at)"></td>
                            <td>
                                <button @click="openForm('reviews', review)" class="action-btn view-btn">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button @click="deleteItem('reviews', review.id)" class="action-btn delete-btn">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </template>
                    <template x-if="getPaginatedData('reviews').length === 0">
                        <tr>
                            <td colspan="8" class="text-center py-4 text-gray-300">No reviews found</td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>

        <!-- Bulk Actions (only visible when items are selected) -->
        <div x-show="selectedItems.length > 0" class="bulk-actions mt-4">
            <button @click="bulkDelete('reviews')" class="bg-red-500 hover:bg-red-600">
                <i class="fas fa-trash"></i> Delete Selected
            </button>
            <button @click="bulkExport('reviews')" class="bg-teal-500 hover:bg-teal-600">
                <i class="fas fa-download"></i> Export Selected
            </button>
        </div>

        <!-- Pagination -->
        <div class="flex flex-col md:flex-row justify-between items-center mt-6 gap-4">
            <div class="text-sm text-gray-300">
                Showing <span x-text="(currentPage - 1) * itemsPerPage + 1"></span> to
                <span x-text="Math.min(currentPage * itemsPerPage, totalItems)"></span> of
                <span x-text="totalItems"></span> entries
            </div>
            <div class="pagination">
                <button
                    @click="changePage(currentPage - 1)"
                    :disabled="currentPage === 1"
                    class="px-3 py-1 rounded-lg">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <template x-for="page in getVisiblePages()" :key="page">
                    <button
                        @click="changePage(page)"
                        :class="page === currentPage ? 'active' : ''"
                        x-text="page">
                    </button>
                </template>
                <button
                    @click="changePage(currentPage + 1)"
                    :disabled="currentPage === Math.ceil(totalItems / itemsPerPage)"
                    class="px-3 py-1 rounded-lg">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <div class="flex items-center gap-2">
                <span class="text-sm text-gray-300">Items per page:</span>
                <select x-model="itemsPerPage" @change="changePage(1)" class="px-2 py-1 rounded-lg glass text-white">
                    <option value="5">5</option>
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                </select>
            </div>
        </div>
    </div>
</div>

<!-- Tour Categories Section -->
<div x-show="currentSection === 'tour-categories'" class="space-y-6">
    <div class="glass p-6 rounded-2xl bg-cream">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
            <h3 class="text-2xl font-semibold text-white">Tour Categories</h3>
            <div class="flex flex-col sm:flex-row gap-2 w-full md:w-auto">
                <div class="search-box w-full sm:w-auto">
                    <input type="text" placeholder="Search categories..."
                           class="px-3 py-2 rounded-lg glass text-white w-full"
                           x-model="searchQuery"
                           @input.debounce.500ms="updateFilteredData()">
                </div>
                <button @click="openForm('tour-categories')" class="btn-primary">
                    <i class="fas fa-plus mr-2"></i>Add Category
                </button>
            </div>
        </div>

        <!-- Category Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-white" x-text="tourCategories.length"></p>
                <p class="text-sm text-gray-300">Total Categories</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-teal-300" x-text="tourCategories.filter(c => c.is_active).length"></p>
                <p class="text-sm text-gray-300">Active</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-amber-300" x-text="tourCategories.filter(c => !c.is_active).length"></p>
                <p class="text-sm text-gray-300">Inactive</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-indigo-300" x-text="tourCategories.reduce((max, c) => max > c.tour_count ? max : c.tour_count, 0)"></p>
                <p class="text-sm text-gray-300">Max Tours</p>
            </div>
        </div>

        <!-- Categories List -->
        <div class="overflow-x-auto">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox" x-model="selectAll" @change="toggleSelectAll()">
                        </th>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Description</th>
                        <th>Image</th>
                        <th>Tours Count</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <template x-for="category in getPaginatedData('tourCategories')" :key="category.id">
                        <tr>
                            <td>
                                <input type="checkbox" :value="category.id" x-model="selectedItems">
                            </td>
                            <td x-text="category.id"></td>
                            <td x-text="category.name"></td>
                            <td x-text="category.description ? category.description.substring(0, 50) + '...' : 'N/A'"></td>
                            <td>
                                <img x-show="category.image" :src="category.image" class="w-10 h-10 object-cover rounded" alt="Category image">
                                <span x-show="!category.image" class="text-gray-400">No image</span>
                            </td>
                            <td x-text="category.tour_count || 0"></td>
                            <td>
                                <span class="status-badge"
                                      :class="{
                                          'status-active': category.is_active,
                                          'status-inactive': !category.is_active
                                      }"
                                      x-text="category.is_active ? 'Active' : 'Inactive'">
                                </span>
                            </td>
                            <td>
                                <button @click="openForm('tour-categories', category)" class="action-btn edit-btn">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button @click="deleteItem('tour-categories', category.id)" class="action-btn delete-btn">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </template>
                    <template x-if="getPaginatedData('tourCategories').length === 0">
                        <tr>
                            <td colspan="8" class="text-center py-4 text-gray-300">No categories found</td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>

        <!-- Bulk Actions (only visible when items are selected) -->
        <div x-show="selectedItems.length > 0" class="bulk-actions mt-4">
            <button @click="bulkActivate('tour-categories')" class="bg-teal-500 hover:bg-teal-600">
                <i class="fas fa-check"></i> Activate Selected
            </button>
            <button @click="bulkDeactivate('tour-categories')" class="bg-amber-500 hover:bg-amber-600">
                <i class="fas fa-pause"></i> Deactivate Selected
            </button>
            <button @click="bulkDelete('tour-categories')" class="bg-red-500 hover:bg-red-600">
                <i class="fas fa-trash"></i> Delete Selected
            </button>
        </div>

        <!-- Pagination -->
        <div class="flex flex-col md:flex-row justify-between items-center mt-6 gap-4">
            <div class="text-sm text-gray-300">
                Showing <span x-text="(currentPage - 1) * itemsPerPage + 1"></span> to
                <span x-text="Math.min(currentPage * itemsPerPage, totalItems)"></span> of
                <span x-text="totalItems"></span> entries
            </div>
            <div class="pagination">
                <button
                    @click="changePage(currentPage - 1)"
                    :disabled="currentPage === 1"
                    class="px-3 py-1 rounded-lg">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <template x-for="page in getVisiblePages()" :key="page">
                    <button
                        @click="changePage(page)"
                        :class="page === currentPage ? 'active' : ''"
                        x-text="page">
                    </button>
                </template>
                <button
                    @click="changePage(currentPage + 1)"
                    :disabled="currentPage === Math.ceil(totalItems / itemsPerPage)"
                    class="px-3 py-1 rounded-lg">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <div class="flex items-center gap-2">
                <span class="text-sm text-gray-300">Items per page:</span>
                <select x-model="itemsPerPage" @change="changePage(1)" class="px-2 py-1 rounded-lg glass text-white">
                    <option value="5">5</option>
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                </select>
            </div>
        </div>
    </div>
</div>

<!-- Trips Section -->
<div x-show="currentSection === 'trips'" class="space-y-6">
    <div class="glass p-6 rounded-2xl bg-cream">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
            <h3 class="text-2xl font-semibold text-white">Trips</h3>
            <div class="flex flex-col sm:flex-row gap-2 w-full md:w-auto">
                <div class="search-box w-full sm:w-auto">
                    <input type="text" placeholder="Search trips..."
                           class="px-3 py-2 rounded-lg glass text-white w-full"
                           x-model="searchQuery"
                           @input.debounce.500ms="updateFilteredData()">
                </div>
                <select x-model="statusFilter" @change="updateFilteredData()" class="px-3 py-2 rounded-lg glass text-white">
                    <option value="">All Statuses</option>
                    <option value="SCHEDULED">Scheduled</option>
                    <option value="IN_PROGRESS">In Progress</option>
                    <option value="COMPLETED">Completed</option>
                    <option value="CANCELLED">Cancelled</option>
                </select>
                <button @click="openForm('trips')" class="btn-primary">
                    <i class="fas fa-plus mr-2"></i>Add Trip
                </button>
            </div>
        </div>

        <!-- Trip Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-white" x-text="trips.length"></p>
                <p class="text-sm text-gray-300">Total Trips</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-teal-300" x-text="trips.filter(t => t.status === 'COMPLETED').length"></p>
                <p class="text-sm text-gray-300">Completed</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-amber-300" x-text="trips.filter(t => t.status === 'SCHEDULED').length"></p>
                <p class="text-sm text-gray-300">Scheduled</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-indigo-300" x-text="formatCurrency(trips.reduce((sum, t) => sum + parseFloat(t.earnings || 0), 0))"></p>
                <p class="text-sm text-gray-300">Total Earnings</p>
            </div>
        </div>

        <!-- Date Range Filter -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
            <div class="date-range-picker">
                <span class="text-sm text-gray-300 mr-2">From:</span>
                <input type="date" x-model="dateRange.start" @change="updateFilteredData()" class="px-3 py-2 rounded-lg glass text-white">
                <span class="text-sm text-gray-300 mx-2">To:</span>
                <input type="date" x-model="dateRange.end" @change="updateFilteredData()" class="px-3 py-2 rounded-lg glass text-white">
            </div>
            <div class="export-btn" @click="exportData('trips')">
                <i class="fas fa-download"></i>
                <span>Export</span>
            </div>
        </div>

        <!-- Trips List -->
        <div class="overflow-x-auto">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox" x-model="selectAll" @change="toggleSelectAll()">
                        </th>
                        <th>ID</th>
                        <th>Driver</th>
                        <th>Destination</th>
                        <th>Date</th>
                        <th>Start Time</th>
                        <th>End Time</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <template x-for="trip in getPaginatedData('trips')" :key="trip.id">
                        <tr>
                            <td>
                                <input type="checkbox" :value="trip.id" x-model="selectedItems">
                            </td>
                            <td x-text="trip.id"></td>
                            <td x-text="trip.driver ? trip.driver.user.get_full_name : 'N/A'"></td>
                            <td x-text="trip.destination"></td>
                            <td x-text="formatDate(trip.date)"></td>
                            <td x-text="trip.start_time"></td>
                            <td x-text="trip.end_time"></td>
                            <td>
                                <span class="status-badge"
                                      :class="{
                                          'status-active': trip.status === 'COMPLETED',
                                          'status-pending': trip.status === 'SCHEDULED' || trip.status === 'IN_PROGRESS',
                                          'status-inactive': trip.status === 'CANCELLED'
                                      }"
                                      x-text="trip.status">
                                </span>
                            </td>
                            <td>
                                <button @click="openForm('trips', trip)" class="action-btn edit-btn">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button @click="deleteItem('trips', trip.id)" class="action-btn delete-btn">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </template>
                    <template x-if="getPaginatedData('trips').length === 0">
                        <tr>
                            <td colspan="9" class="text-center py-4 text-gray-300">No trips found</td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>

        <!-- Bulk Actions (only visible when items are selected) -->
        <div x-show="selectedItems.length > 0" class="bulk-actions mt-4">
            <button @click="bulkUpdateStatus('trips', 'SCHEDULED')" class="bg-amber-500 hover:bg-amber-600">
                <i class="fas fa-calendar"></i> Mark Scheduled
            </button>
            <button @click="bulkUpdateStatus('trips', 'IN_PROGRESS')" class="bg-blue-500 hover:bg-blue-600">
                <i class="fas fa-play"></i> Mark In Progress
            </button>
            <button @click="bulkUpdateStatus('trips', 'COMPLETED')" class="bg-teal-500 hover:bg-teal-600">
                <i class="fas fa-check"></i> Mark Completed
            </button>
            <button @click="bulkUpdateStatus('trips', 'CANCELLED')" class="bg-red-500 hover:bg-red-600">
                <i class="fas fa-times"></i> Mark Cancelled
            </button>
            <button @click="bulkDelete('trips')" class="bg-red-500 hover:bg-red-600">
                <i class="fas fa-trash"></i> Delete Selected
            </button>
        </div>

        <!-- Pagination -->
        <div class="flex flex-col md:flex-row justify-between items-center mt-6 gap-4">
            <div class="text-sm text-gray-300">
                Showing <span x-text="(currentPage - 1) * itemsPerPage + 1"></span> to
                <span x-text="Math.min(currentPage * itemsPerPage, totalItems)"></span> of
                <span x-text="totalItems"></span> entries
            </div>
            <div class="pagination">
                <button
                    @click="changePage(currentPage - 1)"
                    :disabled="currentPage === 1"
                    class="px-3 py-1 rounded-lg">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <template x-for="page in getVisiblePages()" :key="page">
                    <button
                        @click="changePage(page)"
                        :class="page === currentPage ? 'active' : ''"
                        x-text="page">
                    </button>
                </template>
                <button
                    @click="changePage(currentPage + 1)"
                    :disabled="currentPage === Math.ceil(totalItems / itemsPerPage)"
                    class="px-3 py-1 rounded-lg">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <div class="flex items-center gap-2">
                <span class="text-sm text-gray-300">Items per page:</span>
                <select x-model="itemsPerPage" @change="changePage(1)" class="px-2 py-1 rounded-lg glass text-white">
                    <option value="5">5</option>
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                </select>
            </div>
        </div>
    </div>
</div>

<!-- Vehicles Section -->
<div x-show="currentSection === 'vehicles'" class="space-y-6">
    <div class="glass p-6 rounded-2xl bg-cream">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
            <h3 class="text-2xl font-semibold text-white">Vehicles</h3>
            <div class="flex flex-col sm:flex-row gap-2 w-full md:w-auto">
                <div class="search-box w-full sm:w-auto">
                    <input type="text" placeholder="Search vehicles..."
                           class="px-3 py-2 rounded-lg glass text-white w-full"
                           x-model="searchQuery"
                           @input.debounce.500ms="updateFilteredData()">
                </div>
                <select x-model="statusFilter" @change="updateFilteredData()" class="px-3 py-2 rounded-lg glass text-white">
                    <option value="">All Statuses</option>
                    <option value="ACTIVE">Active</option>
                    <option value="MAINTENANCE">Maintenance</option>
                    <option value="OUT_OF_SERVICE">Out of Service</option>
                </select>
                <button @click="openForm('vehicles')" class="btn-primary">
                    <i class="fas fa-plus mr-2"></i>Add Vehicle
                </button>
            </div>
        </div>

        <!-- Vehicle Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-white" x-text="vehicles.length"></p>
                <p class="text-sm text-gray-300">Total Vehicles</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-teal-300" x-text="vehicles.filter(v => v.status === 'ACTIVE').length"></p>
                <p class="text-sm text-gray-300">Active</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-amber-300" x-text="vehicles.filter(v => v.status === 'MAINTENANCE').length"></p>
                <p class="text-sm text-gray-300">Maintenance</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-indigo-300" x-text="vehicles.filter(v => new Date(v.next_maintenance_date) <= new Date()).length"></p>
                <p class="text-sm text-gray-300">Maintenance Due</p>
            </div>
        </div>

        <!-- Vehicles List -->
        <div class="overflow-x-auto">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox" x-model="selectAll" @change="toggleSelectAll()">
                        </th>
                        <th>ID</th>
                        <th>Make</th>
                        <th>Model</th>
                        <th>License Plate</th>
                        <th>Year</th>
                        <th>Next Maintenance</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <template x-for="vehicle in getPaginatedData('vehicles')" :key="vehicle.id">
                        <tr>
                            <td>
                                <input type="checkbox" :value="vehicle.id" x-model="selectedItems">
                            </td>
                            <td x-text="vehicle.id"></td>
                            <td x-text="vehicle.make"></td>
                            <td x-text="vehicle.model"></td>
                            <td x-text="vehicle.license_plate"></td>
                            <td x-text="vehicle.year"></td>
                            <td x-text="formatDate(vehicle.next_maintenance_date)"></td>
                            <td>
                                <span class="status-badge"
                                      :class="{
                                          'status-active': vehicle.status === 'ACTIVE',
                                          'status-pending': vehicle.status === 'MAINTENANCE',
                                          'status-inactive': vehicle.status === 'OUT_OF_SERVICE'
                                      }"
                                      x-text="vehicle.status">
                                </span>
                            </td>
                            <td>
                                <button @click="openForm('vehicles', vehicle)" class="action-btn edit-btn">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button @click="deleteItem('vehicles', vehicle.id)" class="action-btn delete-btn">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </template>
                    <template x-if="getPaginatedData('vehicles').length === 0">
                        <tr>
                            <td colspan="9" class="text-center py-4 text-gray-300">No vehicles found</td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>

        <!-- Bulk Actions (only visible when items are selected) -->
        <div x-show="selectedItems.length > 0" class="bulk-actions mt-4">
            <button @click="bulkUpdateStatus('vehicles', 'ACTIVE')" class="bg-teal-500 hover:bg-teal-600">
                <i class="fas fa-check"></i> Set Active
            </button>
            <button @click="bulkUpdateStatus('vehicles', 'MAINTENANCE')" class="bg-amber-500 hover:bg-amber-600">
                <i class="fas fa-tools"></i> Set Maintenance
            </button>
            <button @click="bulkUpdateStatus('vehicles', 'OUT_OF_SERVICE')" class="bg-red-500 hover:bg-red-600">
                <i class="fas fa-times"></i> Set Out of Service
            </button>
            <button @click="bulkDelete('vehicles')" class="bg-red-500 hover:bg-red-600">
                <i class="fas fa-trash"></i> Delete Selected
            </button>
        </div>

        <!-- Pagination -->
        <div class="flex flex-col md:flex-row justify-between items-center mt-6 gap-4">
            <div class="text-sm text-gray-300">
                Showing <span x-text="(currentPage - 1) * itemsPerPage + 1"></span> to
                <span x-text="Math.min(currentPage * itemsPerPage, totalItems)"></span> of
                <span x-text="totalItems"></span> entries
            </div>
            <div class="pagination">
                <button
                    @click="changePage(currentPage - 1)"
                    :disabled="currentPage === 1"
                    class="px-3 py-1 rounded-lg">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <template x-for="page in getVisiblePages()" :key="page">
                    <button
                        @click="changePage(page)"
                        :class="page === currentPage ? 'active' : ''"
                        x-text="page">
                    </button>
                </template>
                <button
                    @click="changePage(currentPage + 1)"
                    :disabled="currentPage === Math.ceil(totalItems / itemsPerPage)"
                    class="px-3 py-1 rounded-lg">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <div class="flex items-center gap-2">
                <span class="text-sm text-gray-300">Items per page:</span>
                <select x-model="itemsPerPage" @change="changePage(1)" class="px-2 py-1 rounded-lg glass text-white">
                    <option value="5">5</option>
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                </select>
            </div>
        </div>
    </div>
</div>

<!-- Customers Section -->
<div x-show="currentSection === 'customers'" class="space-y-6">
    <div class="glass p-6 rounded-2xl bg-cream">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
            <h3 class="text-2xl font-semibold text-white">Customer Management</h3>
            <div class="flex flex-col sm:flex-row gap-2 w-full md:w-auto">
                <div class="search-box w-full sm:w-auto">
                    <input type="text" placeholder="Search customers..."
                           class="px-3 py-2 rounded-lg glass text-white w-full"
                           x-model="customerSearch"
                           @input.debounce.500ms="updateFilteredData()">
                </div>
                <button class="export-btn" @click="exportData('customers')">
                    <i class="fas fa-download"></i>
                    <span>Export</span>
                </button>
            </div>
        </div>

        <!-- Customer Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-white" x-text="customers.length"></p>
                <p class="text-sm text-gray-300">Total Customers</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-teal-300" x-text="customers.filter(c => c.total_bookings > 1).length"></p>
                <p class="text-sm text-gray-300">Repeat Customers</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-amber-300" x-text="customers.reduce((sum, c) => sum + c.total_bookings, 0)"></p>
                <p class="text-sm text-gray-300">Total Bookings</p>
            </div>
            <div class="glass p-4 text-center rounded-lg bg-cream">
                <p class="text-2xl font-bold text-indigo-300" x-text="formatCurrency(customers.reduce((sum, c) => sum + parseFloat(c.total_spent || 0), 0))"></p>
                <p class="text-sm text-gray-300">Total Revenue</p>
            </div>
        </div>

        <!-- Customer List -->
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead>
                    <tr class="border-b border-gray-700">
                        <th class="p-3 text-left text-gray-300">Customer</th>
                        <th class="p-3 text-left text-gray-300">Contact</th>
                        <th class="p-3 text-left text-gray-300">Bookings</th>
                        <th class="p-3 text-left text-gray-300">Total Spent</th>
                        <th class="p-3 text-left text-gray-300">Last Booking</th>
                        <th class="p-3 text-left text-gray-300">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <template x-if="customers.length > 0">
                        <template x-for="customer in customers" :key="customer.id">
                            <tr class="border-b border-gray-700 hover:bg-teal-900">
                                <td class="p-3">
                                    <div class="flex items-center gap-3">
                                        <img :src="customer.profile_picture || '{% static 'images/default_profile.png' %}'"
                                             class="customer-avatar" alt="Customer avatar">
                                        <div>
                                            <p class="font-semibold text-white" x-text="customer.full_name"></p>
                                            <p class="text-sm text-gray-300" x-text="customer.customer_type || 'Regular'"></p>
                                        </div>
                                    </div>
                                </td>
                                <td class="p-3">
                                    <p class="text-white" x-text="customer.email"></p>
                                    <p class="text-sm text-gray-300" x-text="customer.phone"></p>
                                </td>
                                <td class="p-3 text-white" x-text="customer.total_bookings || 0"></td>
                                <td class="p-3 text-white" x-text="formatCurrency(customer.total_spent || 0)"></td>
                                <td class="p-3 text-white" x-text="customer.last_booking ? formatDate(customer.last_booking) : 'Never'"></td>
                                <td class="p-3 flex gap-2">
                                    <button class="px-3 py-1 bg-teal-500 text-white rounded text-sm hover:bg-teal-600">
                                        <i class="fas fa-envelope"></i>
                                    </button>
                                    <button class="px-3 py-1 bg-amber-500 text-white rounded text-sm hover:bg-amber-600">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </td>
                            </tr>
                        </template>
                    </template>
                    <template x-if="customers.length === 0">
                        <tr>
                            <td colspan="6" class="p-3 text-center text-gray-300">No customers found</td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Earnings Section -->
<div x-show="currentSection === 'earnings'" class="space-y-6">
    <div class="glass p-6 rounded-2xl bg-cream">
        <h3 class="text-2xl font-semibold mb-6 text-teal-300">Earnings Report</h3>

        <!-- Tabs -->
        <div class="flex border-b border-gray-700 mb-6">
            <button @click="activeTab = 'overview'"
                    class="px-4 py-2 font-medium text-sm"
                    :class="activeTab === 'overview' ? 'tab-active text-white' : 'text-gray-400'">
                Overview
            </button>
            <button @click="activeTab = 'transactions'"
                    class="px-4 py-2 font-medium text-sm"
                    :class="activeTab === 'transactions' ? 'tab-active text-white' : 'text-gray-400'">
                Transactions
            </button>
            <button @click="activeTab = 'analytics'"
                    class="px-4 py-2 font-medium text-sm"
                    :class="activeTab === 'analytics' ? 'tab-active text-white' : 'text-gray-400'">
                Analytics
            </button>
        </div>

        <!-- Overview Tab -->
        <div x-show="activeTab === 'overview'" class="space-y-6">
            <!-- Date Filters -->
            <form method="GET" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <input type="date" name="start_date" value="{{ start_date }}"
                       class="p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 glass">
                <input type="date" name="end_date" value="{{ end_date }}"
                       class="p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 glass">
                <button type="submit" class="btn-primary">
                    Filter
                </button>
            </form>

            <!-- Total Stats -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="p-4 glass rounded-lg classic-border">
                    <p class="text-sm text-teal-300">Total Earnings</p>
                    <p class="text-2xl font-bold text-white" x-text="formatCurrency(dashboardData ? dashboardData.total_earnings : 0)"></p>
                </div>
                <div class="p-4 glass rounded-lg classic-border">
                    <p class="text-sm text-indigo-300">Total Trips</p>
                    <p class="text-2xl font-bold text-white" x-text="dashboardData ? dashboardData.completed_trips : 0"></p>
                </div>
                <div class="p-4 glass rounded-lg classic-border">
                    <p class="text-sm text-amber-300">Avg per Trip</p>
                    <p class="text-2xl font-bold text-white" x-text="formatCurrency(dashboardData && dashboardData.completed_trips > 0 ? dashboardData.total_earnings / dashboardData.completed_trips : 0)"></p>
                </div>
            </div>

            <!-- Earnings Chart -->
            <div class="chart-container glass p-4 rounded-lg">
                <canvas id="earningsChart"></canvas>
            </div>
        </div>

        <!-- Transactions Tab -->
        <div x-show="activeTab === 'transactions'" class="space-y-6">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-gray-700">
                            <th class="p-3 text-left text-gray-300">Reference</th>
                            <th class="p-3 text-left text-gray-300">Amount</th>
                            <th class="p-3 text-left text-gray-300">Status</th>
                            <th class="p-3 text-left text-gray-300">Date</th>
                            <th class="p-3 text-left text-gray-300">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-if="paymentStats && paymentStats.recent_transactions.length > 0">
                            <template x-for="transaction in paymentStats.recent_transactions" :key="transaction.id">
                                <tr class="border-b border-gray-700 hover:bg-teal-900">
                                    <td class="p-3 text-white" x-text="transaction.reference"></td>
                                    <td class="p-3 text-white" x-text="formatCurrency(transaction.amount)"></td>
                                    <td class="p-3">
                                        <span class="px-2 py-1 rounded text-xs font-medium"
                                              :class="{
                                                  'bg-green-100 text-green-800': transaction.status === 'SUCCESS',
                                                  'bg-yellow-100 text-yellow-800': transaction.status === 'PENDING',
                                                  'bg-red-100 text-red-800': transaction.status === 'FAILED'
                                              }"
                                              x-text="transaction.status">
                                        </span>
                                    </td>
                                    <td class="p-3 text-white" x-text="formatDate(transaction.created_at)"></td>
                                    <td class="p-3 flex gap-2">
                                        <button class="px-3 py-1 bg-teal-500 text-white rounded text-sm hover:bg-teal-600">
                                            View
                                        </button>
                                        <button x-show="transaction.status === 'SUCCESS'"
                                                class="px-3 py-1 bg-amber-500 text-white rounded text-sm hover:bg-amber-600"
                                                @click="initiateRefund(transaction)">
                                            Refund
                                        </button>
                                    </td>
                                </tr>
                            </template>
                        </template>
                        <template x-if="!paymentStats || paymentStats.recent_transactions.length === 0">
                            <tr>
                                <td colspan="5" class="p-3 text-center text-gray-300">No transactions found</td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div x-show="activeTab === 'analytics'" class="space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="glass p-4 rounded-lg">
                    <h4 class="text-lg font-semibold text-white mb-4">Revenue by Tour</h4>
                    <div class="chart-container">
                        <canvas id="revenueByTourChart"></canvas>
                    </div>
                </div>
                <div class="glass p-4 rounded-lg">
                    <h4 class="text-lg font-semibold text-white mb-4">Booking Trends</h4>
                    <div class="chart-container">
                        <canvas id="bookingTrendsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Schedule Section -->
<div x-show="currentSection === 'schedule'" class="space-y-6">
    <div class="glass p-6 rounded-2xl bg-cream">
        <h3 class="text-2xl font-semibold mb-6 text-white">Monthly Schedule</h3>

        <!-- Month Navigation -->
        <div class="flex justify-between items-center mb-6">
            <a href="?year={{ prev_year }}&month={{ prev_month }}" class="p-2 glass text-white rounded-lg hover:bg-teal-700 transition">
                <i class="fas fa-chevron-left"></i>
            </a>
            <h4 class="text-xl font-semibold text-white">{{ month_name }} {{ year }}</h4>
            <a href="?year={{ next_year }}&month={{ next_month }}" class="p-2 glass text-white rounded-lg hover:bg-teal-700 transition">
                <i class="fas fa-chevron-right"></i>
            </a>
        </div>

        <!-- Calendar -->
        <div class="grid grid-cols-7 gap-2">
            {% for day in week_days %}
            <div class="p-2 text-center font-semibold text-gray-300">{{ day }}</div>
            {% endfor %}

            {% for week in calendar %}
                {% for day in week %}
                    <div class="p-2 border rounded-lg min-h-20 {% if day == 0 %}bg-gray-900{% else %}glass{% endif %}">
                        {% if day != 0 %}
                            <div class="text-sm font-semibold text-white">{{ day }}</div>
                            {% for trip in trips_by_date|get_item:day %}
                                <div class="text-xs p-1 mt-1 glass rounded truncate" title="{{ trip.destination }}">
                                    {{ trip.start_time|time:"H:i" }} - {{ trip.destination }}
                                </div>
                            {% endfor %}
                        {% endif %}
                    </div>
                {% endfor %}
            {% endfor %}
        </div>
    </div>
</div>

<!-- Tours Management -->
<div x-show="currentSection === 'tours'" class="space-y-6">
    <!-- Tour Statistics -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
        <div class="glass p-4 text-center rounded-lg bg-cream">
            <p class="text-2xl font-bold text-white" x-text="dashboardData ? dashboardData.tour_stats.total : 0"></p>
            <p class="text-sm text-gray-300">Total Tours</p>
        </div>
        <div class="glass p-4 text-center rounded-lg bg-cream">
            <p class="text-2xl font-bold text-teal-300" x-text="dashboardData ? dashboardData.tour_stats.approved : 0"></p>
            <p class="text-sm text-gray-300">Approved</p>
        </div>
        <div class="glass p-4 text-center rounded-lg bg-cream">
            <p class="text-2xl font-bold text-amber-300" x-text="dashboardData ? dashboardData.tour_stats.pending : 0"></p>
            <p class="text-sm text-gray-300">Pending</p>
        </div>
        <div class="glass p-4 text-center rounded-lg bg-cream">
            <p class="text-2xl font-bold text-indigo-300" x-text="dashboardData ? dashboardData.tour_stats.active : 0"></p>
            <p class="text-sm text-gray-300">Active</p>
        </div>
    </div>

    <!-- View Toggle -->
    <div class="flex justify-end mb-4">
        <div class="inline-flex rounded-md shadow-sm" role="group">
            <button @click="tourViewMode = 'table'"
                    :class="tourViewMode === 'table' ? 'bg-teal-500 text-white' : 'bg-gray-700 text-gray-300'"
                    class="px-4 py-2 text-sm font-medium rounded-l-lg">
                <i class="fas fa-table mr-2"></i> Table View
            </button>
            <button @click="tourViewMode = 'grid'"
                    :class="tourViewMode === 'grid' ? 'bg-teal-500 text-white' : 'bg-gray-700 text-gray-300'"
                    class="px-4 py-2 text-sm font-medium rounded-r-lg">
                <i class="fas fa-th-large mr-2"></i> Grid View
            </button>
        </div>
    </div>

    <!-- Tours Table -->
    <div x-show="tourViewMode === 'table'" class="glass p-6 rounded-2xl bg-cream">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-semibold text-indigo-300">My Tours</h3>
            <button @click="showAddTour = true" class="btn-primary">
                <i class="fas fa-plus mr-2"></i>Add Tour
            </button>
        </div>

        <div class="overflow-x-auto">
            <table class="w-full">
                <thead>
                    <tr class="border-b border-gray-700">
                        <th class="p-3 text-left text-gray-300">Tour Name</th>
                        <th class="p-3 text-left text-gray-300">Status</th>
                        <th class="p-3 text-left text-gray-300">Price</th>
                        <th class="p-3 text-left text-gray-300">Bookings</th>
                        <th class="p-3 text-left text-gray-300">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <template x-if="tours.length > 0">
                        <template x-for="tour in tours" :key="tour.id">
                            <tr class="border-b border-gray-700 hover:bg-teal-900">
                                <td class="p-3 font-semibold text-white" x-text="tour.title"></td>
                                <td class="p-3">
                                    <span class="px-2 py-1 rounded text-xs"
                                          :class="{
                                              'bg-teal-100 text-teal-800': tour.is_approved && tour.available,
                                              'bg-amber-100 text-amber-800': !tour.is_approved,
                                              'bg-red-100 text-red-800': tour.is_approved && !tour.available
                                          }">
                                        <span x-text="tour.is_approved && tour.available ? 'Active' : (!tour.is_approved ? 'Pending' : 'Inactive')"></span>
                                    </span>
                                </td>
                                <td class="p-3 text-white" x-text="formatCurrency(tour.price_per_person)"></td>
                                <td class="p-3 text-white" x-text="tour.booking_count || 0"></td>
                                <td class="p-3 flex gap-2">
                                    <a :href="`/tour/${tour.id}/pay/`"
                                       class="px-3 py-1 bg-teal-500 text-white rounded text-sm hover:bg-teal-600">
                                        View
                                    </a>
                                    <a :href="`/driver/tour/${tour.id}/edit/`"
                                       class="px-3 py-1 bg-amber-500 text-white rounded text-sm hover:bg-amber-600">
                                        Edit
                                    </a>
                                </td>
                            </tr>
                        </template>
                    </template>
                    <template x-if="tours.length === 0">
                        <tr>
                            <td colspan="5" class="p-3 text-center text-gray-300">No tours yet</td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Tours Grid -->
    <div x-show="tourViewMode === 'grid'" class="responsive-grid">
        <template x-if="tours.length > 0">
            <template x-for="tour in tours" :key="tour.id">
                <div class="tour-card">
                    <div class="tour-card-image" :style="`background-image: url('${tour.image || '{% static 'images/default-tour.jpg' %}'}')`">
                        <span class="tour-card-badge"
                              :class="{
                                  'bg-teal-100 text-teal-800': tour.is_approved && tour.available,
                                  'bg-amber-100 text-amber-800': !tour.is_approved,
                                  'bg-red-100 text-red-800': tour.is_approved && !tour.available
                              }"
                              x-text="tour.is_approved && tour.available ? 'Active' : (!tour.is_approved ? 'Pending' : 'Inactive')">
                        </span>
                    </div>
                    <div class="tour-card-content">
                        <h3 class="tour-card-title" x-text="tour.title"></h3>
                        <p class="tour-card-description" x-text="tour.description ? tour.description.substring(0, 100) + '...' : 'No description available'"></p>
                        <div class="tour-card-footer">
                            <div class="tour-card-price" x-text="formatCurrency(tour.price_per_person)"></div>
                            <div class="tour-card-actions">
                                <a :href="`/tour/${tour.id}/pay/`"
                                   class="px-3 py-1 bg-teal-500 text-white rounded text-sm hover:bg-teal-600">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <a :href="`/driver/tour/${tour.id}/edit/`"
                                   class="px-3 py-1 bg-amber-500 text-white rounded text-sm hover:bg-amber-600">
                                    <i class="fas fa-edit"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </template>
        </template>
        <template x-if="tours.length === 0">
            <div class="empty-state col-span-full">
                <i class="fas fa-mountain"></i>
                <p>No tours yet</p>
                <button @click="showAddTour = true" class="btn-primary mt-4">
                    <i class="fas fa-plus mr-2"></i>Add Tour
                </button>
            </div>
        </template>
    </div>
</div>

<!-- Profile Section -->
<div x-show="currentSection === 'profile'" class="space-y-6">
    <div class="glass p-6 rounded-2xl bg-cream">
        <h3 class="text-2xl font-semibold mb-6 text-white">Driver Profile</h3>

        <form method="POST" enctype="multipart/form-data" class="space-y-6">
            {% csrf_token %}

            <!-- Personal Information -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium mb-2 text-gray-300">Phone Number</label>
                    <input type="text" name="phone_number" value="{{ driver.phone_number }}"
                           class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 glass">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2 text-gray-300">License Number</label>
                    <input type="text" name="license_number" value="{{ driver.license_number }}"
                           class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 glass">
                </div>
            </div>

            <!-- Bank Information -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <label class="block text-sm font-medium mb-2 text-gray-300">Bank Name</label>
                    <input type="text" name="bank_name" value="{{ driver.bank_name|default:'' }}"
                           class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 glass">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2 text-gray-300">Account Number</label>
                    <input type="text" name="bank_account" value="{{ driver.bank_account|default:'' }}"
                           class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 glass">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2 text-gray-300">Branch</label>
                    <input type="text" name="bank_branch" value="{{ driver.bank_branch|default:'' }}"
                           class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 glass">
                </div>
            </div>

            <!-- Profile Picture -->
            <div>
                <label class="block text-sm font-medium mb-2 text-gray-300">Profile Picture</label>
                <input type="file" name="profile_picture" accept="image/*"
                       class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 glass">
            </div>

            <!-- Availability -->
            <div>
                <label class="flex items-center space-x-2">
                    <input type="checkbox" name="available" {% if driver.available %}checked{% endif %}
                           class="rounded border-gray-300 text-teal-600 focus:ring-teal-500">
                    <span class="text-sm font-medium text-gray-300">Available for bookings</span>
                </label>
            </div>

            <button type="submit" class="btn-primary">
                Update Profile
            </button>
        </form>
    </div>
</div>

<!-- Ratings Section -->
<div x-show="currentSection === 'ratings'" class="space-y-6">
    <div class="glass p-6 rounded-2xl bg-cream">
        <h3 class="text-2xl font-semibold mb-6 text-amber-300">Customer Ratings & Reviews</h3>

        <!-- Overall Rating -->
        <div class="flex items-center gap-6 mb-8">
            <div class="text-center">
                <div class="text-5xl font-bold text-amber-300" x-text="dashboardData ? dashboardData.avg_rating.toFixed(1) : '4.7'"></div>
                <div class="text-gold text-xl mt-2">
                    <template x-for="i in 5" :key="i">
                        <i :class="i <= (dashboardData ? Math.round(dashboardData.avg_rating) : 0) ? 'fas fa-star' : 'far fa-star'"></i>
                    </template>
                </div>
                <p class="text-gray-300 mt-2" x-text="`${dashboardData ? dashboardData.total_reviews : 0} reviews`"></p>
            </div>

            <!-- Rating Distribution -->
            <div class="flex-1">
                <h4 class="font-semibold mb-4 text-white">Rating Distribution</h4>
                <template x-if="dashboardData && dashboardData.rating_distribution.length > 0">
                    <template x-for="dist in dashboardData.rating_distribution" :key="dist.rating">
                        <div class="flex items-center gap-3 mb-2">
                            <span class="w-8 text-sm text-white" x-text="`${dist.rating}â˜…`"></span>
                            <div class="flex-1 bg-gray-700 rounded-full h-2">
                                <div class="bg-amber-500 h-2 rounded-full"
                                     :style="`width: ${dist.percentage}%`"></div>
                            </div>
                            <span class="w-8 text-sm text-right text-white" x-text="dist.count"></span>
                        </div>
                    </template>
                </template>
                <template x-if="!dashboardData || dashboardData.rating_distribution.length === 0">
                    <p class="text-gray-300">No reviews yet</p>
                </template>
            </div>
        </div>

        <!-- Recent Reviews -->
        <div class="mt-8">
            <h4 class="text-xl font-semibold mb-4 text-white">Recent Reviews</h4>
            <div class="space-y-4">
                <template x-if="dashboardData && dashboardData.recent_reviews && dashboardData.recent_reviews.length > 0">
                    <template x-for="review in dashboardData.recent_reviews" :key="review.id">
                        <div class="glass p-4 rounded-lg">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <p class="font-semibold text-white" x-text="review.customer_name"></p>
                                    <div class="text-gold text-sm">
                                        <template x-for="i in 5" :key="i">
                                            <i :class="i <= review.rating ? 'fas fa-star' : 'far fa-star'"></i>
                                        </template>
                                    </div>
                                </div>
                                <p class="text-sm text-gray-300" x-text="formatDate(review.created_at)"></p>
                            </div>
                            <p class="text-gray-300" x-text="review.comment"></p>
                        </div>
                    </template>
                </template>
                <template x-if="!dashboardData || !dashboardData.recent_reviews || dashboardData.recent_reviews.length === 0">
                    <div class="empty-state">
                        <i class="fas fa-comments"></i>
                        <p>No reviews yet</p>
                    </div>
                </template>
            </div>
        </div>
    </div>
</div>

<!-- Form Modal -->
<div x-show="showForm" x-cloak class="fixed inset-0 bg-black/80 flex items-center justify-center z-50">
    <div class="glass rounded-2xl w-full max-w-4xl max-h-[90vh] mx-4 flex flex-col">
        <div class="form-header">
            <h1 x-text="editId ? `Edit ${formModel}` : `Add ${formModel}`"></h1>
            <button @click="closeForm()" class="absolute top-4 right-4 text-white hover:text-gray-200">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>

        <div class="modal-body flex-1 overflow-y-auto p-4">
            <form @submit.prevent="submitForm()" class="space-y-4">
                <!-- Dynamic form fields based on model -->
                <template x-if="formModel === 'booking-customers'">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">Full Name</label>
                            <input type="text" x-model="formData.full_name" class="form-control" required>
                        </div>
                        <div>
                            <label class="form-label">Email</label>
                            <input type="email" x-model="formData.email" class="form-control" required>
                        </div>
                        <div>
                            <label class="form-label">Phone Number</label>
                            <input type="text" x-model="formData.phone_number" class="form-control" required>
                        </div>
                        <div>
                            <label class="form-label">Address</label>
                            <input type="text" x-model="formData.address" class="form-control">
                        </div>
                        <div class="md:col-span-2">
                            <label class="form-label">Notes</label>
                            <textarea x-model="formData.notes" class="form-control" rows="3"></textarea>
                        </div>
                    </div>
                </template>

                <template x-if="formModel === 'bookings'">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">Customer</label>
                            <select x-model="formData.booking_customer" class="form-select" required>
                                <option value="">Select a customer</option>
                                <template x-for="customer in bookingCustomers" :key="customer.id">
                                    <option :value="customer.id" x-text="customer.full_name"></option>
                                </template>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Tour</label>
                            <select x-model="formData.tour" class="form-select" required>
                                <option value="">Select a tour</option>
                                <template x-for="tour in tours" :key="tour.id">
                                    <option :value="tour.id" x-text="tour.title"></option>
                                </template>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Travel Date</label>
                            <input type="date" x-model="formData.travel_date" class="form-control" required>
                        </div>
                        <div>
                            <label class="form-label">Number of Adults</label>
                            <input type="number" x-model="formData.num_adults" class="form-control" min="1" required>
                        </div>
                        <div>
                            <label class="form-label">Number of Children</label>
                            <input type="number" x-model="formData.num_children" class="form-control" min="0">
                        </div>
                        <div>
                            <label class="form-label">Total Price</label>
                            <input type="number" x-model="formData.total_price" class="form-control" step="0.01" required>
                        </div>
                        <div>
                            <label class="form-label">Status</label>
                            <select x-model="formData.status" class="form-select" required>
                                <option value="CONFIRMED">Confirmed</option>
                                <option value="PENDING">Pending</option>
                                <option value="CANCELLED">Cancelled</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <label class="form-label">Special Requests</label>
                            <textarea x-model="formData.special_requests" class="form-control" rows="3"></textarea>
                        </div>
                    </div>
                </template>

                <template x-if="formModel === 'contact-messages'">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">Name</label>
                            <input type="text" x-model="formData.name" class="form-control" required>
                        </div>
                        <div>
                            <label class="form-label">Email</label>
                            <input type="email" x-model="formData.email" class="form-control" required>
                        </div>
                        <div>
                            <label class="form-label">Phone</label>
                            <input type="text" x-model="formData.phone" class="form-control">
                        </div>
                        <div>
                            <label class="form-label">Subject</label>
                            <input type="text" x-model="formData.subject" class="form-control" required>
                        </div>
                        <div class="md:col-span-2">
                            <label class="form-label">Message</label>
                            <textarea x-model="formData.message" class="form-control" rows="5" required></textarea>
                        </div>
                        <div>
                            <label class="form-label">Status</label>
                            <select x-model="formData.is_read" class="form-select">
                                <option :value="true">Read</option>
                                <option :value="false">Unread</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Replied</label>
                            <select x-model="formData.is_replied" class="form-select">
                                <option :value="true">Yes</option>
                                <option :value="false">No</option>
                            </select>
                        </div>
                    </div>
                </template>

                <template x-if="formModel === 'destinations'">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">Name</label>
                            <input type="text" x-model="formData.name" class="form-control" required>
                        </div>
                        <div>
                            <label class="form-label">Slug</label>
                            <input type="text" x-model="formData.slug" class="form-control" required>
                        </div>
                        <div class="md:col-span-2">
                            <label class="form-label">Description</label>
                            <textarea x-model="formData.description" class="form-control" rows="3"></textarea>
                        </div>
                        <div>
                            <label class="form-label">Image</label>
                            <input type="file" @change="formData.image = $event.target.files[0]" class="form-control">
                        </div>
                        <div>
                            <label class="form-label">Status</label>
                            <select x-model="formData.is_active" class="form-select">
                                <option :value="true">Active</option>
                                <option :value="false">Inactive</option>
                            </select>
                        </div>
                    </div>
                </template>

                <template x-if="formModel === 'drivers'">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">User</label>
                            <select x-model="formData.user" class="form-select" required>
                                <option value="">Select a user</option>
                                <!-- This would need to be populated with users -->
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Phone Number</label>
                            <input type="text" x-model="formData.phone_number" class="form-control" required>
                        </div>
                        <div>
                            <label class="form-label">License Number</label>
                            <input type="text" x-model="formData.license_number" class="form-control" required>
                        </div>
                        <div>
                            <label class="form-label">Rating</label>
                            <input type="number" x-model="formData.rating" class="form-control" min="0" max="5" step="0.1">
                        </div>
                        <div>
                            <label class="form-label">Available</label>
                            <select x-model="formData.available" class="form-select">
                                <option :value="true">Yes</option>
                                <option :value="false">No</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Verified</label>
                            <select x-model="formData.is_verified" class="form-select">
                                <option :value="true">Yes</option>
                                <option :value="false">No</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Bank Name</label>
                            <input type="text" x-model="formData.bank_name" class="form-control">
                        </div>
                        <div>
                            <label class="form-label">Bank Account</label>
                            <input type="text" x-model="formData.bank_account" class="form-control">
                        </div>
                        <div>
                            <label class="form-label">Bank Branch</label>
                            <input type="text" x-model="formData.bank_branch" class="form-control">
                        </div>
                        <div>
                            <label class="form-label">Profile Picture</label>
                            <input type="file" @change="formData.profile_picture = $event.target.files[0]" class="form-control">
                        </div>
                    </div>
                </template>

                <template x-if="formModel === 'payments'">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">Tour</label>
                            <select x-model="formData.tour" class="form-select" required>
                                <option value="">Select a tour</option>
                                <template x-for="tour in tours" :key="tour.id">
                                    <option :value="tour.id" x-text="tour.title"></option>
                                </template>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Booking</label>
                            <select x-model="formData.booking" class="form-select">
                                <option value="">Select a booking</option>
                                <template x-for="booking in bookings" :key="booking.id">
                                    <option :value="booking.id" x-text="`Booking #${booking.id}`"></option>
                                </template>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Amount</label>
                            <input type="number" x-model="formData.amount" class="form-control" step="0.01" required>
                        </div>
                        <div>
                            <label class="form-label">Currency</label>
                            <select x-model="formData.currency" class="form-select" required>
                                <option value="KES">KES</option>
                                <option value="USD">USD</option>
                                <option value="EUR">EUR</option>
                                <option value="GBP">GBP</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Status</label>
                            <select x-model="formData.status" class="form-select" required>
                                <option value="SUCCESS">Success</option>
                                <option value="PENDING">Pending</option>
                                <option value="FAILED">Failed</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Provider</label>
                            <select x-model="formData.provider" class="form-select" required>
                                <option value="PAYSTACK">Paystack</option>
                                <option value="MPESA">M-Pesa</option>
                                <option value="CASH">Cash</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Guest Full Name</label>
                            <input type="text" x-model="formData.guest_full_name" class="form-control">
                        </div>
                        <div>
                            <label class="form-label">Guest Email</label>
                            <input type="email" x-model="formData.guest_email" class="form-control">
                        </div>
                        <div>
                            <label class="form-label">Guest Phone</label>
                            <input type="text" x-model="formData.guest_phone" class="form-control">
                        </div>
                        <div>
                            <label class="form-label">Reference</label>
                            <input type="text" x-model="formData.reference" class="form-control">
                        </div>
                    </div>
                </template>

                <template x-if="formModel === 'reviews'">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">Booking</label>
                            <select x-model="formData.booking" class="form-select" required>
                                <option value="">Select a booking</option>
                                <template x-for="booking in bookings" :key="booking.id">
                                    <option :value="booking.id" x-text="`Booking #${booking.id}`"></option>
                                </template>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Customer</label>
                            <select x-model="formData.customer" class="form-select" required>
                                <option value="">Select a customer</option>
                                <template x-for="customer in bookingCustomers" :key="customer.id">
                                    <option :value="customer.id" x-text="customer.full_name"></option>
                                </template>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Rating</label>
                            <select x-model="formData.rating" class="form-select" required>
                                <option value="5">5 Stars</option>
                                <option value="4">4 Stars</option>
                                <option value="3">3 Stars</option>
                                <option value="2">2 Stars</option>
                                <option value="1">1 Star</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Date</label>
                            <input type="date" x-model="formData.created_at" class="form-control" required>
                        </div>
                        <div class="md:col-span-2">
                            <label class="form-label">Comment</label>
                            <textarea x-model="formData.comment" class="form-control" rows="4"></textarea>
                        </div>
                    </div>
                </template>

                <template x-if="formModel === 'tour-categories'">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">Name</label>
                            <input type="text" x-model="formData.name" class="form-control" required>
                        </div>
                        <div>
                            <label class="form-label">Slug</label>
                            <input type="text" x-model="formData.slug" class="form-control" required>
                        </div>
                        <div class="md:col-span-2">
                            <label class="form-label">Description</label>
                            <textarea x-model="formData.description" class="form-control" rows="3"></textarea>
                        </div>
                        <div>
                            <label class="form-label">Image</label>
                            <input type="file" @change="formData.image = $event.target.files[0]" class="form-control">
                        </div>
                        <div>
                            <label class="form-label">Status</label>
                            <select x-model="formData.is_active" class="form-select">
                                <option :value="true">Active</option>
                                <option :value="false">Inactive</option>
                            </select>
                        </div>
                    </div>
                </template>

                <template x-if="formModel === 'trips'">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">Driver</label>
                            <select x-model="formData.driver" class="form-select" required>
                                <option value="">Select a driver</option>
                                <template x-for="driver in drivers" :key="driver.id">
                                    <option :value="driver.id" x-text="driver.user.get_full_name"></option>
                                </template>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Vehicle</label>
                            <select x-model="formData.vehicle" class="form-select">
                                <option value="">Select a vehicle</option>
                                <template x-for="vehicle in vehicles" :key="vehicle.id">
                                    <option :value="vehicle.id" x-text="`${vehicle.make} ${vehicle.model}`"></option>
                                </template>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Destination</label>
                            <input type="text" x-model="formData.destination" class="form-control" required>
                        </div>
                        <div>
                            <label class="form-label">Date</label>
                            <input type="date" x-model="formData.date" class="form-control" required>
                        </div>
                        <div>
                            <label class="form-label">Start Time</label>
                            <input type="time" x-model="formData.start_time" class="form-control" required>
                        </div>
                        <div>
                            <label class="form-label">End Time</label>
                            <input type="time" x-model="formData.end_time" class="form-control" required>
                        </div>
                        <div>
                            <label class="form-label">Status</label>
                            <select x-model="formData.status" class="form-select" required>
                                <option value="SCHEDULED">Scheduled</option>
                                <option value="IN_PROGRESS">In Progress</option>
                                <option value="COMPLETED">Completed</option>
                                <option value="CANCELLED">Cancelled</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Earnings</label>
                            <input type="number" x-model="formData.earnings" class="form-control" step="0.01">
                        </div>
                        <div class="md:col-span-2">
                            <label class="form-label">Notes</label>
                            <textarea x-model="formData.notes" class="form-control" rows="3"></textarea>
                        </div>
                    </div>
                </template>

                <template x-if="formModel === 'vehicles'">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">Make</label>
                            <input type="text" x-model="formData.make" class="form-control" required>
                        </div>
                        <div>
                            <label class="form-label">Model</label>
                            <input type="text" x-model="formData.model" class="form-control" required>
                        </div>
                        <div>
                            <label class="form-label">Year</label>
                            <input type="number" x-model="formData.year" class="form-control" required>
                        </div>
                        <div>
                            <label class="form-label">License Plate</label>
                            <input type="text" x-model="formData.license_plate" class="form-control" required>
                        </div>
                        <div>
                            <label class="form-label">Capacity</label>
                            <input type="number" x-model="formData.capacity" class="form-control" required>
                        </div>
                        <div>
                            <label class="form-label">Status</label>
                            <select x-model="formData.status" class="form-select" required>
                                <option value="ACTIVE">Active</option>
                                <option value="MAINTENANCE">Maintenance</option>
                                <option value="OUT_OF_SERVICE">Out of Service</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Next Maintenance Date</label>
                            <input type="date" x-model="formData.next_maintenance_date" class="form-control">
                        </div>
                        <div>
                            <label class="form-label">Driver</label>
                            <select x-model="formData.driver" class="form-select">
                                <option value="">Select a driver</option>
                                <template x-for="driver in drivers" :key="driver.id">
                                    <option :value="driver.id" x-text="driver.user.get_full_name"></option>
                                </template>
                            </select>
                        </div>
                    </div>
                </template>

                <div class="text-center">
                    <button type="submit" class="submit-btn">
                        <i class="fas fa-save"></i>
                        <span x-text="editId ? 'Update' : 'Save'"></span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Add Tour Modal -->
<div x-show="showAddTour" x-cloak class="fixed inset-0 bg-black/80 flex items-center justify-center z-50">
    <div class="glass rounded-2xl w-full max-w-4xl max-h-[90vh] mx-4 flex flex-col">
        <div class="form-header">
            <h1>Create a New Safari Tour</h1>
            <p>Design an unforgettable experience for your guests</p>
            <button @click="showAddTour = false" class="absolute top-4 right-4 text-white hover:text-gray-200">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>

        <div class="modal-body flex-1 overflow-y-auto p-4">
            <!-- Tour Wizard -->
            <div class="wizard-progress mb-6">
                <div class="wizard-step-indicator" :class="tourWizardStep >= 1 ? 'active' : ''" :class="tourWizardStep > 1 ? 'completed' : ''">
                    <span>1</span>
                </div>
                <div class="wizard-step-indicator" :class="tourWizardStep >= 2 ? 'active' : ''" :class="tourWizardStep > 2 ? 'completed' : ''">
                    <span>2</span>
                </div>
                <div class="wizard-step-indicator" :class="tourWizardStep >= 3 ? 'active' : ''" :class="tourWizardStep > 3 ? 'completed' : ''">
                    <span>3</span>
                </div>
                <div class="wizard-step-indicator" :class="tourWizardStep >= 4 ? 'active' : ''">
                    <span>4</span>
                </div>
            </div>

            <form @submit.prevent="createTour" enctype="multipart/form-data" class="needs-validation" novalidate>
                {% csrf_token %}

                <!-- Step 1: Basic Info -->
                <div class="wizard-step" :class="{'active': tourWizardStep === 1}">
                    <div class="section-card basic-info">
                        <div class="section-header">
                            <i class="fas fa-info-circle"></i>
                            <h3 class="section-title">Basic Information</h3>
                        </div>
                        <div class="section-body">
                            <div class="form-group mb-3">
                                <label class="form-label">Tour Title</label>
                                <input type="text" name="title" class="form-control" required>
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label">Tagline</label>
                                <input type="text" name="tagline" class="form-control">
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label">Description</label>
                                <textarea name="description" class="form-control" required></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Category</label>
                                <select name="category" class="form-select" required>
                                    <option value="">Select a category</option>
                                    <template x-for="category in categories" :key="category.id">
                                        <option :value="category.id" x-text="category.name"></option>
                                    </template>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Pricing & Duration -->
                <div class="wizard-step" :class="{'active': tourWizardStep === 2}">
                    <div class="form-row">
                        <!-- Pricing -->
                        <div class="section-card pricing">
                            <div class="section-header">
                                <i class="fas fa-tag"></i>
                                <h3 class="section-title">Pricing</h3>
                            </div>
                            <div class="section-body">
                                <div class="form-group mb-3">
                                    <label class="form-label">Price per Person</label>
                                    <input type="number" name="price_per_person" class="form-control" required>
                                </div>
                                <div class="form-group mb-3">
                                    <label class="form-label">Discount Price</label>
                                    <input type="number" name="discount_price" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Currency</label>
                                    <select name="currency" class="form-select">
                                        <option value="KES" selected>KES</option>
                                        <option value="USD">USD</option>
                                        <option value="EUR">EUR</option>
                                        <option value="GBP">GBP</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Duration -->
                        <div class="section-card duration">
                            <div class="section-header">
                                <i class="fas fa-clock"></i>
                                <h3 class="section-title">Duration</h3>
                            </div>
                            <div class="section-body">
                                <div class="form-group mb-3">
                                    <label class="form-label">Days</label>
                                    <input type="number" name="duration_days" class="form-control" required>
                                </div>
                                <div class="form-group mb-3">
                                    <label class="form-label">Nights</label>
                                    <input type="number" name="duration_nights" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Difficulty Level</label>
                                    <select name="difficulty" class="form-select">
                                        <option value="Easy">Easy</option>
                                        <option value="Moderate">Moderate</option>
                                        <option value="Challenging">Challenging</option>
                                        <option value="Strenuous">Strenuous</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <!-- Group Size -->
                        <div class="section-card group-size">
                            <div class="section-header">
                                <i class="fas fa-users"></i>
                                <h3 class="section-title">Group Size</h3>
                            </div>
                            <div class="section-body">
                                <div class="form-group mb-3">
                                    <label class="form-label">Minimum Group Size</label>
                                    <input type="number" name="min_group_size" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Maximum Group Size</label>
                                    <input type="number" name="max_group_size" class="form-control" required>
                                </div>
                            </div>
                        </div>

                        <!-- Media -->
                        <div class="section-card media">
                            <div class="section-header">
                                <i class="fas fa-images"></i>
                                <h3 class="section-title">Media</h3>
                            </div>
                            <div class="section-body">
                                <div class="form-group mb-3 image-upload">
                                    <label class="form-label">Main Image</label>
                                    <input type="file" name="image" class="form-control">
                                </div>
                                <div class="form-group mb-3">
                                    <label class="form-label">Video URL</label>
                                    <input type="text" name="video" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">External Image URL</label>
                                    <input type="text" name="image_url" class="form-control">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Location -->
                <div class="wizard-step" :class="{'active': tourWizardStep === 3}">
                    <div class="section-card location">
                        <div class="section-header">
                            <i class="fas fa-map-marker-alt"></i>
                            <h3 class="section-title">Location</h3>
                        </div>
                        <div class="section-body">
                            <div class="form-group mb-3">
                                <label class="form-label">Departure Point</label>
                                <input type="text" name="departure_point" class="form-control" required>
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label">Destinations Visited</label>
                                <input type="text" name="destinations_visited" class="form-control">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Destinations (Multi-select)</label>
                                <select name="destinations" multiple class="form-select" size="5">
                                    <template x-for="destination in destinations" :key="destination.id">
                                        <option :value="destination.id" x-text="destination.name"></option>
                                    </template>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Itinerary Details (Optional) -->
                <div class="wizard-step" :class="{'active': tourWizardStep === 4}">
                    <div class="form-group mb-4">
                        <label class="flex items-center justify-between p-3 glass rounded-lg cursor-pointer">
                            <span class="text-white font-medium">Include Itinerary Details</span>
                            <label class="toggle-switch">
                                <input type="checkbox" x-model="showItineraryDetails">
                                <span class="toggle-slider"></span>
                            </label>
                        </label>
                    </div>

                    <!-- Itinerary & Highlights (Optional) -->
                    <div class="section-card itinerary optional-section" :class="{'active': showItineraryDetails}">
                        <div class="section-header">
                            <i class="fas fa-route"></i>
                            <h3 class="section-title">Itinerary Details</h3>
                        </div>
                        <div class="section-body">
                            <div class="form-group mb-3">
                                <label class="form-label">Tour Highlights</label>
                                <textarea name="highlights" class="form-control"></textarea>
                            </div>
                            <div class="form-group mb-3 json-field">
                                <label class="form-label">Itinerary (JSON format)</label>
                                <textarea name="itinerary" class="form-control"></textarea>
                                <div class="json-hint">Format: [{"day": 1, "title": "Day 1", "description": "Activities..."}]</div>
                            </div>
                            <div class="form-group mb-3 json-field">
                                <label class="form-label">Inclusions (JSON format)</label>
                                <textarea name="inclusions" class="form-control"></textarea>
                                <div class="json-hint">Format: ["Accommodation", "Meals", "Transport"]</div>
                            </div>
                            <div class="form-group json-field">
                                <label class="form-label">Exclusions (JSON format)</label>
                                <textarea name="exclusions" class="form-control"></textarea>
                                <div class="json-hint">Format: ["International flights", "Travel insurance"]</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Wizard Navigation -->
                <div class="flex justify-between mt-6">
                    <button type="button" @click="tourWizardStep > 1 ? tourWizardStep-- : showAddTour = false"
                            class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700"
                            x-show="tourWizardStep > 1">
                        <i class="fas fa-arrow-left mr-2"></i> Previous
                    </button>

                    <button type="button" @click="tourWizardStep < 4 ? tourWizardStep++ : null"
                            class="px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700"
                            x-show="tourWizardStep < 4">
                        Next <i class="fas fa-arrow-right ml-2"></i>
                    </button>

                    <button type="submit" class="submit-btn" x-show="tourWizardStep === 4">
                        <i class="fas fa-save"></i>
                        Save Tour
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

</main>

<script>
// Main application state and logic - COMPLETE DJANGO INTEGRATION
function officeManagerApp() {
    return {
        // UI state
        darkMode: false,
        mobileMenuOpen: false,
        showTripForm: false,
        showAddTour: false,
        editTourId: null,
        currentSection: 'dashboard',
        loading: true,
        showForm: false,
        formModel: '',
        editId: null,
        activeTab: 'overview',
        tourViewMode: 'table',
        tourWizardStep: 1,
        showItineraryDetails: false,
        autoRefresh: true,
        refreshInterval: null,
        customerSearch: '',

        // Data - Complete mapping to your Django models
        dashboardData: {
            driver: { available: true },
            total_earnings: 0,
            monthly_earnings: 0,
            completed_trips: 0,
            active_tours: 0,
            today_trips: [],
            upcoming_trips: [],
            recent_bookings: [],
            vehicle_status: null,
            tour_stats: { total: 0, approved: 0, pending: 0, active: 0 },
            avg_rating: 4.7,
            total_reviews: 0,
            rating_distribution: []
        },
        tours: [],
        destinations: [],
        categories: [],
        notification: null,
        paymentStats: {
            total_received: 0,
            total_withdrawn: 0,
            pending_withdrawal: 0,
            successful_payments: 0,
            pending_payments: 0,
            failed_payments: 0,
            recent_transactions: []
        },
        customers: [],

        // Admin data - Complete mapping
        bookingCustomers: [],
        bookings: [],
        contactMessages: [],
        drivers: [],
        payments: [],
        reviews: [],
        tourCategories: [],
        trips: [],
        vehicles: [],

        // Current selected item for details view
        selectedItem: null,
        selectedModel: null,

        // Pagination
        currentPage: 1,
        itemsPerPage: 10,
        totalItems: 0,

        // Search and filters
        searchQuery: '',
        statusFilter: '',
        dateFilter: '',
        dateRange: {
            start: '',
            end: ''
        },

        // Form data
        formData: {},

        // Selection
        selectAll: false,
        selectedItems: [],

        // Initialize method
        init() {
            console.log('Initializing Office Manager with complete Django model integration...');

            // Check for system dark mode preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                this.darkMode = true;
            }

            // Set default values
            this.currentSection = 'dashboard';
            this.tourViewMode = 'table';
            this.tourWizardStep = 1;
            this.showItineraryDetails = false;

            // Fetch initial data
            this.fetchDashboardData();
            this.fetchTours();
            this.fetchPaymentStats();
            this.fetchCustomers();

            // Fetch admin data
            this.fetchBookingCustomers();
            this.fetchBookings();
            this.fetchContactMessages();
            this.fetchDrivers();
            this.fetchPayments();
            this.fetchReviews();
            this.fetchTourCategories();
            this.fetchTrips();
            this.fetchVehicles();
            this.fetchDestinations();

            // Start auto refresh
            this.startAutoRefresh();

            // Check URL parameters for section
            const urlParams = new URLSearchParams(window.location.search);
            const section = urlParams.get('section');
            if (section) {
                this.currentSection = section;
            }

            // Set up debounced search
            this.debounceSearch = this.debounce(() => {
                this.updateFilteredData();
            }, 500);
        },

        // Navigation methods
        navigateTo(section) {
            this.currentSection = section;
            this.selectedItem = null;
            this.selectedModel = null;

            // Update URL without page reload
            const url = new URL(window.location);
            url.searchParams.set('section', section);
            window.history.pushState({}, '', url);

            // Refresh data for the current section
            this.refreshSectionData(section);
        },

        refreshSectionData(section) {
            switch(section) {
                case 'dashboard':
                    this.fetchDashboardData();
                    break;
                case 'earnings':
                case 'payments':
                    this.fetchPaymentStats();
                    break;
                case 'my-tours':
                    this.fetchTours();
                    break;
                case 'customers':
                    this.fetchCustomers();
                    break;
                case 'booking-customers':
                    this.fetchBookingCustomers();
                    break;
                case 'bookings':
                    this.fetchBookings();
                    break;
                case 'contact-messages':
                    this.fetchContactMessages();
                    break;
                case 'destinations':
                    this.fetchDestinations();
                    break;
                case 'drivers':
                    this.fetchDrivers();
                    break;
                case 'reviews':
                    this.fetchReviews();
                    break;
                case 'trips':
                    this.fetchTrips();
                    break;
                case 'vehicles':
                    this.fetchVehicles();
                    break;
            }
        },

        // Data fetching methods - COMPLETE DJANGO MODEL INTEGRATION
        async fetchDashboardData() {
            try {
                this.loading = true;
                const response = await fetch('/api/dashboard/');

                if (response.ok) {
                    const data = await response.json();
                    this.dashboardData = data;
                    console.log('Dashboard data loaded from API');
                } else {
                    await this.calculateRealDashboardStats();
                }
            } catch (error) {
                console.error('Error fetching dashboard data:', error);
                await this.calculateRealDashboardStats();
            } finally {
                this.loading = false;
            }
        },

        async calculateRealDashboardStats() {
            // Calculate from your actual Django data
            const totalTours = this.tours.length;
            const approvedTours = this.tours.filter(tour => tour.is_approved).length;
            const pendingTours = this.tours.filter(tour => !tour.is_approved).length;
            const activeTours = this.tours.filter(tour => tour.available && tour.is_approved).length;

            // Calculate earnings from SUCCESS payments
            const totalEarnings = this.payments
                .filter(payment => payment.status === 'SUCCESS')
                .reduce((sum, payment) => sum + parseFloat(payment.amount || 0), 0);

            // Calculate monthly earnings
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            const monthlyEarnings = this.payments
                .filter(payment => {
                    if (payment.status !== 'SUCCESS') return false;
                    const paymentDate = new Date(payment.paid_on || payment.created_at);
                    return paymentDate.getMonth() === currentMonth && paymentDate.getFullYear() === currentYear;
                })
                .reduce((sum, payment) => sum + parseFloat(payment.amount || 0), 0);

            // Calculate completed trips
            const completedTrips = this.trips.filter(trip => trip.status === 'COMPLETED').length;

            // Get today's trips
            const today = new Date().toISOString().split('T')[0];
            const todayTrips = this.trips.filter(trip => trip.date === today);

            // Get upcoming trips (next 7 days)
            const nextWeek = new Date();
            nextWeek.setDate(nextWeek.getDate() + 7);
            const upcomingTrips = this.trips.filter(trip => {
                const tripDate = new Date(trip.date);
                return tripDate > new Date() && tripDate <= nextWeek;
            });

            // Get recent bookings (last 5)
            const recentBookings = this.bookings
                .slice(0, 5)
                .map(booking => ({
                    id: booking.id,
                    customer: booking.booking_customer?.full_name || 'Unknown',
                    service: booking.service_name,
                    date: booking.travel_date,
                    amount: booking.total_price,
                    reference: booking.booking_reference
                }));

            // Calculate average rating from reviews
            const reviewsWithRatings = this.reviews.filter(review => review.rating);
            const avgRating = reviewsWithRatings.length > 0
                ? reviewsWithRatings.reduce((sum, review) => sum + review.rating, 0) / reviewsWithRatings.length
                : 4.7;

            this.dashboardData = {
                ...this.dashboardData,
                total_earnings: totalEarnings,
                monthly_earnings: monthlyEarnings,
                completed_trips: completedTrips,
                active_tours: activeTours,
                today_trips: todayTrips,
                upcoming_trips: upcomingTrips,
                recent_bookings: recentBookings,
                avg_rating: avgRating,
                total_reviews: reviewsWithRatings.length,
                tour_stats: {
                    total: totalTours,
                    approved: approvedTours,
                    pending: pendingTours,
                    active: activeTours
                }
            };
        },

        async fetchTours() {
            try {
                const response = await fetch('/api/tours/');

                if (response.ok) {
                    const toursData = await response.json();
                    // Complete mapping to your Tour model
                    this.tours = toursData.map(tour => ({
                        // Basic info
                        id: tour.id,
                        title: tour.title,
                        slug: tour.slug,
                        tagline: tour.tagline,
                        description: tour.description,

                        // Itinerary details
                        highlights: tour.highlights,
                        itinerary: tour.itinerary || [],
                        inclusions: tour.inclusions || [],
                        exclusions: tour.exclusions || [],

                        // Pricing
                        price_per_person: parseFloat(tour.price_per_person) || 0,
                        discount_price: parseFloat(tour.discount_price) || 0,
                        current_price: tour.current_price || parseFloat(tour.price_per_person) || 0,
                        currency: tour.currency || 'KES',
                        has_discount: tour.has_discount || false,
                        discount_percentage: tour.discount_percentage || 0,

                        // Duration
                        duration_days: tour.duration_days || 1,
                        duration_nights: tour.duration_nights || 0,
                        total_duration: tour.total_duration || `${tour.duration_days} days`,

                        // Group size
                        max_group_size: tour.max_group_size || 10,
                        min_group_size: tour.min_group_size || 1,

                        // Other details
                        difficulty: tour.difficulty || 'EASY',
                        category: tour.category,
                        category_name: tour.category?.name || 'Uncategorized',
                        max_advance_booking_days: tour.max_advance_booking_days || 365,

                        // Media
                        image: tour.image || tour.image_url,
                        video: tour.video,
                        image_url: tour.image_url,
                        gallery_images: tour.gallery_images || [],

                        // Location
                        departure_point: tour.departure_point || 'Nairobi',
                        destinations_visited: tour.destinations_visited,
                        destinations: tour.destinations || [],

                        // Sustainability
                        eco_friendly: tour.eco_friendly || false,
                        carbon_footprint_per_person: parseFloat(tour.carbon_footprint_per_person) || 0,
                        sustainability_certifications: tour.sustainability_certifications || [],

                        // Accessibility
                        wheelchair_accessible: tour.wheelchair_accessible || false,
                        accessibility_features: tour.accessibility_features || {},

                        // Health & Safety
                        health_safety_measures: tour.health_safety_measures || {},
                        covid19_protocols: tour.covid19_protocols || {},

                        // Status
                        available: tour.available || false,
                        is_approved: tour.is_approved || false,
                        featured: tour.featured || false,
                        is_popular: tour.is_popular || false,
                        is_available: tour.is_available || false,

                        // Creator
                        created_by: tour.created_by,
                        created_by_name: tour.created_by?.username || 'Unknown',
                        approved_by: tour.approved_by,
                        approved_at: tour.approved_at,

                        // Timestamps
                        created_at: tour.created_at,
                        updated_at: tour.updated_at
                    }));

                    this.updateTourStats();
                    console.log(`Loaded ${this.tours.length} tours from database`);
                } else {
                    console.error('Failed to fetch tours:', response.status);
                    this.tours = [];
                }
            } catch (error) {
                console.error('Error fetching tours:', error);
                this.tours = [];
            }
        },

        updateTourStats() {
            const totalTours = this.tours.length;
            const approvedTours = this.tours.filter(tour => tour.is_approved).length;
            const pendingTours = this.tours.filter(tour => !tour.is_approved).length;
            const activeTours = this.tours.filter(tour => tour.available && tour.is_approved).length;

            this.dashboardData.tour_stats = {
                total: totalTours,
                approved: approvedTours,
                pending: pendingTours,
                active: activeTours
            };

            console.log('Tour stats updated:', this.dashboardData.tour_stats);
        },

        // Get tours for display in My Tours section
        getMyTours() {
            return this.tours.map(tour => ({
                id: tour.id,
                name: tour.title,
                status: tour.is_approved ? 'Approved' : 'Pending',
                price: tour.current_price,
                duration: tour.duration_days,
                available: tour.available,
                is_approved: tour.is_approved,
                is_popular: tour.is_popular,
                featured: tour.featured,
                category: tour.category_name,
                created_by: tour.created_by_name,
                created_at: tour.created_at,
                bookings: this.bookings.filter(booking => booking.tour_id === tour.id).length,
                // Additional fields for details view
                tagline: tour.tagline,
                description: tour.description,
                highlights: tour.highlights,
                itinerary: tour.itinerary,
                inclusions: tour.inclusions,
                exclusions: tour.exclusions,
                currency: tour.currency,
                image: tour.image,
                difficulty: tour.difficulty,
                max_group_size: tour.max_group_size,
                departure_point: tour.departure_point
            }));
        },

        async fetchBookings() {
            try {
                const response = await fetch('/api/bookings/');
                if (response.ok) {
                    const bookingsData = await response.json();
                    this.bookings = bookingsData.map(booking => ({
                        id: booking.id,
                        booking_reference: booking.booking_reference,
                        booking_customer: booking.booking_customer,
                        booking_customer_name: booking.booking_customer?.full_name,
                        destination: booking.destination,
                        destination_name: booking.destination?.name,
                        tour: booking.tour,
                        tour_id: booking.tour?.id,
                        tour_name: booking.tour?.title,
                        booking_type: booking.booking_type,
                        num_adults: booking.num_adults || 1,
                        num_children: booking.num_children || 0,
                        num_infants: booking.num_infants || 0,
                        total_passengers: booking.total_passengers || 1,
                        pickup_location: booking.pickup_location,
                        dropoff_location: booking.dropoff_location,
                        travel_date: booking.travel_date,
                        travel_time: booking.travel_time,
                        return_date: booking.return_date,
                        return_time: booking.return_time,
                        status: booking.status,
                        special_requests: booking.special_requests,
                        notes: booking.notes,
                        total_price: parseFloat(booking.total_price) || 0,
                        currency: booking.currency || 'KES',
                        is_paid: booking.is_paid || false,
                        is_cancelled: booking.is_cancelled || false,
                        carbon_offset_option: booking.carbon_offset_option || false,
                        carbon_offset_amount: parseFloat(booking.carbon_offset_amount) || 0,
                        driver: booking.driver,
                        vehicle: booking.vehicle,
                        service_name: booking.service_name,
                        is_upcoming: booking.is_upcoming || false,
                        is_today: booking.is_today || false,
                        can_be_cancelled: booking.can_be_cancelled || false,
                        created_at: booking.created_at,
                        updated_at: booking.updated_at
                    }));
                    console.log(`Loaded ${this.bookings.length} bookings from database`);
                } else {
                    this.bookings = [];
                }
            } catch (error) {
                console.error('Error fetching bookings:', error);
                this.bookings = [];
            }
        },

        async fetchPayments() {
            try {
                const response = await fetch('/api/payments/');
                if (response.ok) {
                    const paymentsData = await response.json();
                    this.payments = paymentsData.map(payment => ({
                        // Basic payment info
                        id: payment.id,
                        reference: payment.reference,
                        amount: parseFloat(payment.amount) || 0,
                        amount_paid: parseFloat(payment.amount_paid) || 0,
                        currency: payment.currency || 'KES',
                        status: payment.status,
                        provider: payment.provider,
                        method: payment.method,

                        // Payer info
                        user: payment.user,
                        guest_full_name: payment.guest_full_name,
                        guest_email: payment.guest_email,
                        guest_phone: payment.guest_phone,
                        normalized_guest_phone: payment.normalized_guest_phone,

                        // Booking details
                        booking: payment.booking,
                        tour: payment.tour,
                        travel_date: payment.travel_date,
                        adults: payment.adults || 1,
                        children: payment.children || 0,
                        days: payment.days || 1,

                        // Paystack transaction details
                        paystack_transaction_id: payment.paystack_transaction_id,
                        access_code: payment.access_code,
                        transaction_id: payment.transaction_id,
                        authorization_code: payment.authorization_code,
                        raw_response: payment.raw_response,

                        // Webhook verification
                        webhook_verified: payment.webhook_verified || false,
                        webhook_received_at: payment.webhook_received_at,

                        // Additional details
                        description: payment.description,
                        paid_on: payment.paid_on,
                        failure_reason: payment.failure_reason,
                        payment_channel: payment.payment_channel,
                        ip_address: payment.ip_address,

                        // Refund information
                        refund_reference: payment.refund_reference,
                        refund_amount: parseFloat(payment.refund_amount) || 0,
                        refund_reason: payment.refund_reason,
                        refunded_on: payment.refunded_on,

                        // Helper properties
                        is_successful: payment.status === 'SUCCESS',
                        payer_email: payment.payer_email,

                        // Timestamps
                        created_at: payment.created_at,
                        updated_at: payment.updated_at
                    }));

                    this.updatePaymentStats();
                    console.log(`Loaded ${this.payments.length} payments from database`);
                } else {
                    this.payments = [];
                }
            } catch (error) {
                console.error('Error fetching payments:', error);
                this.payments = [];
            }
        },

        updatePaymentStats() {
            const successfulPayments = this.payments.filter(p => p.status === 'SUCCESS');
            const pendingPayments = this.payments.filter(p => p.status === 'PENDING');
            const failedPayments = this.payments.filter(p => p.status === 'FAILED');
            const refundedPayments = this.payments.filter(p => p.status === 'REFUNDED');

            const totalReceived = successfulPayments.reduce((sum, payment) => sum + parseFloat(payment.amount || 0), 0);
            const totalRefunded = refundedPayments.reduce((sum, payment) => sum + parseFloat(payment.refund_amount || 0), 0);

            const recentTransactions = successfulPayments
                .slice(0, 5)
                .map(payment => ({
                    id: payment.id,
                    date: payment.paid_on || payment.created_at,
                    amount: payment.amount,
                    type: 'credit',
                    description: `Payment from ${payment.guest_full_name || 'Guest'}`,
                    reference: payment.reference,
                    status: payment.status,
                    provider: payment.provider
                }));

            this.paymentStats = {
                total_received: totalReceived,
                total_withdrawn: 0, // You might calculate this separately
                total_refunded: totalRefunded,
                pending_withdrawal: 0,
                successful_payments: successfulPayments.length,
                pending_payments: pendingPayments.length,
                failed_payments: failedPayments.length,
                refunded_payments: refundedPayments.length,
                recent_transactions: recentTransactions
            };
        },

        // Payment actions
        async verifyPayment(paymentId) {
            try {
                const response = await fetch(`/api/payments/${paymentId}/verify/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': this.getCSRFToken()
                    }
                });

                if (response.ok) {
                    this.showNotification('Payment verification initiated', 'success');
                    // Refresh payments data
                    this.fetchPayments();
                } else {
                    this.showNotification('Error verifying payment', 'error');
                }
            } catch (error) {
                console.error('Error verifying payment:', error);
                this.showNotification('Error verifying payment', 'error');
            }
        },

        async refundPayment(paymentId, amount = null, reason = "") {
            if (!confirm('Are you sure you want to process this refund?')) {
                return;
            }

            try {
                const payload = {};
                if (amount) payload.amount = amount;
                if (reason) payload.reason = reason;

                const response = await fetch(`/api/payments/${paymentId}/refund/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': this.getCSRFToken()
                    },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    this.showNotification('Refund initiated successfully', 'success');
                    this.fetchPayments();
                } else {
                    this.showNotification('Error processing refund', 'error');
                }
            } catch (error) {
                console.error('Error processing refund:', error);
                this.showNotification('Error processing refund', 'error');
            }
        },

        // Other data fetching methods
        async fetchCustomers() {
            try {
                const response = await fetch('/api/booking-customers/');
                if (response.ok) {
                    this.customers = await response.json();
                } else {
                    this.customers = [];
                }
            } catch (error) {
                console.error('Error fetching customers:', error);
                this.customers = [];
            }
        },

        async fetchBookingCustomers() {
            try {
                const response = await fetch('/api/booking-customers/');
                if (response.ok) {
                    this.bookingCustomers = await response.json();
                } else {
                    this.bookingCustomers = [];
                }
            } catch (error) {
                console.error('Error fetching booking customers:', error);
                this.bookingCustomers = [];
            }
        },

        async fetchTrips() {
            try {
                const response = await fetch('/api/trips/');
                if (response.ok) {
                    const tripsData = await response.json();
                    this.trips = tripsData.map(trip => ({
                        id: trip.id,
                        driver: trip.driver,
                        driver_name: trip.driver?.full_name,
                        booking: trip.booking,
                        vehicle: trip.vehicle,
                        destination: trip.destination,
                        date: trip.date,
                        start_time: trip.start_time,
                        end_time: trip.end_time,
                        earnings: parseFloat(trip.earnings) || 0,
                        distance: parseFloat(trip.distance) || 0,
                        fuel_consumed: parseFloat(trip.fuel_consumed) || 0,
                        carbon_emissions: parseFloat(trip.carbon_emissions) || 0,
                        status: trip.status,
                        notes: trip.notes,
                        customer_rating: trip.customer_rating,
                        customer_feedback: trip.customer_feedback,
                        duration: trip.duration,
                        fuel_efficiency: trip.fuel_efficiency,
                        created_at: trip.created_at,
                        updated_at: trip.updated_at
                    }));
                } else {
                    this.trips = [];
                }
            } catch (error) {
                console.error('Error fetching trips:', error);
                this.trips = [];
            }
        },

        async fetchReviews() {
            try {
                const response = await fetch('/api/reviews/');
                if (response.ok) {
                    const reviewsData = await response.json();
                    this.reviews = reviewsData.map(review => ({
                        id: review.id,
                        booking: review.booking,
                        tour: review.tour,
                        driver: review.driver,
                        rating: review.rating,
                        safety_rating: review.safety_rating,
                        cleanliness_rating: review.cleanliness_rating,
                        value_rating: review.value_rating,
                        comfort_rating: review.comfort_rating,
                        punctuality_rating: review.punctuality_rating,
                        title: review.title,
                        comment: review.comment,
                        is_public: review.is_public || true,
                        is_verified: review.is_verified || false,
                        verified_at: review.verified_at,
                        response: review.response,
                        responded_at: review.responded_at,
                        responded_by: review.responded_by,
                        review_target: review.review_target,
                        review_target_name: review.review_target_name,
                        average_detailed_rating: review.average_detailed_rating,
                        rating_text: this.getRatingText(review.rating),
                        created_at: review.created_at,
                        updated_at: review.updated_at
                    }));
                } else {
                    this.reviews = [];
                }
            } catch (error) {
                console.error('Error fetching reviews:', error);
                this.reviews = [];
            }
        },

        getRatingText(rating) {
            const ratingMap = {
                1: "Poor",
                2: "Fair",
                3: "Good",
                4: "Very Good",
                5: "Excellent"
            };
            return ratingMap[rating] || "Unknown";
        },

        // Simplified versions of other fetch methods
        async fetchContactMessages() {
            try {
                const response = await fetch('/api/contact-messages/');
                this.contactMessages = response.ok ? await response.json() : [];
            } catch (error) {
                console.error('Error fetching contact messages:', error);
                this.contactMessages = [];
            }
        },

        async fetchDrivers() {
            try {
                const response = await fetch('/api/drivers/');
                this.drivers = response.ok ? await response.json() : [];
            } catch (error) {
                console.error('Error fetching drivers:', error);
                this.drivers = [];
            }
        },

        async fetchTourCategories() {
            try {
                const response = await fetch('/api/tour-categories/');
                this.tourCategories = response.ok ? await response.json() : [];
            } catch (error) {
                console.error('Error fetching tour categories:', error);
                this.tourCategories = [];
            }
        },

        async fetchVehicles() {
            try {
                const response = await fetch('/api/vehicles/');
                this.vehicles = response.ok ? await response.json() : [];
            } catch (error) {
                console.error('Error fetching vehicles:', error);
                this.vehicles = [];
            }
        },

        async fetchDestinations() {
            try {
                const response = await fetch('/api/destinations/');
                this.destinations = response.ok ? await response.json() : [];
            } catch (error) {
                console.error('Error fetching destinations:', error);
                this.destinations = [];
            }
        },

        // Tour actions
        async toggleTourApproval(tourId) {
            try {
                const tour = this.tours.find(t => t.id === tourId);
                if (!tour) return;

                const response = await fetch(`/api/tours/${tourId}/toggle-approval/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': this.getCSRFToken()
                    }
                });

                if (response.ok) {
                    tour.is_approved = !tour.is_approved;
                    this.updateTourStats();
                    this.showNotification(`Tour ${tour.is_approved ? 'approved' : 'unapproved'}`, 'success');
                } else {
                    this.showNotification('Error updating tour approval', 'error');
                }
            } catch (error) {
                console.error('Error updating tour approval:', error);
                this.showNotification('Error updating tour approval', 'error');
            }
        },

        async toggleTourAvailability(tourId) {
            try {
                const tour = this.tours.find(t => t.id === tourId);
                if (!tour) return;

                const response = await fetch(`/api/tours/${tourId}/toggle-availability/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': this.getCSRFToken()
                    }
                });

                if (response.ok) {
                    tour.available = !tour.available;
                    this.updateTourStats();
                    this.showNotification(`Tour ${tour.available ? 'activated' : 'deactivated'}`, 'success');
                } else {
                    this.showNotification('Error updating tour availability', 'error');
                }
            } catch (error) {
                console.error('Error updating tour availability:', error);
                this.showNotification('Error updating tour availability', 'error');
            }
        },

        // Utility methods
        getCSRFToken() {
            return document.querySelector('[name=csrfmiddlewaretoken]')?.value || '';
        },

        showNotification(message, type = 'info') {
            this.notification = { message, type };
            setTimeout(() => {
                this.notification = null;
            }, 5000);
        },

        formatCurrency(amount) {
            return new Intl.NumberFormat('en-KE', {
                style: 'currency',
                currency: 'KES',
                minimumFractionDigits: 2
            }).format(amount || 0);
        },

        formatDate(dateString) {
            if (!dateString) return 'N/A';
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        },

        formatDateTime(dateString) {
            if (!dateString) return 'N/A';
            const options = {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            return new Date(dateString).toLocaleDateString(undefined, options);
        },

        // Debounce function
        debounce(func, wait) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        },

        // Auto refresh
        startAutoRefresh() {
            if (this.autoRefresh) {
                this.refreshInterval = setInterval(() => {
                    this.fetchDashboardData();
                    this.fetchTours();
                    this.fetchPayments();
                }, 30000);
            }
        },

        stopAutoRefresh() {
            if (this.refreshInterval) {
                clearInterval(this.refreshInterval);
                this.refreshInterval = null;
            }
        }
    };
}

// Initialize when DOM is ready
document.addEventListener('DOMContentLoaded', function() {
    console.log('Office Manager App Initialized - Complete Django Integration');
});
</script>
</body>
</html>