<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Nairobi Airport Transfers - fast booking, vehicle selection and WhatsApp confirmation">
  <meta name="whatsapp-number" content="254723229651">
  <title>Nairobi Airport Transfers</title>
<style>
/* ===== CSS CUSTOM PROPERTIES ===== */
:root {
  /* Colors */
  --bg: #fbfcfe;
  --panel: #ffffff;
  --muted: #6b7280;
  --text: #0b2540;
  --navy: #0b5fd9;
  --taxi: #ffcc00;
  --taxi-700: #e6b800;
  --success: #10b981;
  --error: #ef4444;
  --warning: #f59e0b;

  /* Spacing */
  --space-xs: 4px;
  --space-sm: 8px;
  --space-md: 16px;
  --space-lg: 24px;
  --space-xl: 32px;
  --space-2xl: 48px;

  /* Typography */
  --text-xs: 0.75rem;
  --text-sm: 0.875rem;
  --text-base: 1rem;
  --text-lg: 1.125rem;
  --text-xl: 1.25rem;
  --text-2xl: 1.5rem;
  --text-3xl: 1.875rem;
  --text-4xl: 2.25rem;

  /* Layout */
  --max-width: 1100px;
  --header-height: 64px;
  --radius-sm: 4px;
  --radius: 8px;
  --radius-lg: 12px;
  --radius-xl: 16px;

  /* Effects */
  --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  --card-shadow-hover: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  --focus-ring: 0 0 0 3px rgba(11, 95, 217, 0.15);

  /* Transitions */
  --trans-fast: 150ms ease;
  --trans-base: 250ms ease;
  --trans-slow: 350ms ease;

  /* Z-index layers */
  --z-dropdown: 10;
  --z-sticky: 20;
  --z-fixed: 30;
  --z-modal: 40;
  --z-popover: 50;
  --z-toast: 60;
}

/* ===== CSS RESET & BASE STYLES ===== */
*, *::before, *::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html {
  scroll-behavior: smooth;
  -webkit-text-size-adjust: 100%;
}

html, body {
  height: 100%;
}

body {
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Helvetica Neue", sans-serif;
  background: linear-gradient(180deg, var(--bg), #f6f8fb);
  color: var(--text);
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeSpeed;
}

/* ===== ACCESSIBILITY IMPROVEMENTS ===== */
/* Focus styles for keyboard navigation */
*:focus-visible {
  outline: 2px solid var(--navy);
  outline-offset: 2px;
}

/* Skip link for keyboard users */
.skip-link {
  position: absolute;
  top: -40px;
  left: var(--space-md);
  background: var(--navy);
  color: white;
  padding: var(--space-sm) var(--space-md);
  border-radius: var(--radius);
  text-decoration: none;
  z-index: var(--z-toast);
  transition: top var(--trans-fast);
}

.skip-link:focus {
  top: var(--space-md);
}

/* Reduced motion for users who prefer it */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* ===== LAYOUT COMPONENTS ===== */
.container {
  max-width: var(--max-width);
  margin: 0 auto;
  padding: 0 var(--space-md);
  width: 100%;
}

/* Header */
header {
  position: sticky;
  top: 0;
  height: var(--header-height);
  z-index: var(--z-sticky);
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.95), rgba(250, 251, 255, 0.9));
  backdrop-filter: saturate(180%) blur(10px);
  -webkit-backdrop-filter: saturate(180%) blur(10px);
  border-bottom: 1px solid rgba(8, 20, 40, 0.08);
  transition: background-color var(--trans-base);
}

.header-inner {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--space-md);
  height: 100%;
}

.brand {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  font-weight: 700;
  color: var(--text);
  text-decoration: none;
}

.brand:hover {
  color: var(--navy);
}

.brand h1 {
  font-size: var(--text-lg);
  font-weight: 700;
}

.menu-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: 1px solid rgba(8, 20, 40, 0.08);
  padding: var(--space-sm);
  border-radius: var(--radius);
  cursor: pointer;
  font-size: var(--text-lg);
  color: var(--text);
  transition: all var(--trans-fast);
}

.menu-btn:hover,
.menu-btn:focus {
  background: rgba(11, 95, 217, 0.05);
  border-color: var(--navy);
}

.desktop-nav {
  display: none;
}

/* Main content area */
main {
  padding: var(--space-lg) 0;
  min-height: calc(100vh - var(--header-height));
}

/* ===== MOBILE MENU ===== */
.mobile-menu {
  position: fixed;
  top: 0;
  left: 0;
  bottom: 0;
  width: 85vw;
  max-width: 320px;
  background: linear-gradient(180deg, var(--panel), #fbfdff);
  transform: translateX(-100%);
  transition: transform var(--trans-base) cubic-bezier(0.23, 1, 0.32, 1);
  z-index: var(--z-modal);
  border-right: 1px solid rgba(8, 20, 40, 0.06);
  box-shadow: 0 0 50px rgba(0, 0, 0, 0.1);
  overflow-y: auto;
}

.mobile-menu.active {
  transform: translateX(0);
}

.mobile-menu .menu-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-md);
  border-bottom: 1px solid rgba(8, 20, 40, 0.04);
  position: sticky;
  top: 0;
  background: var(--panel);
  z-index: 1;
}

.mobile-nav {
  padding: var(--space-md);
}

.mobile-nav a {
  display: block;
  padding: var(--space-sm) var(--space-md);
  color: var(--text);
  text-decoration: none;
  border-radius: var(--radius);
  transition: all var(--trans-fast);
  margin-bottom: var(--space-xs);
}

.mobile-nav a:hover,
.mobile-nav a:focus {
  background: rgba(11, 95, 217, 0.05);
  color: var(--navy);
}

.mobile-menu-overlay {
  position: fixed;
  inset: 0;
  background: rgba(8, 20, 40, 0.4);
  display: none;
  z-index: var(--z-fixed);
  backdrop-filter: blur(2px);
  -webkit-backdrop-filter: blur(2px);
}

.mobile-menu-overlay.active {
  display: block;
}

/* ===== HERO SECTION ===== */
.hero-section {
  position: relative;
  height: 70vh;
  min-height: 500px;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  margin-bottom: var(--space-2xl);
  border-radius: var(--radius-lg);
  isolation: isolate;
}

.hero-background {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  transition: opacity var(--trans-slow) ease;
  z-index: 1;
}

.hero-background.fade {
  opacity: 0;
}

.hero-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, rgba(11, 37, 64, 0.8), rgba(11, 95, 217, 0.6));
  z-index: 2;
}

.hero-content {
  position: relative;
  z-index: 3;
  text-align: center;
  color: white;
  padding: 0 var(--space-md);
  max-width: 800px;
  width: 100%;
}

.hero-content h1 {
  font-size: var(--text-4xl);
  margin-bottom: var(--space-md);
  font-weight: 800;
  line-height: 1.1;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.hero-content p {
  font-size: var(--text-lg);
  margin-bottom: var(--space-lg);
  opacity: 0.9;
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
}

.hero-cta {
  background: linear-gradient(180deg, var(--taxi), var(--taxi-700));
  color: var(--text);
  border: none;
  padding: var(--space-md) var(--space-lg);
  border-radius: var(--radius);
  font-weight: 700;
  cursor: pointer;
  font-size: var(--text-base);
  text-decoration: none;
  display: inline-block;
  transition: all var(--trans-fast);
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.hero-cta:hover,
.hero-cta:focus {
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
}

.hero-indicators {
  position: absolute;
  bottom: var(--space-lg);
  left: 0;
  right: 0;
  display: flex;
  justify-content: center;
  gap: var(--space-sm);
  z-index: 4;
}

.hero-indicator {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.5);
  cursor: pointer;
  transition: all var(--trans-fast);
  border: 1px solid transparent;
}

.hero-indicator:hover,
.hero-indicator:focus {
  background: rgba(255, 255, 255, 0.7);
  transform: scale(1.1);
}

.hero-indicator.active {
  background: white;
  transform: scale(1.2);
}

/* ===== VEHICLE GRID ===== */
#vehicleGrid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: var(--space-md);
  padding: var(--space-sm);
}

/* Vehicle Card */
.vehicle-card {
  display: flex;
  flex-direction: column;
  border-radius: var(--radius-lg);
  background: var(--panel);
  border: 1px solid rgba(8, 20, 40, 0.06);
  box-shadow: var(--card-shadow);
  cursor: pointer;
  transition: all var(--trans-base);
  overflow: hidden;
  outline: 0;
  position: relative;
}

.vehicle-card:hover,
.vehicle-card:focus {
  transform: translateY(-4px);
  box-shadow: var(--card-shadow-hover);
  border-color: rgba(11, 95, 217, 0.2);
}

.vehicle-card[aria-selected="true"] {
  border: 2px solid var(--taxi);
  box-shadow: 0 12px 24px rgba(255, 204, 0, 0.15);
}

.vehicle-card[aria-selected="true"]::after {
  content: "‚úì";
  position: absolute;
  top: var(--space-sm);
  right: var(--space-sm);
  background: var(--taxi);
  color: var(--text);
  width: 24px;
  height: 24px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  z-index: 2;
}

.vehicle-image-container {
  position: relative;
  width: 100%;
  aspect-ratio: 16 / 9;
  overflow: hidden;
}

.vehicle-image,
.vehicle-no-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  transition: transform var(--trans-slow);
}

.vehicle-card:hover .vehicle-image {
  transform: scale(1.05);
}

.vehicle-no-image {
  background: linear-gradient(135deg, #f3f6ff, #eef3ff);
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--muted);
  font-size: var(--text-sm);
}

.vehicle-meta {
  padding: var(--space-md);
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: var(--space-xs);
}

.vehicle-title {
  font-weight: 700;
  margin: 0;
  color: var(--text);
  font-size: var(--text-base);
  line-height: 1.3;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.vehicle-sub {
  font-size: var(--text-sm);
  color: var(--muted);
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  line-height: 1.4;
}

.vehicle-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: var(--space-sm);
  gap: var(--space-sm);
}

.vehicle-price {
  font-weight: 800;
  color: var(--navy);
  font-size: var(--text-base);
}

.vehicle-eta {
  font-size: var(--text-sm);
  color: var(--muted);
}

.cta-small {
  background: linear-gradient(180deg, var(--taxi), var(--taxi-700));
  color: var(--text);
  padding: var(--space-sm) var(--space-md);
  border-radius: var(--radius);
  border: none;
  font-weight: 700;
  cursor: pointer;
  transition: all var(--trans-fast);
  font-size: var(--text-sm);
  width: 100%;
  margin-top: auto;
}

.cta-small:hover,
.cta-small:focus {
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

/* ===== MODERN BOOKING CARD ===== */
.booking-container {
  background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
  border-radius: var(--radius-xl);
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
  overflow: hidden;
  margin-top: var(--space-2xl);
  position: relative;
}

.booking-header {
  background: linear-gradient(135deg, var(--navy) 0%, #084ac1 100%);
  color: white;
  padding: var(--space-xl) var(--space-lg);
  text-align: center;
  position: relative;
  overflow: hidden;
}

.booking-header::before {
  content: '';
  position: absolute;
  top: -50%;
  right: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
  animation: float 20s infinite linear;
}

@keyframes float {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.booking-header h2 {
  font-size: var(--text-2xl);
  font-weight: 700;
  margin-bottom: var(--space-sm);
  position: relative;
  z-index: 1;
}

.booking-header p {
  opacity: 0.9;
  font-size: var(--text-base);
  position: relative;
  z-index: 1;
}

.booking-body {
  padding: var(--space-xl);
}

.booking-form {
  display: grid;
  gap: var(--space-lg);
}

.form-section {
  background: rgba(255, 255, 255, 0.8);
  border-radius: var(--radius-lg);
  padding: var(--space-lg);
  border: 1px solid rgba(11, 95, 217, 0.08);
  transition: all var(--trans-base);
}

.form-section:hover {
  border-color: rgba(11, 95, 217, 0.15);
  box-shadow: 0 4px 20px rgba(11, 95, 217, 0.05);
}

.section-title {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  margin-bottom: var(--space-md);
  color: var(--navy);
  font-weight: 600;
  font-size: var(--text-lg);
}

.section-icon {
  width: 32px;
  height: 32px;
  background: linear-gradient(135deg, var(--navy), #084ac1);
  border-radius: var(--radius);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: var(--text-lg);
}

.form-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: var(--space-md);
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: var(--space-xs);
}

.form-label {
  font-weight: 600;
  font-size: var(--text-sm);
  color: var(--text);
  display: flex;
  align-items: center;
  gap: var(--space-xs);
}

.label-icon {
  color: var(--navy);
  font-size: var(--text-base);
}

.form-input,
.form-select,
.form-textarea {
  width: 100%;
  padding: var(--space-md);
  border-radius: var(--radius-lg);
  border: 2px solid rgba(8, 20, 40, 0.08);
  background: white;
  font-size: var(--text-base);
  color: var(--text);
  transition: all var(--trans-fast);
  position: relative;
}

.form-input:focus,
.form-select:focus,
.form-textarea:focus {
  border-color: var(--navy);
  box-shadow: 0 0 0 3px rgba(11, 95, 217, 0.1);
  outline: none;
}

.form-input::placeholder {
  color: var(--muted);
  opacity: 0.7;
}

.input-icon {
  position: absolute;
  right: var(--space-md);
  top: 50%;
  transform: translateY(-50%);
  color: var(--muted);
  pointer-events: none;
}

.input-wrapper {
  position: relative;
}

.selected-vehicle {
  background: linear-gradient(135deg, rgba(255, 204, 0, 0.1), rgba(255, 204, 0, 0.05));
  border: 2px solid var(--taxi);
  border-radius: var(--radius-lg);
  padding: var(--space-md);
  margin-bottom: var(--space-md);
  display: flex;
  align-items: center;
  gap: var(--space-md);
  transition: all var(--trans-fast);
}

.selected-vehicle:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(255, 204, 0, 0.2);
}

.selected-vehicle-icon {
  width: 48px;
  height: 48px;
  background: var(--taxi);
  border-radius: var(--radius);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: var(--text-xl);
  color: var(--text);
}

.selected-vehicle-info {
  flex: 1;
}

.selected-vehicle-name {
  font-weight: 600;
  color: var(--text);
  margin-bottom: var(--space-xs);
}

.selected-vehicle-details {
  font-size: var(--text-sm);
  color: var(--muted);
}

.booking-actions {
  display: flex;
  gap: var(--space-md);
  margin-top: var(--space-xl);
  padding-top: var(--space-lg);
  border-top: 1px solid rgba(8, 20, 40, 0.08);
}

.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-sm);
  padding: var(--space-md) var(--space-xl);
  border-radius: var(--radius-lg);
  cursor: pointer;
  font-weight: 600;
  font-size: var(--text-base);
  transition: all var(--trans-fast);
  text-decoration: none;
  line-height: 1;
  position: relative;
  overflow: hidden;
}

.btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s;
}

.btn:hover::before {
  left: 100%;
}

.btn-primary {
  background: linear-gradient(135deg, var(--navy), #084ac1);
  color: white;
  border: none;
  flex: 1;
}

.btn-primary:hover,
.btn-primary:focus {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(11, 95, 217, 0.3);
}

.btn-secondary {
  background: transparent;
  color: var(--navy);
  border: 2px solid var(--navy);
}

.btn-secondary:hover,
.btn-secondary:focus {
  background: rgba(11, 95, 217, 0.05);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(11, 95, 217, 0.15);
}

/* ===== MODAL ===== */
.modal {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(8, 20, 40, 0.4);
  z-index: var(--z-modal);
  padding: var(--space-md);
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
}

.modal.active {
  display: flex;
  animation: fadeIn var(--trans-fast);
}

.modal-card {
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.98), rgba(250, 251, 255, 0.99));
  padding: var(--space-xl);
  border-radius: var(--radius-xl);
  max-width: 560px;
  width: 100%;
  box-shadow: 0 30px 60px rgba(8, 20, 40, 0.2);
  border: 1px solid rgba(11, 95, 217, 0.08);
  animation: slideUp var(--trans-base);
  position: relative;
}

.modal h3 {
  margin-top: 0;
  margin-bottom: var(--space-md);
  font-size: var(--text-xl);
}

.modal-close {
  position: absolute;
  top: var(--space-md);
  right: var(--space-md);
  background: transparent;
  border: none;
  font-size: var(--text-lg);
  cursor: pointer;
  color: var(--muted);
  padding: var(--space-xs);
  border-radius: var(--radius-sm);
  transition: all var(--trans-fast);
}

.modal-close:hover,
.modal-close:focus {
  color: var(--text);
  background: rgba(0, 0, 0, 0.05);
}

/* ===== UTILITY CLASSES ===== */
.kicker {
  font-size: var(--text-xs);
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  font-weight: 600;
}

.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

.text-center {
  text-align: center;
}

.mb-0 {
  margin-bottom: 0;
}

.mt-0 {
  margin-top: 0;
}

/* ===== LOADING STATES ===== */
.spinner {
  width: 40px;
  height: 40px;
  border: 4px solid rgba(11, 95, 217, 0.1);
  border-left-color: var(--navy);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Loading skeleton for cards */
.skeleton {
  background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
  background-size: 200% 100%;
  animation: loading 1.5s infinite;
  border-radius: var(--radius);
}

@keyframes loading {
  0% {
    background-position: 200% 0;
  }
  100% {
    background-position: -200% 0;
  }
}

/* ===== INFO SECTION ===== */
.info-section {
  padding: var(--space-xl) 0;
  margin-top: var(--space-2xl);
  background: rgba(255, 255, 255, 0.8);
  border-radius: var(--radius-lg);
}

.info-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: var(--space-xl);
  margin-top: var(--space-lg);
}

.info-card {
  text-align: center;
  padding: var(--space-lg);
  border-radius: var(--radius);
  transition: transform var(--trans-fast);
}

.info-card:hover {
  transform: translateY(-4px);
}

.info-icon {
  font-size: 2.5rem;
  margin-bottom: var(--space-md);
  color: var(--navy);
}

.info-card h3 {
  margin-bottom: var(--space-sm);
  color: var(--text);
}

.info-card p {
  color: var(--muted);
  font-size: var(--text-sm);
}

/* ===== FOOTER ===== */
footer {
  margin-top: var(--space-2xl);
  padding: var(--space-xl) 0;
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.9), rgba(250, 251, 255, 0.95));
  border-top: 1px solid rgba(8, 20, 40, 0.06);
  text-align: center;
}

.footer-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--space-md);
}

.footer-links {
  display: flex;
  gap: var(--space-lg);
  margin-bottom: var(--space-md);
}

.footer-links a {
  color: var(--muted);
  text-decoration: none;
  transition: color var(--trans-fast);
}

.footer-links a:hover {
  color: var(--navy);
}

.whatsapp-button {
  display: inline-flex;
  align-items: center;
  gap: var(--space-sm);
  background: #25D366;
  color: white;
  padding: var(--space-sm) var(--space-md);
  border-radius: var(--radius);
  text-decoration: none;
  font-weight: 600;
  transition: all var(--trans-fast);
}

.whatsapp-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(37, 211, 102, 0.3);
}

/* ===== RESPONSIVE DESIGN ===== */
/* Mobile-first approach - all base styles are for mobile */

/* Tablet styles */
@media (min-width: 640px) {
  .hero-content h1 {
    font-size: var(--text-4xl);
  }

  .form-row {
    grid-template-columns: repeat(2, 1fr);
  }

  .info-grid {
    grid-template-columns: repeat(3, 1fr);
  }
}

/* Desktop styles */
@media (min-width: 1024px) {
  .desktop-nav {
    display: flex;
    align-items: center;
    gap: var(--space-lg);
  }

  .desktop-nav a {
    color: var(--text);
    text-decoration: none;
    font-weight: 500;
    transition: color var(--trans-fast);
    padding: var(--space-sm) 0;
    position: relative;
  }

  .desktop-nav a:hover,
  .desktop-nav a:focus {
    color: var(--navy);
  }

  .desktop-nav a::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background: var(--navy);
    transition: width var(--trans-base);
  }

  .desktop-nav a:hover::after,
  .desktop-nav a:focus::after {
    width: 100%;
  }

  .menu-btn {
    display: none;
  }

  .hero-content h1 {
    font-size: 3.5rem;
  }

  .hero-section {
    height: 80vh;
    min-height: 600px;
  }

  .vehicle-card {
    flex-direction: row;
    min-height: 140px;
  }

  .vehicle-image-container {
    width: 200px;
    aspect-ratio: 16/10;
  }

  .cta-small {
    width: auto;
    margin-top: 0;
  }

  .footer-content {
    flex-direction: row;
    justify-content: space-between;
  }

  .booking-actions {
    justify-content: space-between;
  }

  .btn-primary {
    flex: none;
    min-width: 200px;
  }
}

/* Large desktop */
@media (min-width: 1280px) {
  .container {
    padding: 0 var(--space-lg);
  }

  .hero-content h1 {
    font-size: 4rem;
  }
}

/* Small mobile adjustments */
@media (max-width: 480px) {
  .hero-section {
    height: 60vh;
    min-height: 400px;
  }

  .hero-content h1 {
    font-size: var(--text-2xl);
  }

  .hero-content p {
    font-size: var(--text-base);
  }

  .vehicle-row {
    flex-direction: column;
    align-items: flex-start;
    gap: var(--space-xs);
  }

  .booking-actions {
    flex-direction: column;
  }

  .btn {
    width: 100%;
  }

  .info-grid {
    grid-template-columns: 1fr;
  }

  .booking-header {
    padding: var(--space-lg);
  }

  .booking-body {
    padding: var(--space-lg);
  }

  .form-section {
    padding: var(--space-md);
  }
}

/* Print styles */
@media print {
  .menu-btn,
  .hero-cta,
  .cta-small,
  .booking-actions {
    display: none !important;
  }

  .hero-section {
    height: auto;
    min-height: auto;
  }

  .vehicle-card {
    break-inside: avoid;
  }
}
</style>
</head>
<body>
  <a href="#main" class="skip-link">Skip to main content</a>

  <header id="header">
    <div class="container header-inner">
      <div class="brand">
        <button id="mobileMenuBtn" class="menu-btn" aria-controls="mobileMenu" aria-expanded="false" aria-label="Open menu">‚ò∞</button>
        <div>
          <h1>Nairobi Airport Transfers</h1>
          <div class="kicker">Professional airport transfers and taxis</div>
        </div>
      </div>

      <nav class="desktop-nav" aria-label="Main navigation">
        <a href="#booking" class="kicker" style="text-decoration:none;color:var(--navy);font-weight:600">Book transfer</a>
        <a href="#vehicles">Vehicles</a>
        <a href="#info">Why Us</a>
        <a href="#contact">Contact</a>
      </nav>
    </div>
  </header>

  <!-- Mobile menu -->
  <div id="mobileMenu" class="mobile-menu" role="dialog" aria-modal="true" aria-hidden="true" aria-label="Mobile menu">
    <div class="menu-header">
      <strong>Menu</strong>
      <button id="mobileMenuClose" class="menu-btn" aria-label="Close menu">‚úï</button>
    </div>
    <nav class="mobile-nav" aria-label="Mobile navigation">
      <a href="#booking">Book Transfer</a>
      <a href="#vehicles">Vehicles</a>
      <a href="#info">Why Us</a>
      <a href="#contact">Contact</a>
    </nav>
  </div>
  <div id="mobileMenuOverlay" class="mobile-menu-overlay" aria-hidden="true"></div>

  <!-- Hero Section -->
  <section class="hero-section" id="hero">
    <div class="hero-background" id="heroBackground"></div>
    <div class="hero-overlay"></div>
    <div class="hero-content">
      <h1>Premium Airport Transfers in Nairobi</h1>
      <p>Professional, reliable, and comfortable transportation to and from Jomo Kenyatta International Airport</p>
      <a href="#booking" class="hero-cta">Book Your Ride Now</a>
    </div>
    <div class="hero-indicators" id="heroIndicators"></div>
  </section>

  <main id="main" class="container">
    <section id="vehicles" class="grid" aria-labelledby="vehiclesHeading">
      <h2 id="vehiclesHeading">Available vehicles</h2>
      <div id="vehicleGrid" role="listbox" aria-label="Available vehicles" tabindex="0"></div>
    </section>

    <section id="info" class="info-section" aria-labelledby="infoHeading">
      <h2 id="infoHeading" class="text-center">Why Choose Nairobi Airport Transfers</h2>
      <div class="info-grid">
        <div class="info-card">
          <div class="info-icon">‚úàÔ∏è</div>
          <h3>Flight Tracking</h3>
          <p>We monitor your flight in real-time to ensure we're there when you arrive, even if your flight is early or delayed.</p>
        </div>
        <div class="info-card">
          <div class="info-icon">üë®‚Äç‚úàÔ∏è</div>
          <h3>Professional Drivers</h3>
          <p>Our experienced drivers are courteous, knowledgeable about Nairobi, and committed to your safety and comfort.</p>
        </div>
        <div class="info-card">
          <div class="info-icon">üí∫</div>
          <h3>Comfortable Vehicles</h3>
          <p>Travel in style and comfort with our well-maintained fleet of modern vehicles equipped with air conditioning.</p>
        </div>
      </div>
    </section>

    <!-- Modern Booking Card -->
    <section id="booking" class="booking-container" aria-labelledby="bookingHeading">
      <div class="booking-header">
        <h2>Book Your Transfer</h2>
        <p>Fill in your details and we'll confirm via WhatsApp</p>
      </div>

      <div class="booking-body">
        <form id="bookingForm" class="booking-form" autocomplete="on" novalidate>
          <input type="hidden" id="selectedVehicle" name="vehicle_id" value="">

          <!-- Selected Vehicle Display -->
          <div id="selectedVehicleDisplay" class="selected-vehicle" style="display: none;">
            <div class="selected-vehicle-icon">üöó</div>
            <div class="selected-vehicle-info">
              <div class="selected-vehicle-name" id="selectedVehicleName">No vehicle selected</div>
              <div class="selected-vehicle-details" id="selectedVehicleDetails">Please select a vehicle above</div>
            </div>
          </div>

          <!-- Trip Details Section -->
          <div class="form-section">
            <div class="section-title">
              <div class="section-icon">üìç</div>
              Trip Details
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="service">
                  <span class="label-icon">üöê</span>
                  Service Type
                </label>
                <select name="service" id="service" class="form-select" required>
                  <option value="">Select service</option>
                  <option value="Airport Transfer">Airport Transfer</option>
                  <option value="City Tour">City Tour</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label" for="date">
                  <span class="label-icon">üìÖ</span                  > Travel Date
                </label>
                <input type="date" name="date" id="date" class="form-input" required>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="time">
                  <span class="label-icon">üïê</span>
                  Pickup Time
                </label>
                <input type="time" name="time" id="time" class="form-input" required>
              </div>
              <div class="form-group">
                <label class="form-label" for="passengers">
                  <span class="label-icon">üë•</span>
                  Number of Passengers
                </label>
                <input type="number" name="passengers" id="passengers" class="form-input" min="1" max="20" placeholder="How many passengers?" required>
              </div>
            </div>
          </div>

          <!-- Location Section -->
          <div class="form-section">
            <div class="section-title">
              <div class="section-icon">üó∫Ô∏è</div>
              Location Details
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="pickup">
                  <span class="label-icon">üìç</span>
                  Pickup Location
                </label>
                <input type="text" name="pickup" id="pickup" class="form-input" placeholder="Enter pickup address" required>
              </div>
              <div class="form-group">
                <label class="form-label" for="dropoff">
                  <span class="label-icon">üéØ</span>
                  Drop-off Location
                </label>
                <input type="text" name="dropoff" id="dropoff" class="form-input" placeholder="Enter destination" required>
              </div>
            </div>
          </div>

          <!-- Contact Section -->
          <div class="form-section">
            <div class="section-title">
              <div class="section-icon">üë§</div>
              Contact Information
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="name">
                  <span class="label-icon">üë§</span>
                  Your Name
                </label>
                <input type="text" name="name" id="name" class="form-input" placeholder="Enter your full name" required>
              </div>
              <div class="form-group">
                <label class="form-label" for="phone">
                  <span class="label-icon">üì±</span>
                  WhatsApp Number
                </label>
                <input type="tel" name="phone" id="phone" class="form-input" placeholder="+2547XXXXXXXX" pattern="^\+?254[0-9]{9}$" required>
              </div>
            </div>
          </div>

          <div class="booking-actions">
            <button type="submit" class="btn btn-primary">
              <span>üì§</span>
              Send Booking via WhatsApp
            </button>
            <button type="button" id="clearSelection" class="btn btn-secondary">
              <span>üîÑ</span>
              Clear Form
            </button>
          </div>
        </form>
      </div>
    </section>
  </main>

  <footer id="contact">
    <div class="container">
      <div class="footer-content">
        <div>
          <h3>Nairobi Airport Transfers</h3>
          <p class="kicker">Professional airport transfers and taxis</p>
        </div>
        <div class="footer-links">
          <a href="#vehicles">Vehicles</a>
          <a href="#booking">Book Now</a>
          <a href="#info">Why Us</a>
        </div>
        <a href="https://wa.me/254723229651" class="whatsapp-button" target="_blank" rel="noopener">
          <span>üí¨</span> WhatsApp Us
        </a>
      </div>
    </div>
  </footer>

  <!-- WhatsApp confirmation modal -->
  <div id="whatsappModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="whatsappTitle">
    <div class="modal-card">
      <h3 id="whatsappTitle">Confirm booking</h3>
      <div id="bookingSummary" aria-live="polite" style="margin:12px 0;color:var(--text)"></div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button id="whatsappCancel" class="btn btn-secondary">Cancel</button>
        <button id="whatsappSend" class="btn btn-primary">Send on WhatsApp</button>
      </div>
    </div>
  </div>

  <!-- Success modal -->
  <div id="successModal" class="modal" role="status" aria-hidden="true" aria-labelledby="successTitle">
    <div class="modal-card">
      <h3 id="successTitle">Booking sent</h3>
      <p>Thanks ‚Äî your booking request has been opened in WhatsApp. We will follow up shortly.</p>
      <div style="text-align:right;margin-top:8px"><button id="successClose" class="btn btn-primary">Close</button></div>
    </div>
  </div>

  <script>
  (function(){
    'use strict';

    // helpers
    const q=(s,r=document)=>r.querySelector(s);
    const qa=(s,r=document)=>Array.from((r||document).querySelectorAll(s));
    const escapeHtml=(s)=>String(s??'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));

    // debounce/throttle
    const throttle=(fn,lim)=>{let t=false;return(...a)=>{if(!t){fn(...a);t=true;setTimeout(()=>t=false,lim);}}};

    // Image observer
    let imageObserver;
    function setupImageObserver(){
      if(!('IntersectionObserver' in window)) return;
      imageObserver=new IntersectionObserver((entries,obs)=>{
        entries.forEach(en=>{
          if(en.isIntersecting){
            const img=en.target; const src=img.dataset.src;
            if(src){ img.src=src; img.onload=()=>img.classList.add('loaded'); img.removeAttribute('data-src'); try{obs.unobserve(img)}catch(e){} }
          }
        });
      },{rootMargin:'120px 0px',threshold:0.01});
    }

    // Cache with localStorage fallback
    const CACHE_KEY='vehicles_cache_v1';
    const vehicleCache={
      expiry:10*60*1000,
      get(){
        try{
          const raw=localStorage.getItem(CACHE_KEY);
          if(!raw) return null;
          const parsed=JSON.parse(raw);
          if(Date.now()-parsed.t>this.expiry) { localStorage.removeItem(CACHE_KEY); return null; }
          return parsed.v;
        }catch(e){return null}
      },
      set(v){ try{ localStorage.setItem(CACHE_KEY, JSON.stringify({t:Date.now(),v})); }catch(e){} },
      clear(){ try{ localStorage.removeItem(CACHE_KEY);}catch(e){} }
    };

    // Hero Section Functionality
    function setupHeroSection(vehicles) {
      const heroSection = q('#hero');
      const heroIndicators = q('#heroIndicators');

      if (!heroSection) return;

      // Filter vehicles with valid images
      const vehiclesWithImages = vehicles.filter(v => v.image_url && v.image_url.trim() !== '');

      // Clear existing indicators and backgrounds
      heroIndicators.innerHTML = '';
      const existingBackgrounds = qa('.hero-background', heroSection);
      existingBackgrounds.forEach(bg => {
        if (bg.id !== 'heroBackground') bg.remove();
      });

      if (vehiclesWithImages.length === 0) {
        // Set a default background if no vehicle images
        q('#heroBackground').style.backgroundImage = "url('https://images.unsplash.com/photo-1568605117036-5fe5e7bab0b7?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80')";
        return;
      }

      let currentIndex = 0;
      const backgrounds = [];

      // Preload images and create background elements
      vehiclesWithImages.forEach((vehicle, index) => {
        const bg = document.createElement('div');
        bg.className = 'hero-background';
        bg.style.backgroundImage = `url('${vehicle.image_url}')`;
        bg.style.opacity = index === 0 ? '1' : '0';
        bg.style.zIndex = index === 0 ? '1' : '0';

        if (index > 0) {
          bg.classList.add('fade');
        }

        heroSection.insertBefore(bg, heroSection.firstChild);
        backgrounds.push(bg);

        // Create indicator
        const indicator = document.createElement('div');
        indicator.className = 'hero-indicator';
        if (index === 0) indicator.classList.add('active');
        indicator.addEventListener('click', () => {
          setActiveBackground(index);
        });
        heroIndicators.appendChild(indicator);
      });

      // Remove the original heroBackground if we have vehicle images
      const originalBg = q('#heroBackground');
      if (originalBg && backgrounds.length > 0) {
        originalBg.remove();
      }

      // Function to set active background
      function setActiveBackground(index) {
        if (index === currentIndex) return;

        backgrounds[currentIndex].classList.add('fade');
        setTimeout(() => {
          backgrounds[currentIndex].style.zIndex = '0';
        }, 500);

        backgrounds[index].style.zIndex = '1';
        backgrounds[index].classList.remove('fade');

        // Update indicators
        qa('.hero-indicator').forEach((ind, i) => {
          if (i === index) {
            ind.classList.add('active');
          } else {
            ind.classList.remove('active');
          }
        });

        currentIndex = index;
      }

      // Auto-rotate backgrounds every 5 seconds
      let rotationInterval = setInterval(() => {
        const nextIndex = (currentIndex + 1) % backgrounds.length;
        setActiveBackground(nextIndex);
      }, 5000);

      // Pause rotation on hover
      heroSection.addEventListener('mouseenter', () => {
        clearInterval(rotationInterval);
      });

      heroSection.addEventListener('mouseleave', () => {
        rotationInterval = setInterval(() => {
          const nextIndex = (currentIndex + 1) % backgrounds.length;
          setActiveBackground(nextIndex);
        }, 5000);
      });

      // Expose function to update hero from vehicle selection
      window.updateHeroFromSelection = function(vehicleId) {
        const selectedVehicle = vehicles.find(v => String(v.id) === String(vehicleId));
        if (selectedVehicle && selectedVehicle.image_url) {
          const vehicleIndex = vehiclesWithImages.findIndex(v =>
            String(v.id) === String(vehicleId));
          if (vehicleIndex !== -1) {
            setActiveBackground(vehicleIndex);
            clearInterval(rotationInterval);

            // Restart rotation after 10 seconds of inactivity
            setTimeout(() => {
              rotationInterval = setInterval(() => {
                const nextIndex = (currentIndex + 1) % backgrounds.length;
                setActiveBackground(nextIndex);
              }, 5000);
            }, 10000);
          }
        }
      };
    }

    document.addEventListener('DOMContentLoaded',()=>{
      setupImageObserver();

      const vehicleGrid=q('#vehicleGrid');
      const selectedInput=q('#selectedVehicle');
      const bookingForm=q('#bookingForm');
      const whatsappModal=q('#whatsappModal');
      const bookingSummary=q('#bookingSummary');
      const successModal=q('#successModal');
      const header=q('#header');
      const mobileMenuBtn=q('#mobileMenuBtn');
      const mobileMenu=q('#mobileMenu');
      const mobileMenuClose=q('#mobileMenuClose');
      const mobileMenuOverlay=q('#mobileMenuOverlay');
      const clearSelectionBtn=q('#clearSelection');
      const selectedVehicleDisplay=q('#selectedVehicleDisplay');
      const selectedVehicleName=q('#selectedVehicleName');
      const selectedVehicleDetails=q('#selectedVehicleDetails');

      if(!vehicleGrid||!selectedInput) return;

      let vehicles=[]; let focusedIndex=-1; let isLoading=false; let currentToken=null;
      const API_ENDPOINT='/api/vehicles/'; const API_TIMEOUT=8000;

      // mobile menu
      function openMenu(){ mobileMenu?.classList.add('active'); mobileMenuOverlay?.classList.add('active'); mobileMenuBtn?.setAttribute('aria-expanded','true'); document.body.style.overflow='hidden'; }
      function closeMenu(){ mobileMenu?.classList.remove('active'); mobileMenuOverlay?.classList.remove('active'); mobileMenuBtn?.setAttribute('aria-expanded','false'); document.body.style.overflow=''; }
      mobileMenuBtn?.addEventListener('click',openMenu);
      mobileMenuClose?.addEventListener('click',closeMenu);
      mobileMenuOverlay?.addEventListener('click',closeMenu);

      // header scroll
      window.addEventListener('scroll',throttle(()=>{ header?.classList.toggle('scrolled', window.scrollY>50); },100),{passive:true});

      // ui creators
      function createLoadingEl(){ const d=document.createElement('div'); d.className='loading'; d.innerHTML='<div class="spinner" aria-hidden="true"></div><div style="margin-top:8px">Loading vehicles‚Ä¶</div>'; return d; }
      function createErrorEl(msg){ const d=document.createElement('div'); d.className='vehicle-error'; d.setAttribute('role','alert'); d.innerHTML=`<p>${escapeHtml(msg)}</p><button id='retryLoadVehicles' class='btn'>Retry</button>`; return d; }
      function createEmptyEl(){ const d=document.createElement('div'); d.className='vehicle-empty'; d.textContent='No vehicles available at the moment.'; return d; }

      // selection/focus
      function setSelectedById(id){
        selectedInput.value = id==null ? '' : String(id);
        qa('.vehicle-card',vehicleGrid).forEach(c=>{
          const sel=c.dataset.vehicleId===String(id);
          c.classList.toggle('selected',sel);
          c.setAttribute('aria-selected', sel ? 'true' : 'false');
        });

        // Update selected vehicle display
        if (id) {
          const vehicle = vehicles.find(v => String(v.id) === String(id));
          if (vehicle) {
            selectedVehicleDisplay.style.display = 'flex';
            selectedVehicleName.textContent = `${vehicle.make || vehicle.name || 'Unknown'} ${vehicle.model || ''}`;
            selectedVehicleDetails.textContent = `${vehicle.capacity || vehicle.seats || '-'} seats ‚Ä¢ ${vehicle.price ? 'KSh ' + vehicle.price : 'Price on request'}`;
          }
        } else {
          selectedVehicleDisplay.style.display = 'none';
        }

        // Update hero when vehicle is selected
        if (id && window.updateHeroFromSelection) {
          window.updateHeroFromSelection(id);
        }
      }

      function focusCardAt(i){ const cards=qa('.vehicle-card',vehicleGrid); if(!cards.length) return; i=Math.max(0,Math.min(i,cards.length-1)); focusedIndex=i; const el=cards[i]; if(el && typeof el.focus==='function') el.focus(); }

      // build card
      function buildVehicleCard(v){ const id=v.id||Math.random().toString(36).slice(2,9); const make=v.make||v.name||'Unknown'; const model=v.model||''; const imgSrc=escapeHtml(v.image_url||v.image||''); const btn=document.createElement('button'); btn.type='button'; btn.className='vehicle-card'; btn.dataset.vehicleId=id; btn.id='vehicle-'+id; btn.setAttribute('role','option'); btn.tabIndex=0; btn.innerHTML=`<div class='vehicle-image-container'>${imgSrc?`<img data-src='${imgSrc}' class='vehicle-image' alt='${escapeHtml(make+' '+model)}' loading='lazy'>`:`<div class='vehicle-no-image' aria-hidden='true'>No image</div>`}</div><div class='vehicle-meta'><div class='vehicle-title'>${escapeHtml(make)} ${escapeHtml(model)}</div><div class='vehicle-sub'>${escapeHtml(String(v.capacity||v.seats||'-'))} seats ${v.license_plate?'- '+escapeHtml(v.license_plate):''}</div><div class='vehicle-row'><span class='vehicle-price'>${v.price ? 'KSh ' + escapeHtml(String(v.price)) : 'Price on request'}</span><button class='cta-small'>Select</button></div></div>`;
        const img=btn.querySelector('img[data-src]'); if(img && imageObserver) imageObserver.observe(img); img?.addEventListener('error',()=>{ const c=btn.querySelector('.vehicle-image-container'); if(c) c.innerHTML=`<div class='vehicle-no-image'>Car image unavailable</div>`; });
        btn.addEventListener('click',()=>setSelectedById(id));
        btn.addEventListener('keydown',(e)=>{ const cards=qa('.vehicle-card',vehicleGrid); const idx=cards.indexOf(btn); if(e.key==='Enter'||e.key===' '){ e.preventDefault(); setSelectedById(id); } else if(e.key==='ArrowRight'||e.key==='ArrowDown'){ e.preventDefault(); focusCardAt(idx+1); } else if(e.key==='ArrowLeft'||e.key==='ArrowUp'){ e.preventDefault(); focusCardAt(idx-1); } else if(e.key==='Home'){ e.preventDefault(); focusCardAt(0); } else if(e.key==='End'){ e.preventDefault(); focusCardAt(cards.length-1); } });
        return btn;
      }

      // render
      function renderVehicleGrid(list){ vehicleGrid.replaceChildren(); if(!Array.isArray(list)||!list.length){ vehicleGrid.appendChild(createEmptyEl()); selectedInput.value=''; return; } const frag=document.createDocumentFragment(); for(const v of list) frag.appendChild(buildVehicleCard(v)); vehicleGrid.appendChild(frag); if(!selectedInput.value && list.length) setSelectedById(list[0].id); }

      // fetch with caching + abort
      async function loadVehicles(){ if(isLoading) return; isLoading=true; const cached=vehicleCache.get(); if(cached){ vehicles=cached; renderVehicleGrid(vehicles); setupHeroSection(vehicles); isLoading=false; // background refresh but don't block UI
          silentRefresh(); return; }
        vehicleGrid.replaceChildren(createLoadingEl()); if(currentToken) currentToken.cancelled=true; const token = {cancelled:false}; currentToken=token;
        try{
          const controller=new AbortController(); const to=setTimeout(()=>controller.abort(), API_TIMEOUT);
          const resp=await fetch(API_ENDPOINT,{signal:controller.signal,credentials:'same-origin'});
          clearTimeout(to); if(token.cancelled) return; if(!resp.ok) throw new Error('HTTP '+resp.status);
          const data=await resp.json(); if(token.cancelled) return;
          const arr=Array.isArray(data)?data:(data && (data.data||data.results))||[];
          vehicles=arr.map(v=>({ id:v.id||Math.random().toString(36).slice(2,9), make:v.make||v.name||'Unknown', model:v.model||'', vehicle_type:v.vehicle_type||v.type||'Standard', capacity:v.capacity||v.seats||4, license_plate:v.license_plate||'', image_url:v.image_url||v.image||'', price:v.price||'‚Äî', ...v }));
          vehicleCache.set(vehicles); renderVehicleGrid(vehicles); setupHeroSection(vehicles);
        }catch(err){ console.error('Error fetching vehicles:',err); if(token.cancelled) return; vehicleGrid.replaceChildren(createErrorEl('Failed to load vehicles.')); q('#retryLoadVehicles')?.addEventListener('click',loadVehicles,{once:true}); }
        finally{ if(currentToken===token) currentToken=null; isLoading=false; }
      }

      // silent refresh (background) to avoid stale view
      async function silentRefresh(){ try{ const controller=new AbortController(); const to=setTimeout(()=>controller.abort(),API_TIMEOUT); const resp=await fetch(API_ENDPOINT,{signal:controller.signal}); clearTimeout(to); if(!resp.ok) return; const data=await resp.json(); const arr=Array.isArray(data)?data:(data && (data.data||data.results))||[]; const newVehicles=arr.map(v=>({ id:v.id||Math.random().toString(36).slice(2,9), make:v.make||v.name||'Unknown', model:v.model||'', vehicle_type:v.vehicle_type||v.type||'Standard', capacity:v.capacity||v.seats||4, license_plate:v.license_plate||'', image_url:v.image_url||v.image||'', price:v.price||'‚Äî', ...v })); vehicleCache.set(newVehicles); // don't re-render if unchanged
            // shallow compare length or first id
            if(!vehicles || vehicles.length!==newVehicles.length || (vehicles[0] && newVehicles[0] && vehicles[0].id!==newVehicles[0].id)) { vehicles=newVehicles; renderVehicleGrid(vehicles); setupHeroSection(vehicles); }
        }catch(e){} }

      // keyboard grid navigation (aria)
      vehicleGrid.addEventListener('keydown',(e)=>{ const keys=['ArrowDown','ArrowRight','ArrowUp','ArrowLeft','Home','End']; if(!keys.includes(e.key)) return; const cards=qa('.vehicle-card',vehicleGrid); if(!cards.length) return; e.preventDefault(); if(e.key==='ArrowDown'||e.key==='ArrowRight') focusCardAt((focusedIndex===-1?0:focusedIndex+1)); if(e.key==='ArrowUp'||e.key==='ArrowLeft') focusCardAt((focusedIndex===-1?cards.length-1:focusedIndex-1)); if(e.key==='Home') focusCardAt(0); if(e.key==='End') focusCardAt(cards.length-1); });

      // external changes
      selectedInput.addEventListener('change',()=>setSelectedById(selectedInput.value));

      // booking form
      if(bookingForm){ bookingForm.addEventListener('submit',(e)=>{ e.preventDefault(); const selectedVehicleId=selectedInput.value; if(!selectedVehicleId){ alert('Please select a vehicle'); return; } const phone=q('#phone'); const phonePattern=/^\+254\d{9}$/; if(!phone||!phonePattern.test(phone.value.trim())){ alert('Please enter a valid Kenyan phone number in the format +254XXXXXXXXX'); return; } const formData=new FormData(bookingForm); const vehicle=vehicles.find(v=>String(v.id)===String(selectedVehicleId))||{}; const summaryHtml=[`<strong>Service:</strong> ${escapeHtml(formData.get('service')||'')}`,`<strong>Date:</strong> ${escapeHtml(formData.get('date')||'')}`,`<strong>Time:</strong> ${escapeHtml(formData.get('time')||'')}`,`<strong>Pickup:</strong> ${escapeHtml(formData.get('pickup')||'')}`,`<strong>Drop-off:</strong> ${escapeHtml(formData.get('dropoff')||'')}`,`<strong>Passengers:</strong> ${escapeHtml(formData.get('passengers')||'')}`,`<strong>Vehicle:</strong> ${escapeHtml(vehicle.make||vehicle.name||'')} ${escapeHtml(vehicle.model||'')} - ${escapeHtml(String(vehicle.capacity||vehicle.seats||'‚Äî'))} Seats`,`<strong>Name:</strong> ${escapeHtml(formData.get('name')||'')}`,`<strong>Phone:</strong> ${escapeHtml(formData.get('phone')||'')}`].join('<br>'); bookingSummary.innerHTML=summaryHtml; whatsappModal.classList.add('active'); whatsappModal.setAttribute('aria-hidden','false'); }); }

      function handleWhatsAppSend(){ try{ const formData=new FormData(bookingForm); const vehicle=vehicles.find(v=>String(v.id)===String(selectedInput.value))||{}; const lines=['*New Booking Request*','',`Service: ${formData.get('service')||''}`,`Date: ${formData.get('date')||''}`,`Time: ${formData.get('time')||''}`,`Pickup: ${formData.get('pickup')||''}`,`Drop-off: ${formData.get('dropoff')||''}`,`Passengers: ${formData.get('passengers')||''}`,`Vehicle: ${vehicle.make||vehicle.name||''} ${vehicle.model||''} - ${vehicle.capacity||vehicle.seats||''} Seats`,`Name: ${formData.get('name')||''}`,`Phone: ${formData.get('phone')||''}`,`Email: ${formData.get('email')||''}`,`Notes: ${formData.get('notes')||'None'}`]; const wa=`https://wa.me/254723229651?text=${encodeURIComponent(lines.join('\n'))}`; window.open(wa,'_blank','noopener'); whatsappModal.classList.remove('active'); whatsappModal.setAttribute('aria-hidden','true'); successModal.classList.add('active'); successModal.setAttribute('aria-hidden','false'); bookingForm.reset(); setSelectedById(null); setTimeout(()=>{ successModal.classList.remove('active'); successModal.setAttribute('aria-hidden','true'); }, 4500); }catch(e){ console.error(e); alert('Failed to open WhatsApp.'); } }

      q('#whatsappSend')?.addEventListener('click',handleWhatsAppSend);
      q('#whatsappCancel')?.addEventListener('click',()=>{ whatsappModal.classList.remove('active'); whatsappModal.setAttribute('aria-hidden','true'); });

      q('#successClose')?.addEventListener('click',()=>{ successModal.classList.remove('active'); successModal.setAttribute('aria-hidden','true'); });

      // retry close when clicking backdrop
      qa('.modal').forEach(m=>m.addEventListener('click',(e)=>{ if(e.target===m){ m.classList.remove('active'); m.setAttribute('aria-hidden','true'); } }));

      // clear selection
      clearSelectionBtn?.addEventListener('click',()=>{ vehicleCache.clear(); bookingForm.reset(); setSelectedById(null); });

      // start
      loadVehicles();

      // expose for debugging
      window.vehicleWidget={ reload:()=>{ vehicleCache.clear(); return loadVehicles(); }, getVehicles:()=>vehicles.slice(), select:(id)=>setSelectedById(id), clearCache:()=>vehicleCache.clear() };

    }); // DOMContentLoaded
  })();
  </script>
</body>
</html>